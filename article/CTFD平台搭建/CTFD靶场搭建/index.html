<!DOCTYPE html>
<html>
    <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0 user-scalable=1" name="viewport">
    <title>s4mmy&#39;s blog</title> <!--ä½¿ç”¨configä¸­çš„å…¨å±€å˜é‡titleä½œä¸ºæ ‡é¢˜-->
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="s4mmy's blog" type="application/atom+xml">
</head>
    
    <body>
        <header class="header">
    <div class="title">
        <a href="/" class="logo" >s4mmy&#39;s blog</a>
    </div>
    <nav class="navbar">
        <ul class="menu">
            
                <a href="/" class="menu-item-link">Home</a>   
            
                <a href="/journals/" class="menu-item-link">Journals</a>   
            
                <a href="/technical/" class="menu-item-link">Technical</a>   
            
                <a href="/other/" class="menu-item-link">Other</a>   
            
                <a href="/about/" class="menu-item-link">About</a>   
            
        </ul>
    
    </nav>
    
    
</header>



        
        <div class="container">
            <div style="border-bottom:1px solid #eaedf3;"></div>
            
            <article class="post-content">
    <div class="post-title">
        <h2>CTFDåŠ¨æ€é¶åœºæ­å»º</h2>
    </div>
    <div>
        <span class="post-time">2023-08-27</span>
    </div>
    <div class="post-font">
        <meta name="referrer" content="no-referrer" />



<h1 id="CTFDåŠ¨æ€é¶åœºæ­å»º"><a href="#CTFDåŠ¨æ€é¶åœºæ­å»º" class="headerlink" title="CTFDåŠ¨æ€é¶åœºæ­å»º"></a>CTFDåŠ¨æ€é¶åœºæ­å»º</h1><p>ä¸ºäº†è¿æ¥æœªæ¥çš„æ–°ç”Ÿèµ›å’Œæœªæ¥æ¥æ´»åšå‡†å¤‡ï¼Œå­¦ä¹ ä¸€ä¸‹å¦‚ä½•æ­å»ºCTFDé¶åœºé¡ºä¾¿ç»ƒç»ƒæ‰‹ã€‚ä¸è¿‡è¿™ä¸­é—´è¸©çš„å‘ä¹Ÿæ˜¯å·¨å¤šï¼Œå‰å‰ååæ­äº†å¥½å‡ å¤©æ‰æ­å¥½ã€‚</p>
<h2 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h2><p>CTFDä½¿ç”¨çš„æ˜¯çš„dockeræ­å»ºï¼Œæ‰€ä»¥åœ¨æœåŠ¡å™¨ä¸Šéœ€è¦å…ˆè£…å¥½dockerå’Œdocker-composeã€‚å…¶ä¸­ctfdæœ‰å¤šç§æ­å»ºæ–¹å¼ï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯æœåŠ¡å™¨æœ¬åœ°èµ·frpæœåŠ¡å°†é¢˜ç›®å®¹å™¨è½¬å‘åˆ°æœåŠ¡å™¨çš„ç«¯å£ä¸Šã€‚</p>
<h2 id="å®‰è£…FRP"><a href="#å®‰è£…FRP" class="headerlink" title="å®‰è£…FRP"></a>å®‰è£…FRP</h2><p>ä¸‹è½½å¹¶å®‰è£…rp</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wget https:&#x2F;&#x2F;github.com&#x2F;fatedier&#x2F;frp&#x2F;releases&#x2F;download&#x2F;v0.29.0&#x2F;frp_0.29.0_linux_amd64.tar.gz
tar -zxvf frp_0.29.0_linux_amd64.tar.gz
cd frp_0.29.0_linux_amd64
cd frp_0.29.0_linux_amd64
sudo cp systemd&#x2F;* &#x2F;etc&#x2F;systemd&#x2F;system&#x2F; #ç§»åŠ¨é…ç½®æ–‡ä»¶
sudo mkdir &#x2F;etc&#x2F;frp #åˆ›å»ºå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
sudo cp frpc.ini  frps.ini &#x2F;etc&#x2F;frp&#x2F; #ç§»åŠ¨å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
sudo cp frpc  frps &#x2F;usr&#x2F;bin&#x2F; #å°†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„äºŒè¿›åˆ¶æ–‡ä»¶ç§»åŠ¨è‡³binæ–‡ä»¶å¤¹
sudo chmod a+x &#x2F;usr&#x2F;bin&#x2F;frpc &#x2F;usr&#x2F;bin&#x2F;frps #ç»™æ‰€æœ‰ç”¨æˆ·èµ‹äºˆfrpcå’Œfrpsçš„å¯æ‰§è¡Œæƒé™
sudo systemctl enable frps #å°†frpsæœåŠ¡è®¾ç½®ä¸ºæ¯æ¬¡å¼€æœºå¯åŠ¨</code></pre>



<p>ç¼–è¾‘frpsé…ç½®æ–‡ä»¶</p>
<pre class="line-numbers language-none"><code class="language-none">vim &#x2F;etc&#x2F;frp&#x2F;frps.ini
[common]
bind_port &#x3D; 7897
bind_addr &#x3D; 0.0.0.0
token &#x3D;thisistoken</code></pre>

<p>å¯åŠ¨frpsæœåŠ¡</p>
<pre class="line-numbers language-none"><code class="language-none">systemctl start frps</code></pre>

<p> ä¿®æ”¹&#x2F;etc&#x2F;frp&#x2F;frpc.iniçš„é…ç½®æ–‡ä»¶</p>
<p>æ­¤å¤„çš„frpcä¸ä¸Šé¢çš„frpsç›¸å¯¹åº”ï¼Œè¿æ¥çš„æ˜¯ä¸Šé¢å¯åŠ¨çš„frps</p>
<pre class="line-numbers language-none"><code class="language-none">vim &#x2F;etc&#x2F;frp&#x2F;frpc.ini
[common]
server_addr &#x3D; 172.17.0.1#æ­¤å¤„çš„IPä¸ºdocker0çš„ipï¼Œdocker0çš„ipé€šè¿‡ifconfigæŸ¥çœ‹
server_port &#x3D; 7897
token&#x3D;thisistoken</code></pre>

<p>å†ä¿®æ”¹frp_0.29.0_linux_amd64&#x2F;frpc.ini  (è¿™ä¸ªæ–‡ä»¶ä¼šç”¨æ¥é…ç½®frpcå®¹å™¨çš„)</p>
<pre class="line-numbers language-none"><code class="language-none">[common]
server_addr &#x3D; 172.17.0.1
server_port &#x3D; 7897
token&#x3D;thisistoken
admin_addr &#x3D; 172.20.0.3
admin_port &#x3D; 7400
log_file &#x3D; .&#x2F;frps.log</code></pre>

<p>åˆ›å»ºç½‘ç»œå¹¶è¿è¡Œfrpcå®¹å™¨</p>
<pre class="line-numbers language-none"><code class="language-none">docker network create ctfd_frp-containers #åˆ›å»ºä¸€ä¸ªdockerç½‘ç»œï¼Œåç§°ä¸ºctfd_frp-containers

docker run  -d -v ~&#x2F;frp_0.29.0_linux_amd64&#x2F;frpc.ini:&#x2F;etc&#x2F;frp&#x2F;frpc.ini --network&#x3D;&quot;ctfd_frp-containers&quot; --restart&#x3D;always &quot;glzjin&#x2F;frp&quot;  #è¿è¡Œå®¹å™¨å¹¶å°†æœ¬åœ°çš„frpc.iniæŒ‚è½½åˆ°å®¹å™¨å†…ã€‚ç½‘ç»œåç§°ä¸ºctfd_frp-containers</code></pre>



<p>æ¥ç€åˆ›å»ºfrpcadminç½‘ç»œç”¨è¯­ctfdå’Œfrpcå®¹å™¨é€šä¿¡</p>
<pre class="line-numbers language-none"><code class="language-none">docker network creat frcadmin
docker network connect frpcamdin id&lt;åˆšæ‰å¯åŠ¨çš„frpcå®¹å™¨ID&gt;</code></pre>



<p>æŸ¥çœ‹frpcadminç½‘ç»œçš„è¿æ¥æƒ…å†µå¹¶è®°å½•frpcå®¹å™¨çš„ç½‘ç»œIP</p>
<pre class="line-numbers language-none"><code class="language-none">docker network inspect frpcadmin</code></pre>

<p>å›¾ä¸­çš„IPå°±æ˜¯frpcå®¹å™¨åœ¨frpcadminç½‘ç»œä¸­çš„IPåœ°å€ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨&#x2F;frp&#x2F;frpc.iniä¸­æŒ‡å®šçš„ï¼ˆadmin_addrï¼‰</p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348486.png" alt="image-20230820205128158"></p>
<p>å¯ä»¥æå‰æŠŠè¿™ä¸ªåœ°å€è®°å½•ä¸‹æ¥ï¼Œåé¢é…ç½®ctfd-whaleçš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p>
<h2 id="å®‰è£…CTFdå’ŒCTFd-whale"><a href="#å®‰è£…CTFdå’ŒCTFd-whale" class="headerlink" title="å®‰è£…CTFdå’ŒCTFd-whale"></a>å®‰è£…CTFdå’ŒCTFd-whale</h2><pre class="line-numbers language-none"><code class="language-none">#ä¸‹è½½ctfd
git clone https:&#x2F;&#x2F;github.com&#x2F;CTFd&#x2F;CTFd.git
#è¿›å…¥CTFdç›®å½•
cd CTFd
#å›é€€åˆ°æŸä¸ªç‰ˆæœ¬ï¼Œç›´æ¥æ‰§è¡Œä¸‹é¢å‘½ä»¤
git reset 6c5c63d667a17aec159c8e26ea53dccfbc4d0fa3 --hard
cd CTFd&#x2F;CTFd&#x2F;plugins&#x2F; #è¿›å…¥pluginsç›®å½•

#ä¸‹è½½æ’ä»¶å¹¶ç¡®ä¿æ–‡ä»¶åå°å†™
git clone https:&#x2F;&#x2F;github.com&#x2F;glzjin&#x2F;CTFd-Whale.git ctfd-whale
#è¿›å…¥ctfd-whale
cd ctfd-whale
#å›é€€ç‰ˆæœ¬
git reset 5b32f457e9f56ee9b2b29495f4b3b118be3c57bd --hard 
#å›åˆ°ç¬¬ä¸€å±‚CTFdç›®å½•
cd ..&#x2F;..&#x2F;..&#x2F;
#é…ç½®docker-compose
vim docker-compose.yml</code></pre>

<p>docker-compose.ymlï¼Œç›´æ¥å¤åˆ¶ç²˜è´´å°±è¡Œ</p>
<pre class="line-numbers language-none"><code class="language-none">version: &#39;2.2&#39;

services:
  ctfd:
    build: .
    user: root
    restart: always
    ports:
      - &quot;8000:8000&quot; #ç¬¬ä¸€ä¸ªæ˜¯è®¿é—®ctfdçš„ç«¯å£ï¼Œç¬¬äºŒä¸ªæ˜¯dockerç«¯å£æ˜ å°„å‡ºå»çš„ç«¯å£
    environment:
      - UPLOAD_FOLDER&#x3D;&#x2F;var&#x2F;uploads
      - DATABASE_URL&#x3D;mysql+pymysql:&#x2F;&#x2F;root:ctfd@db&#x2F;ctfd
      - REDIS_URL&#x3D;redis:&#x2F;&#x2F;cache:6379
      - WORKERS&#x3D;1
      - LOG_FOLDER&#x3D;&#x2F;var&#x2F;log&#x2F;CTFd
      - ACCESS_LOG&#x3D;-
      - ERROR_LOG&#x3D;-
    volumes:
      - .data&#x2F;CTFd&#x2F;logs:&#x2F;var&#x2F;log&#x2F;CTFd
      - .data&#x2F;CTFd&#x2F;uploads:&#x2F;var&#x2F;uploads
      - .:&#x2F;opt&#x2F;CTFd:ro
      - &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock #æ·»åŠ è¿™å¥å³å¯ï¼Œåˆ«çš„åŸºæœ¬æŒ‰ç…§å®˜æ–¹çš„ä¸ç”¨åŠ¨
    depends_on:
      - db
    networks:
        default:
        internal:

  db:
    image: mariadb:10.4.12 #è¿™é‡Œæ”¹æˆ10.4.12ï¼Œ10.4.13ä¼šå‡ºé”™
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD&#x3D;ctfd
      - MYSQL_USER&#x3D;ctfd
      - MYSQL_PASSWORD&#x3D;ctfd
      - MYSQL_DATABASE&#x3D;ctfd
    volumes:
      - .data&#x2F;mysql:&#x2F;var&#x2F;lib&#x2F;mysql
    networks:
        internal:
    # This command is required to set important mariadb defaults
    command: [mysqld, --character-set-server&#x3D;utf8mb4, --collation-server&#x3D;utf8mb4_unicode_ci, --wait_timeout&#x3D;28800, --log-warnings&#x3D;0]

  cache:
    image: redis:4
    restart: always
    volumes:
    - .data&#x2F;redis:&#x2F;data
    networks:
        internal:

networks:
    default:
    internal:
        internal: true</code></pre>

<p>è¿›å…¥CTFdç›®å½•ï¼Œä¿®æ”¹Dockerfileçš„å†…å®¹</p>
<pre class="line-numbers language-none"><code class="language-none">FROM python:3.6-alpine
RUN sed -i &#39;s&#x2F;dl-cdn.alpinelinux.org&#x2F;mirrors.aliyun.com&#x2F;g&#39; &#x2F;etc&#x2F;apk&#x2F;repositories &amp;&amp;\
    apk update &amp;&amp; \
    apk add python3 python3-dev linux-headers libffi-dev gcc make musl-dev py-pip mysql-client git openssl-dev
RUN adduser -D -u 1001 -s &#x2F;bin&#x2F;bash ctfd

WORKDIR &#x2F;opt&#x2F;CTFd
RUN mkdir -p &#x2F;opt&#x2F;CTFd &#x2F;var&#x2F;log&#x2F;CTFd &#x2F;var&#x2F;uploads
RUN pip config set global.index-url https:&#x2F;&#x2F;pypi.doubanio.com&#x2F;simple
RUN pip config set install.trusted-host pypi.doubanio.com
COPY requirements.txt .

RUN pip install -r requirements.txt -i  https:&#x2F;&#x2F;pypi.doubanio.com&#x2F;simple

COPY . &#x2F;opt&#x2F;CTFd

RUN for d in CTFd&#x2F;plugins&#x2F;*; do \
      if [ -f &quot;$d&#x2F;requirements.txt&quot; ]; then \
        pip install -r $d&#x2F;requirements.txt -i  https:&#x2F;&#x2F;pypi.doubanio.com&#x2F;simple; \
      fi; \
    done;

RUN chmod +x &#x2F;opt&#x2F;CTFd&#x2F;docker-entrypoint.sh
RUN chown -R 1001:1001 &#x2F;opt&#x2F;CTFd
RUN chown -R 1001:1001 &#x2F;var&#x2F;log&#x2F;CTFd &#x2F;var&#x2F;uploads

USER 1001
EXPOSE 8000
ENTRYPOINT [&quot;&#x2F;opt&#x2F;CTFd&#x2F;docker-entrypoint.sh&quot;]	</code></pre>

<p>requirements.txtå†…å®¹</p>
<pre class="line-numbers language-none"><code class="language-none">Flask&#x3D;&#x3D;1.1.2
Werkzeug&#x3D;&#x3D;0.16.0
Flask-SQLAlchemy&#x3D;&#x3D;2.4.1
Flask-Caching&#x3D;&#x3D;1.4.0
Flask-Migrate&#x3D;&#x3D;2.5.2
Flask-Script&#x3D;&#x3D;2.0.6
SQLAlchemy&#x3D;&#x3D;1.3.11
SQLAlchemy-Utils&#x3D;&#x3D;0.36.0
passlib&#x3D;&#x3D;1.7.2
bcrypt&#x3D;&#x3D;3.1.7
six&#x3D;&#x3D;1.13.0
itsdangerous&#x3D;&#x3D;1.1.0
jinja2&#x3D;&#x3D;2.11.3
requests&gt;&#x3D;2.20.0
PyMySQL&#x3D;&#x3D;0.9.3
gunicorn&#x3D;&#x3D;19.9.0
normality&#x3D;&#x3D;2.0.0
dataset&#x3D;&#x3D;1.1.2
mistune&#x3D;&#x3D;0.8.4
netaddr&#x3D;&#x3D;0.7.19
redis&#x3D;&#x3D;3.3.11
datafreeze&#x3D;&#x3D;0.1.0
gevent&#x3D;&#x3D;21.12.0
python-dotenv&#x3D;&#x3D;0.10.3
flask-restplus&#x3D;&#x3D;0.13.0
pathlib2&#x3D;&#x3D;2.3.5
flask-marshmallow&#x3D;&#x3D;0.10.1
marshmallow-sqlalchemy&#x3D;&#x3D;0.17.0
boto3&#x3D;&#x3D;1.10.39
markupsafe&#x3D;&#x3D;1.1.1
marshmallow&#x3D;&#x3D;2.20.2</code></pre>

<p>å‡†å¤‡å¥½åå¼€å§‹æ„å»ºå®¹å™¨ï¼Œè¿›å…¥CTFdç›®å½•</p>
<pre class="line-numbers language-none"><code class="language-none">docker-compose biuld</code></pre>

<p>å¯åŠ¨é•œåƒ</p>
<pre class="line-numbers language-none"><code class="language-none">docker-compose up -d</code></pre>

<p>å¯åŠ¨å®Œä¹‹åå°†ctfdå®¹å™¨åŠ å…¥åˆ°frpcadminçš„ç½‘ç»œä¹‹ä¸­</p>
<pre class="line-numbers language-none"><code class="language-none">docker ps #æŸ¥çœ‹ctfdå®¹å™¨çš„ID
docker network connect frpcadmin #å®¹å™¨ID </code></pre>

<p>å¯ä»¥çœ‹åˆ°ctfdå®¹å™¨å·²ç»åŠ å…¥åˆ°äº†frpcadminå®¹å™¨ä¹‹ä¸­äº†</p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348495.png" alt="image-20230821113536575"></p>
<p>æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348969.png" alt="image-20230821113654613"></p>
<p>è®¿é—® ip:8000è¿›å…¥å¹³å°ï¼ŒæŒ‰éœ€å¡«å†™å†…å®¹</p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348578.png" alt="image-20230821113902068"></p>
<p>ä¸Šæ–¹å¯¼èˆªæ Admin-&gt;Plugins é…ç½®CTFd Whaleç›¸å…³å†…å®¹</p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348850.png" alt="image-20230821141633201"></p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348069.png" alt="image-20230821141835333"></p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348639.png" alt="image-20230821142048736"></p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348211.png" alt="image-20230821142123914"></p>
<h2 id="æ·»åŠ é¢˜ç›®"><a href="#æ·»åŠ é¢˜ç›®" class="headerlink" title="æ·»åŠ é¢˜ç›®"></a>æ·»åŠ é¢˜ç›®</h2><p>ä¸Šæ–¹challengeså¤„æ·»åŠ é¢˜ç›®ï¼Œé€‰æ‹©dynamic_dockeråˆ›å»ºåŠ¨æ€é¢˜ç›®</p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348868.png" alt="image-20230821142321874"></p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271355544.png" alt="image-20230821142545317"></p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348434.png" alt="image-20230821142719030"></p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348154.png" alt="image-20230821142727231"></p>
<p>æœ€åä¸è¦å¿˜è®°é€‰æ‹©åŠ¨æ€åˆ†æ•°</p>
<p>æˆåŠŸéƒ¨ç½²é¢˜ç›®</p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348073.png" alt="image-20230821142835370"></p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348601.png" alt="image-20230821142845326"></p>
<p>flagä¹Ÿæ˜¯åŠ¨æ€flag</p>
<p><img src="https://gitee.com/shark-rice/images/raw/master/202308271348902.png" alt="image-20230821142949627"></p>

    </div>
</article>
<!--æ˜¾ç¤ºæ–‡ç« é¡µç›¸å…³å†…å®¹-->
            <!--bodyæ˜¯ä¸€ä¸ªå˜é‡ï¼Œä»£è¡¨é¡µé¢çš„ä¸»è¦å†…å®¹ã€‚åœ¨æ¸²æŸ“æ¨¡æ¿æ—¶ï¼Œè¿™ä¸ªå˜é‡ä¼šè¢«æ›¿æ¢ä¸ºå®é™…çš„å†…å®¹ã€‚-->
            

            <div style="border-bottom:1px solid #eaedf3;"></div>

            <footer class="footer">
    <p>s4mmy &copy; 2025&nbsp;| &nbsp;Recorded for better expressionğŸ§¡&nbsp;|
        <a href="https://github.com/s4mmyyy/hexo-theme-life" target="_blank" class="theme">&nbsp;Theme</a>
    
    </p>
</footer>
        </div>
        
    </body>
</html>